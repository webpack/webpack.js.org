(self.webpackChunk=self.webpackChunk||[]).push([[1853],{1853:function(e,a,t){"use strict";t.r(a),t.d(a,{default:function(){return s}}),t(7378);var n=t(5318);function o(){return(o=Object.assign||function(e){for(var a=1;a<arguments.length;a++){var t=arguments[a];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e}).apply(this,arguments)}const p={};function s({components:e,...a}){return(0,n.kt)("wrapper",o({},p,a,{components:e,mdxType:"MDXLayout"}),(0,n.kt)("hr",null),(0,n.kt)("p",null,"title: Package exports\nsort: 25\ncontributors:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"sokra\nrelated:"),(0,n.kt)("li",{parentName:"ul"},"title: Package entry points in Node.js\nurl: ",(0,n.kt)("a",{parentName:"li",href:"https://nodejs.org/api/packages.html#packages_package_entry_points"},"https://nodejs.org/api/packages.html#packages_package_entry_points"))),(0,n.kt)("hr",null),(0,n.kt)("p",null,"The ",(0,n.kt)("inlineCode",{parentName:"p"},"exports")," field in the ",(0,n.kt)("inlineCode",{parentName:"p"},"package.json")," of a package allows to declare\nwhich module should be used when using module requests like ",(0,n.kt)("inlineCode",{parentName:"p"},'import "package"')," or ",(0,n.kt)("inlineCode",{parentName:"p"},'import "package/sub/path"'),".\nIt replaces the default implementation that returns ",(0,n.kt)("inlineCode",{parentName:"p"},"main")," field resp. ",(0,n.kt)("inlineCode",{parentName:"p"},"index.js")," files for ",(0,n.kt)("inlineCode",{parentName:"p"},'"package"')," and\nthe file system lookup for ",(0,n.kt)("inlineCode",{parentName:"p"},'"package/sub/path"'),"."),(0,n.kt)("p",null,"When the ",(0,n.kt)("inlineCode",{parentName:"p"},"exports")," field is specified, only these module requests are available.\nAny other requests will lead to a ModuleNotFound Error."),(0,n.kt)("h2",{id:"general-syntax"},"General syntax",(0,n.kt)("a",{parentName:"h2",href:"#general-syntax","aria-hidden":"true",tabIndex:-1},(0,n.kt)("span",{parentName:"a",className:"header-link"}))),(0,n.kt)("p",null,"In general the ",(0,n.kt)("inlineCode",{parentName:"p"},"exports")," field should contain an object\nwhere each properties specifies a sub path of the module request.\nFor the examples above the following properties could be used:\n",(0,n.kt)("inlineCode",{parentName:"p"},'"."')," for ",(0,n.kt)("inlineCode",{parentName:"p"},'import "package"')," and ",(0,n.kt)("inlineCode",{parentName:"p"},'"./sub/path"')," for ",(0,n.kt)("inlineCode",{parentName:"p"},'import "package/sub/path"'),".\nProperties ending with a ",(0,n.kt)("inlineCode",{parentName:"p"},"/")," will forward a request with this prefix to the old file system lookup algorithm.\nFor properties ending with ",(0,n.kt)("inlineCode",{parentName:"p"},"*"),", ",(0,n.kt)("inlineCode",{parentName:"p"},"*")," may take any value and any ",(0,n.kt)("inlineCode",{parentName:"p"},"*")," in the property value is replaced with the taken value."),(0,n.kt)("p",null,"An example:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"hljs language-json"},(0,n.kt)("span",{parentName:"code",className:"token punctuation"},"{"),"\n  ",(0,n.kt)("span",{parentName:"code",className:"token property"},'"exports"'),(0,n.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,n.kt)("span",{parentName:"code",className:"token punctuation"},"{"),"\n    ",(0,n.kt)("span",{parentName:"code",className:"token property"},'"."'),(0,n.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,n.kt)("span",{parentName:"code",className:"token string"},'"./main.js"'),(0,n.kt)("span",{parentName:"code",className:"token punctuation"},","),"\n    ",(0,n.kt)("span",{parentName:"code",className:"token property"},'"./sub/path"'),(0,n.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,n.kt)("span",{parentName:"code",className:"token string"},'"./secondary.js"'),(0,n.kt)("span",{parentName:"code",className:"token punctuation"},","),"\n    ",(0,n.kt)("span",{parentName:"code",className:"token property"},'"./prefix/"'),(0,n.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,n.kt)("span",{parentName:"code",className:"token string"},'"./directory/"'),(0,n.kt)("span",{parentName:"code",className:"token punctuation"},","),"\n    ",(0,n.kt)("span",{parentName:"code",className:"token property"},'"./prefix/deep/"'),(0,n.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,n.kt)("span",{parentName:"code",className:"token string"},'"./other-directory/"'),(0,n.kt)("span",{parentName:"code",className:"token punctuation"},","),"\n    ",(0,n.kt)("span",{parentName:"code",className:"token property"},'"./other-prefix/*"'),(0,n.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,n.kt)("span",{parentName:"code",className:"token string"},'"./yet-another/*/*.js"'),"\n  ",(0,n.kt)("span",{parentName:"code",className:"token punctuation"},"}"),"\n",(0,n.kt)("span",{parentName:"code",className:"token punctuation"},"}"))),(0,n.kt)("table",null,(0,n.kt)("thead",{parentName:"table"},(0,n.kt)("tr",{parentName:"thead"},(0,n.kt)("th",{parentName:"tr",align:null},"Module request"),(0,n.kt)("th",{parentName:"tr",align:null},"Result"))),(0,n.kt)("tbody",{parentName:"table"},(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null,"data-th":"Module request"},(0,n.kt)("span",{parentName:"td"},(0,n.kt)("inlineCode",{parentName:"span"},"package"))),(0,n.kt)("td",{parentName:"tr",align:null,"data-th":"Result"},(0,n.kt)("span",{parentName:"td"},(0,n.kt)("inlineCode",{parentName:"span"},".../package/main.js")))),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null,"data-th":"Module request"},(0,n.kt)("span",{parentName:"td"},(0,n.kt)("inlineCode",{parentName:"span"},"package/sub/path"))),(0,n.kt)("td",{parentName:"tr",align:null,"data-th":"Result"},(0,n.kt)("span",{parentName:"td"},(0,n.kt)("inlineCode",{parentName:"span"},".../package/secondary.js")))),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null,"data-th":"Module request"},(0,n.kt)("span",{parentName:"td"},(0,n.kt)("inlineCode",{parentName:"span"},"package/prefix/some/file.js"))),(0,n.kt)("td",{parentName:"tr",align:null,"data-th":"Result"},(0,n.kt)("span",{parentName:"td"},(0,n.kt)("inlineCode",{parentName:"span"},".../package/directory/some/file.js")))),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null,"data-th":"Module request"},(0,n.kt)("span",{parentName:"td"},(0,n.kt)("inlineCode",{parentName:"span"},"package/prefix/deep/file.js"))),(0,n.kt)("td",{parentName:"tr",align:null,"data-th":"Result"},(0,n.kt)("span",{parentName:"td"},(0,n.kt)("inlineCode",{parentName:"span"},".../package/other-directory/file.js")))),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null,"data-th":"Module request"},(0,n.kt)("span",{parentName:"td"},(0,n.kt)("inlineCode",{parentName:"span"},"package/other-prefix/deep/file.js"))),(0,n.kt)("td",{parentName:"tr",align:null,"data-th":"Result"},(0,n.kt)("span",{parentName:"td"},(0,n.kt)("inlineCode",{parentName:"span"},".../package/yet-another/deep/file/deep/file.js")))),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null,"data-th":"Module request"},(0,n.kt)("span",{parentName:"td"},(0,n.kt)("inlineCode",{parentName:"span"},"package/main.js"))),(0,n.kt)("td",{parentName:"tr",align:null,"data-th":"Result"},(0,n.kt)("span",{parentName:"td"},"Error"))))),(0,n.kt)("h2",{id:"alternatives"},"Alternatives",(0,n.kt)("a",{parentName:"h2",href:"#alternatives","aria-hidden":"true",tabIndex:-1},(0,n.kt)("span",{parentName:"a",className:"header-link"}))),(0,n.kt)("p",null,"Instead of providing a single result, the package author may provide a list of results.\nIn such a scenario this list is tried in order and the first valid result will be used."),(0,n.kt)("p",null,"Note: Only the first valid result will be used, not all valid results."),(0,n.kt)("p",null,"Example:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"hljs language-json"},(0,n.kt)("span",{parentName:"code",className:"token punctuation"},"{"),"\n  ",(0,n.kt)("span",{parentName:"code",className:"token property"},'"exports"'),(0,n.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,n.kt)("span",{parentName:"code",className:"token punctuation"},"{"),"\n    ",(0,n.kt)("span",{parentName:"code",className:"token property"},'"./things/"'),(0,n.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,n.kt)("span",{parentName:"code",className:"token punctuation"},"["),(0,n.kt)("span",{parentName:"code",className:"token string"},'"./good-things/"'),(0,n.kt)("span",{parentName:"code",className:"token punctuation"},",")," ",(0,n.kt)("span",{parentName:"code",className:"token string"},'"./bad-things/"'),(0,n.kt)("span",{parentName:"code",className:"token punctuation"},"]"),"\n  ",(0,n.kt)("span",{parentName:"code",className:"token punctuation"},"}"),"\n",(0,n.kt)("span",{parentName:"code",className:"token punctuation"},"}"))),(0,n.kt)("p",null,"Here ",(0,n.kt)("inlineCode",{parentName:"p"},"package/things/apple")," might be found in ",(0,n.kt)("inlineCode",{parentName:"p"},".../package/good-things/apple")," or in ",(0,n.kt)("inlineCode",{parentName:"p"},".../package/bad-things/apple"),"."),(0,n.kt)("h2",{id:"conditional-syntax"},"Conditional syntax",(0,n.kt)("a",{parentName:"h2",href:"#conditional-syntax","aria-hidden":"true",tabIndex:-1},(0,n.kt)("span",{parentName:"a",className:"header-link"}))),(0,n.kt)("p",null,"Instead of providing results directly in the ",(0,n.kt)("inlineCode",{parentName:"p"},"exports")," field,\nthe package author may let the module system choose one based on conditions about the environment."),(0,n.kt)("p",null,"In this case an object mapping conditions to results should be used.\nConditions are tried in object order.\nConditions that contain invalid results are skipped.\nConditions might be nested to create a logical AND.\nThe last condition in the object might be the special ",(0,n.kt)("inlineCode",{parentName:"p"},'"default"')," condition,\nwhich is always matched."),(0,n.kt)("p",null,"Example:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"hljs language-json"},(0,n.kt)("span",{parentName:"code",className:"token punctuation"},"{"),"\n  ",(0,n.kt)("span",{parentName:"code",className:"token property"},'"exports"'),(0,n.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,n.kt)("span",{parentName:"code",className:"token punctuation"},"{"),"\n    ",(0,n.kt)("span",{parentName:"code",className:"token property"},'"."'),(0,n.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,n.kt)("span",{parentName:"code",className:"token punctuation"},"{"),"\n      ",(0,n.kt)("span",{parentName:"code",className:"token property"},'"red"'),(0,n.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,n.kt)("span",{parentName:"code",className:"token string"},'"./stop.js"'),(0,n.kt)("span",{parentName:"code",className:"token punctuation"},","),"\n      ",(0,n.kt)("span",{parentName:"code",className:"token property"},'"yellow"'),(0,n.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,n.kt)("span",{parentName:"code",className:"token string"},'"./stop.js"'),(0,n.kt)("span",{parentName:"code",className:"token punctuation"},","),"\n      ",(0,n.kt)("span",{parentName:"code",className:"token property"},'"green"'),(0,n.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,n.kt)("span",{parentName:"code",className:"token punctuation"},"{"),"\n        ",(0,n.kt)("span",{parentName:"code",className:"token property"},'"free"'),(0,n.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,n.kt)("span",{parentName:"code",className:"token string"},'"./drive.js"'),(0,n.kt)("span",{parentName:"code",className:"token punctuation"},","),"\n        ",(0,n.kt)("span",{parentName:"code",className:"token property"},'"default"'),(0,n.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,n.kt)("span",{parentName:"code",className:"token string"},'"./wait.js"'),"\n      ",(0,n.kt)("span",{parentName:"code",className:"token punctuation"},"}"),(0,n.kt)("span",{parentName:"code",className:"token punctuation"},","),"\n      ",(0,n.kt)("span",{parentName:"code",className:"token property"},'"default"'),(0,n.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,n.kt)("span",{parentName:"code",className:"token string"},'"./drive-carefully.js"'),"\n    ",(0,n.kt)("span",{parentName:"code",className:"token punctuation"},"}"),"\n  ",(0,n.kt)("span",{parentName:"code",className:"token punctuation"},"}"),"\n",(0,n.kt)("span",{parentName:"code",className:"token punctuation"},"}"))),(0,n.kt)("p",null,"This translates to something like:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"hljs language-js"},(0,n.kt)("span",{parentName:"code",className:"token keyword"},"if")," ",(0,n.kt)("span",{parentName:"code",className:"token punctuation"},"("),"red ",(0,n.kt)("span",{parentName:"code",className:"token operator"},"&&")," ",(0,n.kt)("span",{parentName:"code",className:"token function"},"valid"),(0,n.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,n.kt)("span",{parentName:"code",className:"token string"},"'./stop.js'"),(0,n.kt)("span",{parentName:"code",className:"token punctuation"},")"),(0,n.kt)("span",{parentName:"code",className:"token punctuation"},")")," ",(0,n.kt)("span",{parentName:"code",className:"token keyword"},"return")," ",(0,n.kt)("span",{parentName:"code",className:"token string"},"'./stop.js'"),(0,n.kt)("span",{parentName:"code",className:"token punctuation"},";"),"\n",(0,n.kt)("span",{parentName:"code",className:"token keyword"},"if")," ",(0,n.kt)("span",{parentName:"code",className:"token punctuation"},"("),"yellow ",(0,n.kt)("span",{parentName:"code",className:"token operator"},"&&")," ",(0,n.kt)("span",{parentName:"code",className:"token function"},"valid"),(0,n.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,n.kt)("span",{parentName:"code",className:"token string"},"'./stop.js'"),(0,n.kt)("span",{parentName:"code",className:"token punctuation"},")"),(0,n.kt)("span",{parentName:"code",className:"token punctuation"},")")," ",(0,n.kt)("span",{parentName:"code",className:"token keyword"},"return")," ",(0,n.kt)("span",{parentName:"code",className:"token string"},"'./stop.js'"),(0,n.kt)("span",{parentName:"code",className:"token punctuation"},";"),"\n",(0,n.kt)("span",{parentName:"code",className:"token keyword"},"if")," ",(0,n.kt)("span",{parentName:"code",className:"token punctuation"},"("),"green",(0,n.kt)("span",{parentName:"code",className:"token punctuation"},")")," ",(0,n.kt)("span",{parentName:"code",className:"token punctuation"},"{"),"\n  ",(0,n.kt)("span",{parentName:"code",className:"token keyword"},"if")," ",(0,n.kt)("span",{parentName:"code",className:"token punctuation"},"("),"free ",(0,n.kt)("span",{parentName:"code",className:"token operator"},"&&")," ",(0,n.kt)("span",{parentName:"code",className:"token function"},"valid"),(0,n.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,n.kt)("span",{parentName:"code",className:"token string"},"'./drive.js'"),(0,n.kt)("span",{parentName:"code",className:"token punctuation"},")"),(0,n.kt)("span",{parentName:"code",className:"token punctuation"},")")," ",(0,n.kt)("span",{parentName:"code",className:"token keyword"},"return")," ",(0,n.kt)("span",{parentName:"code",className:"token string"},"'./drive.js'"),(0,n.kt)("span",{parentName:"code",className:"token punctuation"},";"),"\n  ",(0,n.kt)("span",{parentName:"code",className:"token keyword"},"if")," ",(0,n.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,n.kt)("span",{parentName:"code",className:"token function"},"valid"),(0,n.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,n.kt)("span",{parentName:"code",className:"token string"},"'./wait.js'"),(0,n.kt)("span",{parentName:"code",className:"token punctuation"},")"),(0,n.kt)("span",{parentName:"code",className:"token punctuation"},")")," ",(0,n.kt)("span",{parentName:"code",className:"token keyword"},"return")," ",(0,n.kt)("span",{parentName:"code",className:"token string"},"'./wait.js'"),(0,n.kt)("span",{parentName:"code",className:"token punctuation"},";"),"\n",(0,n.kt)("span",{parentName:"code",className:"token punctuation"},"}"),"\n",(0,n.kt)("span",{parentName:"code",className:"token keyword"},"if")," ",(0,n.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,n.kt)("span",{parentName:"code",className:"token function"},"valid"),(0,n.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,n.kt)("span",{parentName:"code",className:"token string"},"'./drive-carefully.js'"),(0,n.kt)("span",{parentName:"code",className:"token punctuation"},")"),(0,n.kt)("span",{parentName:"code",className:"token punctuation"},")")," ",(0,n.kt)("span",{parentName:"code",className:"token keyword"},"return")," ",(0,n.kt)("span",{parentName:"code",className:"token string"},"'./drive-carefully.js'"),(0,n.kt)("span",{parentName:"code",className:"token punctuation"},";"),"\n",(0,n.kt)("span",{parentName:"code",className:"token keyword"},"throw")," ",(0,n.kt)("span",{parentName:"code",className:"token keyword"},"new")," ",(0,n.kt)("span",{parentName:"code",className:"token class-name"},"ModuleNotFoundError"),(0,n.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,n.kt)("span",{parentName:"code",className:"token punctuation"},")"),(0,n.kt)("span",{parentName:"code",className:"token punctuation"},";"))),(0,n.kt)("p",null,"The available conditions vary depending on the module system and tool used."),(0,n.kt)("h2",{id:"abbreviation"},"Abbreviation",(0,n.kt)("a",{parentName:"h2",href:"#abbreviation","aria-hidden":"true",tabIndex:-1},(0,n.kt)("span",{parentName:"a",className:"header-link"}))),(0,n.kt)("p",null,"When only a single entry (",(0,n.kt)("inlineCode",{parentName:"p"},'"."'),") into the package should be supported the ",(0,n.kt)("inlineCode",{parentName:"p"},'{ ".": ... }')," object nesting can be omitted:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"hljs language-json"},(0,n.kt)("span",{parentName:"code",className:"token punctuation"},"{"),"\n  ",(0,n.kt)("span",{parentName:"code",className:"token property"},'"exports"'),(0,n.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,n.kt)("span",{parentName:"code",className:"token string"},'"./index.mjs"'),"\n",(0,n.kt)("span",{parentName:"code",className:"token punctuation"},"}"))),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"hljs language-json"},(0,n.kt)("span",{parentName:"code",className:"token punctuation"},"{"),"\n  ",(0,n.kt)("span",{parentName:"code",className:"token property"},'"exports"'),(0,n.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,n.kt)("span",{parentName:"code",className:"token punctuation"},"{"),"\n    ",(0,n.kt)("span",{parentName:"code",className:"token property"},'"red"'),(0,n.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,n.kt)("span",{parentName:"code",className:"token string"},'"./stop.js"'),(0,n.kt)("span",{parentName:"code",className:"token punctuation"},","),"\n    ",(0,n.kt)("span",{parentName:"code",className:"token property"},'"green"'),(0,n.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,n.kt)("span",{parentName:"code",className:"token string"},'"./drive.js"'),"\n  ",(0,n.kt)("span",{parentName:"code",className:"token punctuation"},"}"),"\n",(0,n.kt)("span",{parentName:"code",className:"token punctuation"},"}"))),(0,n.kt)("h2",{id:"notes-about-ordering"},"Notes about ordering",(0,n.kt)("a",{parentName:"h2",href:"#notes-about-ordering","aria-hidden":"true",tabIndex:-1},(0,n.kt)("span",{parentName:"a",className:"header-link"}))),(0,n.kt)("p",null,"In an object where each key is a condition, order of properties is significant. Conditions are handled in the order they are specified."),(0,n.kt)("p",null,"Example: ",(0,n.kt)("inlineCode",{parentName:"p"},'{ "red": "./stop.js", "green": "./drive.js" }')," != ",(0,n.kt)("inlineCode",{parentName:"p"},'{ "green": "./drive.js", "red": "./stop.js" }')," (when both ",(0,n.kt)("inlineCode",{parentName:"p"},"red")," and ",(0,n.kt)("inlineCode",{parentName:"p"},"green")," conditions are set, first property will be used)"),(0,n.kt)("p",null,"In an object where each key is a subpath, order of properties (subpaths) is not significant. More specific paths are preferred over less specific ones."),(0,n.kt)("p",null,"Example: ",(0,n.kt)("inlineCode",{parentName:"p"},'{ "./a/": "./x/", "./a/b/": "./y/", "./a/b/c": "./z" }')," == ",(0,n.kt)("inlineCode",{parentName:"p"},'{ "./a/b/c": "./z", "./a/b/": "./y/", "./a/": "./x/" }')," (order will always be: ",(0,n.kt)("inlineCode",{parentName:"p"},"./a/b/c")," > ",(0,n.kt)("inlineCode",{parentName:"p"},"./a/b/")," > ",(0,n.kt)("inlineCode",{parentName:"p"},"./a/"),")"),(0,n.kt)("p",null,(0,n.kt)("inlineCode",{parentName:"p"},"exports")," field is preferred over other package entry fields like ",(0,n.kt)("inlineCode",{parentName:"p"},"main"),", ",(0,n.kt)("inlineCode",{parentName:"p"},"module"),", ",(0,n.kt)("inlineCode",{parentName:"p"},"browser")," or custom ones."),(0,n.kt)("h2",{id:"support"},"Support",(0,n.kt)("a",{parentName:"h2",href:"#support","aria-hidden":"true",tabIndex:-1},(0,n.kt)("span",{parentName:"a",className:"header-link"}))),(0,n.kt)("table",null,(0,n.kt)("thead",{parentName:"table"},(0,n.kt)("tr",{parentName:"thead"},(0,n.kt)("th",{parentName:"tr",align:null},"Feature"),(0,n.kt)("th",{parentName:"tr",align:null},"Supported by"))),(0,n.kt)("tbody",{parentName:"table"},(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null,"data-th":"Feature"},(0,n.kt)("span",{parentName:"td"},(0,n.kt)("inlineCode",{parentName:"span"},'"."')," property")),(0,n.kt)("td",{parentName:"tr",align:null,"data-th":"Supported by"},(0,n.kt)("span",{parentName:"td"},"Node.js, webpack, rollup, esinstall, wmr"))),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null,"data-th":"Feature"},(0,n.kt)("span",{parentName:"td"},"normal property")),(0,n.kt)("td",{parentName:"tr",align:null,"data-th":"Supported by"},(0,n.kt)("span",{parentName:"td"},"Node.js, webpack, rollup, esinstall, wmr"))),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null,"data-th":"Feature"},(0,n.kt)("span",{parentName:"td"},"property ending with ",(0,n.kt)("inlineCode",{parentName:"span"},"/"))),(0,n.kt)("td",{parentName:"tr",align:null,"data-th":"Supported by"},(0,n.kt)("span",{parentName:"td"},"Node.js",(0,n.kt)("sup",null,"(1)"),", webpack, rollup, esinstall",(0,n.kt)("sup",null,"(2)"),", wmr",(0,n.kt)("sup",null,"(3)")))),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null,"data-th":"Feature"},(0,n.kt)("span",{parentName:"td"},"property ending with ",(0,n.kt)("inlineCode",{parentName:"span"},"*"))),(0,n.kt)("td",{parentName:"tr",align:null,"data-th":"Supported by"},(0,n.kt)("span",{parentName:"td"},"Node.js, webpack, rollup, esinstall"))),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null,"data-th":"Feature"},(0,n.kt)("span",{parentName:"td"},"Alternatives")),(0,n.kt)("td",{parentName:"tr",align:null,"data-th":"Supported by"},(0,n.kt)("span",{parentName:"td"},"Node.js, webpack, rollup, ",(0,n.kt)("strike",null,"esinstall"),(0,n.kt)("sup",null,"(4)")))),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null,"data-th":"Feature"},(0,n.kt)("span",{parentName:"td"},"Abbreviation only path")),(0,n.kt)("td",{parentName:"tr",align:null,"data-th":"Supported by"},(0,n.kt)("span",{parentName:"td"},"Node.js, webpack, rollup, esinstall, wmr"))),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null,"data-th":"Feature"},(0,n.kt)("span",{parentName:"td"},"Abbreviation only conditions")),(0,n.kt)("td",{parentName:"tr",align:null,"data-th":"Supported by"},(0,n.kt)("span",{parentName:"td"},"Node.js, webpack, rollup, esinstall, wmr"))),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null,"data-th":"Feature"},(0,n.kt)("span",{parentName:"td"},"Conditional syntax")),(0,n.kt)("td",{parentName:"tr",align:null,"data-th":"Supported by"},(0,n.kt)("span",{parentName:"td"},"Node.js, webpack, rollup, esinstall, wmr"))),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null,"data-th":"Feature"},(0,n.kt)("span",{parentName:"td"},"Nested conditional syntax")),(0,n.kt)("td",{parentName:"tr",align:null,"data-th":"Supported by"},(0,n.kt)("span",{parentName:"td"},"Node.js, webpack, rollup, wmr",(0,n.kt)("sup",null,"(5)")))),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null,"data-th":"Feature"},(0,n.kt)("span",{parentName:"td"},"Conditions Order")),(0,n.kt)("td",{parentName:"tr",align:null,"data-th":"Supported by"},(0,n.kt)("span",{parentName:"td"},"Node.js, webpack, rollup, wmr",(0,n.kt)("sup",null,"(6)")))),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null,"data-th":"Feature"},(0,n.kt)("span",{parentName:"td"},(0,n.kt)("inlineCode",{parentName:"span"},'"default"')," condition")),(0,n.kt)("td",{parentName:"tr",align:null,"data-th":"Supported by"},(0,n.kt)("span",{parentName:"td"},"Node.js, webpack, rollup, esinstall, wmr"))),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null,"data-th":"Feature"},(0,n.kt)("span",{parentName:"td"},"Path Order")),(0,n.kt)("td",{parentName:"tr",align:null,"data-th":"Supported by"},(0,n.kt)("span",{parentName:"td"},"Node.js, webpack, rollup"))),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null,"data-th":"Feature"},(0,n.kt)("span",{parentName:"td"},"Error when not mapped")),(0,n.kt)("td",{parentName:"tr",align:null,"data-th":"Supported by"},(0,n.kt)("span",{parentName:"td"},"Node.js, webpack, rollup, esinstall, wmr",(0,n.kt)("sup",null,"(7)")))),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null,"data-th":"Feature"},(0,n.kt)("span",{parentName:"td"},"Error when mixing conditions and paths")),(0,n.kt)("td",{parentName:"tr",align:null,"data-th":"Supported by"},(0,n.kt)("span",{parentName:"td"},"Node.js, webpack, rollup"))))),(0,n.kt)("p",null,"(1) deprecated in Node.js, ",(0,n.kt)("inlineCode",{parentName:"p"},"*")," should be preferred."),(0,n.kt)("p",null,"(2) ",(0,n.kt)("inlineCode",{parentName:"p"},'"./"')," is intentionally ignored as key."),(0,n.kt)("p",null,"(3) The property value is ignored and property key is used as target. Effectively only allowing mappings with key and value are identical."),(0,n.kt)("p",null,"(4) The syntax is supported, but always the first entry is used, which makes it unusable for any practical use case."),(0,n.kt)("p",null,"(5) Fallback to alternative sibling parent conditions is handling incorrectly."),(0,n.kt)("p",null,"(6) For the ",(0,n.kt)("inlineCode",{parentName:"p"},"require")," condition object order is handled incorrectly. This is intentionally as wmr doesn't differ between referencing syntax."),(0,n.kt)("p",null,"(7) When using ",(0,n.kt)("inlineCode",{parentName:"p"},'"exports": "./file.js"')," abbreviation, any request e. g. ",(0,n.kt)("inlineCode",{parentName:"p"},"package/not-existing")," will resolve to that. When not using the abbreviation, direct file access e. g. ",(0,n.kt)("inlineCode",{parentName:"p"},"package/file.js")," will not lead to an error."),(0,n.kt)("h2",{id:"conditions"},"Conditions",(0,n.kt)("a",{parentName:"h2",href:"#conditions","aria-hidden":"true",tabIndex:-1},(0,n.kt)("span",{parentName:"a",className:"header-link"}))),(0,n.kt)("h3",{id:"reference-syntax"},"Reference syntax",(0,n.kt)("a",{parentName:"h3",href:"#reference-syntax","aria-hidden":"true",tabIndex:-1},(0,n.kt)("span",{parentName:"a",className:"header-link"}))),(0,n.kt)("p",null,"One of these conditions is set depending on the syntax used to reference the module:"),(0,n.kt)("table",null,(0,n.kt)("thead",{parentName:"table"},(0,n.kt)("tr",{parentName:"thead"},(0,n.kt)("th",{parentName:"tr",align:null},"Condition"),(0,n.kt)("th",{parentName:"tr",align:null},"Description"),(0,n.kt)("th",{parentName:"tr",align:null},"Supported by"))),(0,n.kt)("tbody",{parentName:"table"},(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null,"data-th":"Condition"},(0,n.kt)("span",{parentName:"td"},(0,n.kt)("inlineCode",{parentName:"span"},"import"))),(0,n.kt)("td",{parentName:"tr",align:null,"data-th":"Description"},(0,n.kt)("span",{parentName:"td"},"Request is issued from ESM syntax or similar.")),(0,n.kt)("td",{parentName:"tr",align:null,"data-th":"Supported by"},(0,n.kt)("span",{parentName:"td"},"Node.js, webpack, rollup, esinstall",(0,n.kt)("sup",null,"(1)"),", wmr",(0,n.kt)("sup",null,"(1)")))),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null,"data-th":"Condition"},(0,n.kt)("span",{parentName:"td"},(0,n.kt)("inlineCode",{parentName:"span"},"require"))),(0,n.kt)("td",{parentName:"tr",align:null,"data-th":"Description"},(0,n.kt)("span",{parentName:"td"},"Request is issued from CommonJs/AMD syntax or similar.")),(0,n.kt)("td",{parentName:"tr",align:null,"data-th":"Supported by"},(0,n.kt)("span",{parentName:"td"},"Node.js, webpack, rollup, esinstall",(0,n.kt)("sup",null,"(1)"),", wmr",(0,n.kt)("sup",null,"(1)")))),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null,"data-th":"Condition"},(0,n.kt)("span",{parentName:"td"},(0,n.kt)("inlineCode",{parentName:"span"},"style"))),(0,n.kt)("td",{parentName:"tr",align:null,"data-th":"Description"},(0,n.kt)("span",{parentName:"td"},"Request is issued from a stylesheet reference.")),(0,n.kt)("td",{parentName:"tr",align:null})),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null,"data-th":"Condition"},(0,n.kt)("span",{parentName:"td"},(0,n.kt)("inlineCode",{parentName:"span"},"sass"))),(0,n.kt)("td",{parentName:"tr",align:null,"data-th":"Description"},(0,n.kt)("span",{parentName:"td"},"Request is issued from a sass stylesheet reference.")),(0,n.kt)("td",{parentName:"tr",align:null})),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null,"data-th":"Condition"},(0,n.kt)("span",{parentName:"td"},(0,n.kt)("inlineCode",{parentName:"span"},"asset"))),(0,n.kt)("td",{parentName:"tr",align:null,"data-th":"Description"},(0,n.kt)("span",{parentName:"td"},"Request is issued from a asset reference.")),(0,n.kt)("td",{parentName:"tr",align:null})),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null,"data-th":"Condition"},(0,n.kt)("span",{parentName:"td"},(0,n.kt)("inlineCode",{parentName:"span"},"script"))),(0,n.kt)("td",{parentName:"tr",align:null,"data-th":"Description"},(0,n.kt)("span",{parentName:"td"},"Request is issued from a normal script tag without module system.")),(0,n.kt)("td",{parentName:"tr",align:null})))),(0,n.kt)("p",null,"These conditions might also be set additionally:"),(0,n.kt)("table",null,(0,n.kt)("thead",{parentName:"table"},(0,n.kt)("tr",{parentName:"thead"},(0,n.kt)("th",{parentName:"tr",align:null},"Condition"),(0,n.kt)("th",{parentName:"tr",align:null},"Description"),(0,n.kt)("th",{parentName:"tr",align:null},"Supported by"))),(0,n.kt)("tbody",{parentName:"table"},(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null,"data-th":"Condition"},(0,n.kt)("span",{parentName:"td"},(0,n.kt)("inlineCode",{parentName:"span"},"module"))),(0,n.kt)("td",{parentName:"tr",align:null,"data-th":"Description"},(0,n.kt)("span",{parentName:"td"},"All module syntax that allows to reference javascript supports ESM.",(0,n.kt)("br",null),"(only combined with ",(0,n.kt)("inlineCode",{parentName:"span"},"import")," or ",(0,n.kt)("inlineCode",{parentName:"span"},"require"),")")),(0,n.kt)("td",{parentName:"tr",align:null,"data-th":"Supported by"},(0,n.kt)("span",{parentName:"td"},"webpack, rollup, wmr"))),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null,"data-th":"Condition"},(0,n.kt)("span",{parentName:"td"},(0,n.kt)("inlineCode",{parentName:"span"},"esmodules"))),(0,n.kt)("td",{parentName:"tr",align:null,"data-th":"Description"},(0,n.kt)("span",{parentName:"td"},"Always set by supported tools.")),(0,n.kt)("td",{parentName:"tr",align:null,"data-th":"Supported by"},(0,n.kt)("span",{parentName:"td"},"wmr"))),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null,"data-th":"Condition"},(0,n.kt)("span",{parentName:"td"},(0,n.kt)("inlineCode",{parentName:"span"},"types"))),(0,n.kt)("td",{parentName:"tr",align:null,"data-th":"Description"},(0,n.kt)("span",{parentName:"td"},"Request is issued from typescript that is interested in type declarations.")),(0,n.kt)("td",{parentName:"tr",align:null})))),(0,n.kt)("p",null,"(1) ",(0,n.kt)("inlineCode",{parentName:"p"},"import")," and ",(0,n.kt)("inlineCode",{parentName:"p"},"require")," are both set independent of referencing syntax. ",(0,n.kt)("inlineCode",{parentName:"p"},"require")," has always lower priority."),(0,n.kt)("h4",{id:"import"},(0,n.kt)("inlineCode",{parentName:"h4"},"import"),(0,n.kt)("a",{parentName:"h4",href:"#import","aria-hidden":"true",tabIndex:-1},(0,n.kt)("span",{parentName:"a",className:"header-link"}))),(0,n.kt)("p",null,"The following syntax will set the ",(0,n.kt)("inlineCode",{parentName:"p"},"import")," condition:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"ESM ",(0,n.kt)("inlineCode",{parentName:"li"},"import")," declarations in ESM"),(0,n.kt)("li",{parentName:"ul"},"JS ",(0,n.kt)("inlineCode",{parentName:"li"},"import()")," expression"),(0,n.kt)("li",{parentName:"ul"},"HTML ",(0,n.kt)("inlineCode",{parentName:"li"},'<script type="module">')," in HTML"),(0,n.kt)("li",{parentName:"ul"},"HTML ",(0,n.kt)("inlineCode",{parentName:"li"},'<link rel="preload/prefetch">')," in HTML"),(0,n.kt)("li",{parentName:"ul"},"JS ",(0,n.kt)("inlineCode",{parentName:"li"},'new Worker(..., { type: "module" })')),(0,n.kt)("li",{parentName:"ul"},"WASM ",(0,n.kt)("inlineCode",{parentName:"li"},"import")," section"),(0,n.kt)("li",{parentName:"ul"},"ESM HMR (webpack) ",(0,n.kt)("inlineCode",{parentName:"li"},"import.hot.accept/decline([...])")),(0,n.kt)("li",{parentName:"ul"},"JS ",(0,n.kt)("inlineCode",{parentName:"li"},"Worklet.addModule")),(0,n.kt)("li",{parentName:"ul"},"Using javascript as entrypoint")),(0,n.kt)("h4",{id:"require"},(0,n.kt)("inlineCode",{parentName:"h4"},"require"),(0,n.kt)("a",{parentName:"h4",href:"#require","aria-hidden":"true",tabIndex:-1},(0,n.kt)("span",{parentName:"a",className:"header-link"}))),(0,n.kt)("p",null,"The following syntax will set the ",(0,n.kt)("inlineCode",{parentName:"p"},"require")," condition:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"CommonJs ",(0,n.kt)("inlineCode",{parentName:"li"},"require(...)")),(0,n.kt)("li",{parentName:"ul"},"AMD ",(0,n.kt)("inlineCode",{parentName:"li"},"define()")),(0,n.kt)("li",{parentName:"ul"},"AMD ",(0,n.kt)("inlineCode",{parentName:"li"},"require([...])")),(0,n.kt)("li",{parentName:"ul"},"CommonJs ",(0,n.kt)("inlineCode",{parentName:"li"},"require.resolve()")),(0,n.kt)("li",{parentName:"ul"},"CommonJs (webpack) ",(0,n.kt)("inlineCode",{parentName:"li"},"require.ensure([...])")),(0,n.kt)("li",{parentName:"ul"},"CommonJs (webpack) ",(0,n.kt)("inlineCode",{parentName:"li"},"require.context")),(0,n.kt)("li",{parentName:"ul"},"CommonJs HMR (webpack) ",(0,n.kt)("inlineCode",{parentName:"li"},"module.hot.accept/decline([...])")),(0,n.kt)("li",{parentName:"ul"},"HTML ",(0,n.kt)("inlineCode",{parentName:"li"},'<script src="...">'))),(0,n.kt)("h4",{id:"style"},(0,n.kt)("inlineCode",{parentName:"h4"},"style"),(0,n.kt)("a",{parentName:"h4",href:"#style","aria-hidden":"true",tabIndex:-1},(0,n.kt)("span",{parentName:"a",className:"header-link"}))),(0,n.kt)("p",null,"The following syntax will set the ",(0,n.kt)("inlineCode",{parentName:"p"},"style")," condition:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"CSS ",(0,n.kt)("inlineCode",{parentName:"li"},"@import")),(0,n.kt)("li",{parentName:"ul"},"HTML ",(0,n.kt)("inlineCode",{parentName:"li"},'<link rel="stylesheet">'))),(0,n.kt)("h4",{id:"asset"},(0,n.kt)("inlineCode",{parentName:"h4"},"asset"),(0,n.kt)("a",{parentName:"h4",href:"#asset","aria-hidden":"true",tabIndex:-1},(0,n.kt)("span",{parentName:"a",className:"header-link"}))),(0,n.kt)("p",null,"The following syntax will set the ",(0,n.kt)("inlineCode",{parentName:"p"},"asset")," condition:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"CSS ",(0,n.kt)("inlineCode",{parentName:"li"},"url()")),(0,n.kt)("li",{parentName:"ul"},"ESM ",(0,n.kt)("inlineCode",{parentName:"li"},"new URL(..., import.meta.url)")),(0,n.kt)("li",{parentName:"ul"},"HTML ",(0,n.kt)("inlineCode",{parentName:"li"},'<img src="...">'))),(0,n.kt)("h4",{id:"script"},(0,n.kt)("inlineCode",{parentName:"h4"},"script"),(0,n.kt)("a",{parentName:"h4",href:"#script","aria-hidden":"true",tabIndex:-1},(0,n.kt)("span",{parentName:"a",className:"header-link"}))),(0,n.kt)("p",null,"The following syntax will set the ",(0,n.kt)("inlineCode",{parentName:"p"},"script")," condition:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"HTML ",(0,n.kt)("inlineCode",{parentName:"li"},'<script src="...">'))),(0,n.kt)("p",null,(0,n.kt)("inlineCode",{parentName:"p"},"script")," should only be set when no module system is supported.\nWhen the script is preprocessed by a system supporting CommonJs\nit should set ",(0,n.kt)("inlineCode",{parentName:"p"},"require")," instead."),(0,n.kt)("p",null,"This condition should be used when looking for a javascript file that can be injected\nas script tag in a HTML page without additional preprocessing."),(0,n.kt)("h3",{id:"optimizations"},"Optimizations",(0,n.kt)("a",{parentName:"h3",href:"#optimizations","aria-hidden":"true",tabIndex:-1},(0,n.kt)("span",{parentName:"a",className:"header-link"}))),(0,n.kt)("p",null,"The following conditions are set for various optimizations:"),(0,n.kt)("table",null,(0,n.kt)("thead",{parentName:"table"},(0,n.kt)("tr",{parentName:"thead"},(0,n.kt)("th",{parentName:"tr",align:null},"Condition"),(0,n.kt)("th",{parentName:"tr",align:null},"Description"),(0,n.kt)("th",{parentName:"tr",align:null},"Supported by"))),(0,n.kt)("tbody",{parentName:"table"},(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null,"data-th":"Condition"},(0,n.kt)("span",{parentName:"td"},(0,n.kt)("inlineCode",{parentName:"span"},"production"))),(0,n.kt)("td",{parentName:"tr",align:null,"data-th":"Description"},(0,n.kt)("span",{parentName:"td"},"In a production environment.",(0,n.kt)("br",null),"No devtooling should be included.")),(0,n.kt)("td",{parentName:"tr",align:null,"data-th":"Supported by"},(0,n.kt)("span",{parentName:"td"},"webpack"))),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null,"data-th":"Condition"},(0,n.kt)("span",{parentName:"td"},(0,n.kt)("inlineCode",{parentName:"span"},"development"))),(0,n.kt)("td",{parentName:"tr",align:null,"data-th":"Description"},(0,n.kt)("span",{parentName:"td"},"In a development environment.",(0,n.kt)("br",null),"Devtooling should be included.")),(0,n.kt)("td",{parentName:"tr",align:null,"data-th":"Supported by"},(0,n.kt)("span",{parentName:"td"},"webpack"))))),(0,n.kt)("p",null,"Note: Since ",(0,n.kt)("inlineCode",{parentName:"p"},"production")," and ",(0,n.kt)("inlineCode",{parentName:"p"},"development")," is not supported by everyone, no assumption should be made when none of these is set."),(0,n.kt)("h3",{id:"target-environment"},"Target environment",(0,n.kt)("a",{parentName:"h3",href:"#target-environment","aria-hidden":"true",tabIndex:-1},(0,n.kt)("span",{parentName:"a",className:"header-link"}))),(0,n.kt)("p",null,"The following conditions are set depending on the target environment:"),(0,n.kt)("table",null,(0,n.kt)("thead",{parentName:"table"},(0,n.kt)("tr",{parentName:"thead"},(0,n.kt)("th",{parentName:"tr",align:null},"Condition"),(0,n.kt)("th",{parentName:"tr",align:null},"Description"),(0,n.kt)("th",{parentName:"tr",align:null},"Supported by"))),(0,n.kt)("tbody",{parentName:"table"},(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null,"data-th":"Condition"},(0,n.kt)("span",{parentName:"td"},(0,n.kt)("inlineCode",{parentName:"span"},"browser"))),(0,n.kt)("td",{parentName:"tr",align:null,"data-th":"Description"},(0,n.kt)("span",{parentName:"td"},"Code will run in a browser.")),(0,n.kt)("td",{parentName:"tr",align:null,"data-th":"Supported by"},(0,n.kt)("span",{parentName:"td"},"webpack, esinstall, wmr"))),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null,"data-th":"Condition"},(0,n.kt)("span",{parentName:"td"},(0,n.kt)("inlineCode",{parentName:"span"},"electron"))),(0,n.kt)("td",{parentName:"tr",align:null,"data-th":"Description"},(0,n.kt)("span",{parentName:"td"},"Code will run in electron.",(0,n.kt)("sup",null,"(1)"))),(0,n.kt)("td",{parentName:"tr",align:null,"data-th":"Supported by"},(0,n.kt)("span",{parentName:"td"},"webpack"))),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null,"data-th":"Condition"},(0,n.kt)("span",{parentName:"td"},(0,n.kt)("inlineCode",{parentName:"span"},"worker"))),(0,n.kt)("td",{parentName:"tr",align:null,"data-th":"Description"},(0,n.kt)("span",{parentName:"td"},"Code will run in a (Web)Worker.",(0,n.kt)("sup",null,"(1)"))),(0,n.kt)("td",{parentName:"tr",align:null,"data-th":"Supported by"},(0,n.kt)("span",{parentName:"td"},"webpack"))),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null,"data-th":"Condition"},(0,n.kt)("span",{parentName:"td"},(0,n.kt)("inlineCode",{parentName:"span"},"worklet"))),(0,n.kt)("td",{parentName:"tr",align:null,"data-th":"Description"},(0,n.kt)("span",{parentName:"td"},"Code will run in a Worklet.",(0,n.kt)("sup",null,"(1)"))),(0,n.kt)("td",{parentName:"tr",align:null,"data-th":"Supported by"},(0,n.kt)("span",{parentName:"td"},"-"))),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null,"data-th":"Condition"},(0,n.kt)("span",{parentName:"td"},(0,n.kt)("inlineCode",{parentName:"span"},"node"))),(0,n.kt)("td",{parentName:"tr",align:null,"data-th":"Description"},(0,n.kt)("span",{parentName:"td"},"Code will run in Node.js.")),(0,n.kt)("td",{parentName:"tr",align:null,"data-th":"Supported by"},(0,n.kt)("span",{parentName:"td"},"Node.js, webpack, wmr",(0,n.kt)("sup",null,"(2)")))),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null,"data-th":"Condition"},(0,n.kt)("span",{parentName:"td"},(0,n.kt)("inlineCode",{parentName:"span"},"deno"))),(0,n.kt)("td",{parentName:"tr",align:null,"data-th":"Description"},(0,n.kt)("span",{parentName:"td"},"Code will run in Deno.")),(0,n.kt)("td",{parentName:"tr",align:null,"data-th":"Supported by"},(0,n.kt)("span",{parentName:"td"},"-"))),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null,"data-th":"Condition"},(0,n.kt)("span",{parentName:"td"},(0,n.kt)("inlineCode",{parentName:"span"},"react-native"))),(0,n.kt)("td",{parentName:"tr",align:null,"data-th":"Description"},(0,n.kt)("span",{parentName:"td"},"Code will run in react-native.")),(0,n.kt)("td",{parentName:"tr",align:null,"data-th":"Supported by"},(0,n.kt)("span",{parentName:"td"},"-"))))),(0,n.kt)("p",null,"(1) ",(0,n.kt)("inlineCode",{parentName:"p"},"electron"),", ",(0,n.kt)("inlineCode",{parentName:"p"},"worker")," and ",(0,n.kt)("inlineCode",{parentName:"p"},"worklet")," comes combined with either ",(0,n.kt)("inlineCode",{parentName:"p"},"node")," or ",(0,n.kt)("inlineCode",{parentName:"p"},"browser"),", depending on the context."),(0,n.kt)("p",null,"(2) This is set for browser target environment."),(0,n.kt)("p",null,"Since there are multiple versions of each environment the following guidelines apply:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("inlineCode",{parentName:"li"},"node"),": See ",(0,n.kt)("inlineCode",{parentName:"li"},"engines")," field for compatibility."),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("inlineCode",{parentName:"li"},"browser"),": Compatible with current Spec and stage 4 proposals at time of publishing the package. Polyfilling resp. transpiling must be handled on consumer side.",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"Features that are not possible to polyfill or transpile should be used carefully as it limits the possible usage."))),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("inlineCode",{parentName:"li"},"deno"),": TBD"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("inlineCode",{parentName:"li"},"react-native"),": TBD")),(0,n.kt)("h3",{id:"conditions-preprocessor-and-runtimes"},"Conditions: Preprocessor and runtimes",(0,n.kt)("a",{parentName:"h3",href:"#conditions-preprocessor-and-runtimes","aria-hidden":"true",tabIndex:-1},(0,n.kt)("span",{parentName:"a",className:"header-link"}))),(0,n.kt)("p",null,"The following conditions are set depending on which tool preprocesses the source code."),(0,n.kt)("table",null,(0,n.kt)("thead",{parentName:"table"},(0,n.kt)("tr",{parentName:"thead"},(0,n.kt)("th",{parentName:"tr",align:null},"Condition"),(0,n.kt)("th",{parentName:"tr",align:null},"Description"),(0,n.kt)("th",{parentName:"tr",align:null},"Supported by"))),(0,n.kt)("tbody",{parentName:"table"},(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null,"data-th":"Condition"},(0,n.kt)("span",{parentName:"td"},(0,n.kt)("inlineCode",{parentName:"span"},"webpack"))),(0,n.kt)("td",{parentName:"tr",align:null,"data-th":"Description"},(0,n.kt)("span",{parentName:"td"},"Processed by webpack.")),(0,n.kt)("td",{parentName:"tr",align:null,"data-th":"Supported by"},(0,n.kt)("span",{parentName:"td"},"webpack"))))),(0,n.kt)("p",null,"Sadly there is no ",(0,n.kt)("inlineCode",{parentName:"p"},"node-js")," condition for Node.js as runtime.\nThis would simplify creating exceptions for Node.js."),(0,n.kt)("h3",{id:"conditions-custom"},"Conditions: Custom",(0,n.kt)("a",{parentName:"h3",href:"#conditions-custom","aria-hidden":"true",tabIndex:-1},(0,n.kt)("span",{parentName:"a",className:"header-link"}))),(0,n.kt)("p",null,"The following tools support custom conditions:"),(0,n.kt)("table",null,(0,n.kt)("thead",{parentName:"table"},(0,n.kt)("tr",{parentName:"thead"},(0,n.kt)("th",{parentName:"tr",align:null},"Tool"),(0,n.kt)("th",{parentName:"tr",align:null},"Supported"),(0,n.kt)("th",{parentName:"tr",align:null},"Notes"))),(0,n.kt)("tbody",{parentName:"table"},(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null,"data-th":"Tool"},(0,n.kt)("span",{parentName:"td"},"Node.js")),(0,n.kt)("td",{parentName:"tr",align:null,"data-th":"Supported"},(0,n.kt)("span",{parentName:"td"},"yes")),(0,n.kt)("td",{parentName:"tr",align:null,"data-th":"Notes"},(0,n.kt)("span",{parentName:"td"},"Use ",(0,n.kt)("a",{parentName:"span",href:"https://nodejs.org/api/cli.html#cli_c_condition_conditions_condition"},(0,n.kt)("inlineCode",{parentName:"a"},"--conditions"))," CLI argument."))),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null,"data-th":"Tool"},(0,n.kt)("span",{parentName:"td"},"webpack")),(0,n.kt)("td",{parentName:"tr",align:null,"data-th":"Supported"},(0,n.kt)("span",{parentName:"td"},"yes")),(0,n.kt)("td",{parentName:"tr",align:null,"data-th":"Notes"},(0,n.kt)("span",{parentName:"td"},"Use ",(0,n.kt)("a",{parentName:"span",href:"/configuration/resolve/#resolveconditionnames"},(0,n.kt)("inlineCode",{parentName:"a"},"resolve.conditionNames"))," configuration option."))),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null,"data-th":"Tool"},(0,n.kt)("span",{parentName:"td"},"rollup")),(0,n.kt)("td",{parentName:"tr",align:null,"data-th":"Supported"},(0,n.kt)("span",{parentName:"td"},"yes")),(0,n.kt)("td",{parentName:"tr",align:null,"data-th":"Notes"},(0,n.kt)("span",{parentName:"td"},"Use ",(0,n.kt)("inlineCode",{parentName:"span"},"exportConditions")," option for ",(0,n.kt)("inlineCode",{parentName:"span"},"@rollup/plugin-node-resolve")))),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null,"data-th":"Tool"},(0,n.kt)("span",{parentName:"td"},"esinstall")),(0,n.kt)("td",{parentName:"tr",align:null,"data-th":"Supported"},(0,n.kt)("span",{parentName:"td"},"no")),(0,n.kt)("td",{parentName:"tr",align:null})),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null,"data-th":"Tool"},(0,n.kt)("span",{parentName:"td"},"wmr")),(0,n.kt)("td",{parentName:"tr",align:null,"data-th":"Supported"},(0,n.kt)("span",{parentName:"td"},"no")),(0,n.kt)("td",{parentName:"tr",align:null})))),(0,n.kt)("p",null,"For custom conditions the following naming schema is recommended:"),(0,n.kt)("p",null,(0,n.kt)("inlineCode",{parentName:"p"},"<company-name>:<condition-name>")),(0,n.kt)("p",null,"Examples: ",(0,n.kt)("inlineCode",{parentName:"p"},"example-corp:beta"),", ",(0,n.kt)("inlineCode",{parentName:"p"},"google:internal"),"."),(0,n.kt)("h2",{id:"common-patterns"},"Common patterns",(0,n.kt)("a",{parentName:"h2",href:"#common-patterns","aria-hidden":"true",tabIndex:-1},(0,n.kt)("span",{parentName:"a",className:"header-link"}))),(0,n.kt)("p",null,"All patterns are explained with a single ",(0,n.kt)("inlineCode",{parentName:"p"},'"."')," entry into the package, but they can be extended from multiple entries too, by repeating the pattern for each entry."),(0,n.kt)("p",null,"These pattern should be used as guide not as strict ruleset.\nThey can be adapted to the individual packages."),(0,n.kt)("p",null,"These pattern are based on the following list of goals/assumptions:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"Packages are rotting.",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"We assume at some point packages are no longer being maintained, but they are continued to be used."),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("inlineCode",{parentName:"li"},"exports")," should be written to use fallbacks for unknown future cases. ",(0,n.kt)("inlineCode",{parentName:"li"},"default")," condition can be used for that."),(0,n.kt)("li",{parentName:"ul"},"As the future is unknown we assume an environment similar to browsers and module system similar to ESM."))),(0,n.kt)("li",{parentName:"ul"},"Not all conditions are supported by every tool.",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"Fallbacks should be used to handled these cases."),(0,n.kt)("li",{parentName:"ul"},"We assume the following fallback make sense in general:",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"ESM > CommonJs"),(0,n.kt)("li",{parentName:"ul"},"Production > Development"),(0,n.kt)("li",{parentName:"ul"},"Browser > node.js")))))),(0,n.kt)("p",null,"Depending on the package intention maybe something else makes sense and in this case the patterns should be adopted to that. Example: For a command line tool a browser-like future and fallback doesn't make a lot of sense, and in this case node.js-like environments and fallbacks should be used instead."),(0,n.kt)("p",null,"For complex use cases multiple patterns need to be combined by nesting these conditions."),(0,n.kt)("h3",{id:"target-environment-independent-packages"},"Target environment independent packages",(0,n.kt)("a",{parentName:"h3",href:"#target-environment-independent-packages","aria-hidden":"true",tabIndex:-1},(0,n.kt)("span",{parentName:"a",className:"header-link"}))),(0,n.kt)("p",null,"These patterns make sense for packages that do not use environment specific APIs."),(0,n.kt)("h4",{id:"providing-only-an-esm-version"},"Providing only an ESM version",(0,n.kt)("a",{parentName:"h4",href:"#providing-only-an-esm-version","aria-hidden":"true",tabIndex:-1},(0,n.kt)("span",{parentName:"a",className:"header-link"}))),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"hljs language-json"},(0,n.kt)("span",{parentName:"code",className:"token punctuation"},"{"),"\n  ",(0,n.kt)("span",{parentName:"code",className:"token property"},'"type"'),(0,n.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,n.kt)("span",{parentName:"code",className:"token string"},'"module"'),(0,n.kt)("span",{parentName:"code",className:"token punctuation"},","),"\n  ",(0,n.kt)("span",{parentName:"code",className:"token property"},'"exports"'),(0,n.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,n.kt)("span",{parentName:"code",className:"token string"},'"./index.js"'),"\n",(0,n.kt)("span",{parentName:"code",className:"token punctuation"},"}"))),(0,n.kt)("p",null,"Note: Providing only a ESM comes with restrictions for node.js.\nSuch a package would only work in Node.js >= 14 and only when using ",(0,n.kt)("inlineCode",{parentName:"p"},"import"),".\nIt won't work with ",(0,n.kt)("inlineCode",{parentName:"p"},"require()"),"."),(0,n.kt)("h4",{id:"providing-commonjs-and-esm-version-stateless"},"Providing CommonJs and ESM version (stateless)",(0,n.kt)("a",{parentName:"h4",href:"#providing-commonjs-and-esm-version-stateless","aria-hidden":"true",tabIndex:-1},(0,n.kt)("span",{parentName:"a",className:"header-link"}))),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"hljs language-json"},(0,n.kt)("span",{parentName:"code",className:"token punctuation"},"{"),"\n  ",(0,n.kt)("span",{parentName:"code",className:"token property"},'"type"'),(0,n.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,n.kt)("span",{parentName:"code",className:"token string"},'"module"'),(0,n.kt)("span",{parentName:"code",className:"token punctuation"},","),"\n  ",(0,n.kt)("span",{parentName:"code",className:"token property"},'"exports"'),(0,n.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,n.kt)("span",{parentName:"code",className:"token punctuation"},"{"),"\n    ",(0,n.kt)("span",{parentName:"code",className:"token property"},'"node"'),(0,n.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,n.kt)("span",{parentName:"code",className:"token punctuation"},"{"),"\n      ",(0,n.kt)("span",{parentName:"code",className:"token property"},'"module"'),(0,n.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,n.kt)("span",{parentName:"code",className:"token string"},'"./index.js"'),(0,n.kt)("span",{parentName:"code",className:"token punctuation"},","),"\n      ",(0,n.kt)("span",{parentName:"code",className:"token property"},'"require"'),(0,n.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,n.kt)("span",{parentName:"code",className:"token string"},'"./index.cjs"'),"\n    ",(0,n.kt)("span",{parentName:"code",className:"token punctuation"},"}"),(0,n.kt)("span",{parentName:"code",className:"token punctuation"},","),"\n    ",(0,n.kt)("span",{parentName:"code",className:"token property"},'"default"'),(0,n.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,n.kt)("span",{parentName:"code",className:"token string"},'"./index.js"'),"\n  ",(0,n.kt)("span",{parentName:"code",className:"token punctuation"},"}"),"\n",(0,n.kt)("span",{parentName:"code",className:"token punctuation"},"}"))),(0,n.kt)("p",null,"Most tools get the ESM version.\nNode.js is an exception here.\nIt gets a CommonJs version when using ",(0,n.kt)("inlineCode",{parentName:"p"},"require()"),".\nThis will lead to two instances of these package when referencing it with ",(0,n.kt)("inlineCode",{parentName:"p"},"require()")," and ",(0,n.kt)("inlineCode",{parentName:"p"},"import"),", but that doesn't hurt as the package doesn't have state."),(0,n.kt)("p",null,"The ",(0,n.kt)("inlineCode",{parentName:"p"},"module")," condition is used as optimization when preprocessing node-targeted code with a tool that supports ESM for ",(0,n.kt)("inlineCode",{parentName:"p"},"require()")," (like a bundler, when bundling for Node.js).\nFor such a tool the exception is skipped.\nThis is technically optional, but bundlers would include the package source code twice otherwise."),(0,n.kt)("p",null,"You can also use the stateless pattern if you are able to isolate your package state in JSON files.\nJSON is consumable from CommonJs and ESM without polluting the graph with the other module system."),(0,n.kt)("p",null,"Note that here stateless also means class instances are not tested with ",(0,n.kt)("inlineCode",{parentName:"p"},"instanceof")," as there can be two different classes because of the double module instantiation."),(0,n.kt)("h4",{id:"providing-commonjs-and-esm-version-stateful"},"Providing CommonJs and ESM version (stateful)",(0,n.kt)("a",{parentName:"h4",href:"#providing-commonjs-and-esm-version-stateful","aria-hidden":"true",tabIndex:-1},(0,n.kt)("span",{parentName:"a",className:"header-link"}))),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"hljs language-json"},(0,n.kt)("span",{parentName:"code",className:"token punctuation"},"{"),"\n  ",(0,n.kt)("span",{parentName:"code",className:"token property"},'"type"'),(0,n.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,n.kt)("span",{parentName:"code",className:"token string"},'"module"'),(0,n.kt)("span",{parentName:"code",className:"token punctuation"},","),"\n  ",(0,n.kt)("span",{parentName:"code",className:"token property"},'"exports"'),(0,n.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,n.kt)("span",{parentName:"code",className:"token punctuation"},"{"),"\n    ",(0,n.kt)("span",{parentName:"code",className:"token property"},'"node"'),(0,n.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,n.kt)("span",{parentName:"code",className:"token punctuation"},"{"),"\n      ",(0,n.kt)("span",{parentName:"code",className:"token property"},'"module"'),(0,n.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,n.kt)("span",{parentName:"code",className:"token string"},'"./index.js"'),(0,n.kt)("span",{parentName:"code",className:"token punctuation"},","),"\n      ",(0,n.kt)("span",{parentName:"code",className:"token property"},'"import"'),(0,n.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,n.kt)("span",{parentName:"code",className:"token string"},'"./wrapper.js"'),(0,n.kt)("span",{parentName:"code",className:"token punctuation"},","),"\n      ",(0,n.kt)("span",{parentName:"code",className:"token property"},'"require"'),(0,n.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,n.kt)("span",{parentName:"code",className:"token string"},'"./index.cjs"'),"\n    ",(0,n.kt)("span",{parentName:"code",className:"token punctuation"},"}"),(0,n.kt)("span",{parentName:"code",className:"token punctuation"},","),"\n    ",(0,n.kt)("span",{parentName:"code",className:"token property"},'"default"'),(0,n.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,n.kt)("span",{parentName:"code",className:"token string"},'"./index.js"'),"\n  ",(0,n.kt)("span",{parentName:"code",className:"token punctuation"},"}"),"\n",(0,n.kt)("span",{parentName:"code",className:"token punctuation"},"}"))),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"hljs language-js"},(0,n.kt)("span",{parentName:"code",className:"token comment"},"// wrapper.js"),"\n",(0,n.kt)("span",{parentName:"code",className:"token keyword"},"import")," cjs ",(0,n.kt)("span",{parentName:"code",className:"token keyword"},"from")," ",(0,n.kt)("span",{parentName:"code",className:"token string"},"'./index.cjs'"),(0,n.kt)("span",{parentName:"code",className:"token punctuation"},";"),"\n\n",(0,n.kt)("span",{parentName:"code",className:"token keyword"},"export")," ",(0,n.kt)("span",{parentName:"code",className:"token keyword"},"const")," ",(0,n.kt)("span",{parentName:"code",className:"token constant"},"A")," ",(0,n.kt)("span",{parentName:"code",className:"token operator"},"=")," cjs",(0,n.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,n.kt)("span",{parentName:"code",className:"token constant"},"A"),(0,n.kt)("span",{parentName:"code",className:"token punctuation"},";"),"\n",(0,n.kt)("span",{parentName:"code",className:"token keyword"},"export")," ",(0,n.kt)("span",{parentName:"code",className:"token keyword"},"const")," ",(0,n.kt)("span",{parentName:"code",className:"token constant"},"B")," ",(0,n.kt)("span",{parentName:"code",className:"token operator"},"=")," cjs",(0,n.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,n.kt)("span",{parentName:"code",className:"token constant"},"B"),(0,n.kt)("span",{parentName:"code",className:"token punctuation"},";"))),(0,n.kt)("p",null,"In a stateful package we must ensure that the package is never instantiated twice."),(0,n.kt)("p",null,"This isn't a problem for most tools, but Node.js is again an exception here.\nFor Node.js we always use the CommonJs version and expose named exports in the ESM with a ESM wrapper."),(0,n.kt)("p",null,"We use the ",(0,n.kt)("inlineCode",{parentName:"p"},"module")," condition as optimization again."),(0,n.kt)("h4",{id:"providing-only-a-commonjs-version"},"Providing only a CommonJs version",(0,n.kt)("a",{parentName:"h4",href:"#providing-only-a-commonjs-version","aria-hidden":"true",tabIndex:-1},(0,n.kt)("span",{parentName:"a",className:"header-link"}))),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"hljs language-json"},(0,n.kt)("span",{parentName:"code",className:"token punctuation"},"{"),"\n  ",(0,n.kt)("span",{parentName:"code",className:"token property"},'"type"'),(0,n.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,n.kt)("span",{parentName:"code",className:"token string"},'"commonjs"'),(0,n.kt)("span",{parentName:"code",className:"token punctuation"},","),"\n  ",(0,n.kt)("span",{parentName:"code",className:"token property"},'"exports"'),(0,n.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,n.kt)("span",{parentName:"code",className:"token string"},'"./index.js"'),"\n",(0,n.kt)("span",{parentName:"code",className:"token punctuation"},"}"))),(0,n.kt)("p",null,"Providing ",(0,n.kt)("inlineCode",{parentName:"p"},'"type": "commonjs"')," helps to statically detect CommonJs files."),(0,n.kt)("h4",{id:"providing-a-bundled-script-version-for-direct-browser-consumption"},"Providing a bundled script version for direct browser consumption",(0,n.kt)("a",{parentName:"h4",href:"#providing-a-bundled-script-version-for-direct-browser-consumption","aria-hidden":"true",tabIndex:-1},(0,n.kt)("span",{parentName:"a",className:"header-link"}))),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"hljs language-json"},(0,n.kt)("span",{parentName:"code",className:"token punctuation"},"{"),"\n  ",(0,n.kt)("span",{parentName:"code",className:"token property"},'"type"'),(0,n.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,n.kt)("span",{parentName:"code",className:"token string"},'"module"'),(0,n.kt)("span",{parentName:"code",className:"token punctuation"},","),"\n  ",(0,n.kt)("span",{parentName:"code",className:"token property"},'"exports"'),(0,n.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,n.kt)("span",{parentName:"code",className:"token punctuation"},"{"),"\n    ",(0,n.kt)("span",{parentName:"code",className:"token property"},'"script"'),(0,n.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,n.kt)("span",{parentName:"code",className:"token string"},'"./dist-bundle.js"'),(0,n.kt)("span",{parentName:"code",className:"token punctuation"},","),"\n    ",(0,n.kt)("span",{parentName:"code",className:"token property"},'"default"'),(0,n.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,n.kt)("span",{parentName:"code",className:"token string"},'"./index.js"'),"\n  ",(0,n.kt)("span",{parentName:"code",className:"token punctuation"},"}"),"\n",(0,n.kt)("span",{parentName:"code",className:"token punctuation"},"}"))),(0,n.kt)("p",null,"Note that despite using ",(0,n.kt)("inlineCode",{parentName:"p"},'"type": "module"')," and ",(0,n.kt)("inlineCode",{parentName:"p"},".js")," for ",(0,n.kt)("inlineCode",{parentName:"p"},"dist-bundle.js")," this file is not in ESM format.\nIt should use globals to allow direct consumption as script tag."),(0,n.kt)("h3",{id:"providing-devtools-or-production-optimizations"},"Providing devtools or production optimizations",(0,n.kt)("a",{parentName:"h3",href:"#providing-devtools-or-production-optimizations","aria-hidden":"true",tabIndex:-1},(0,n.kt)("span",{parentName:"a",className:"header-link"}))),(0,n.kt)("p",null,"These patterns make sense when a package contains two versions, one for development and one for production.\nE. g. the development version could include additional code for better error message or additional warnings."),(0,n.kt)("h4",{id:"without-nodejs-runtime-detection"},"Without Node.js runtime detection",(0,n.kt)("a",{parentName:"h4",href:"#without-nodejs-runtime-detection","aria-hidden":"true",tabIndex:-1},(0,n.kt)("span",{parentName:"a",className:"header-link"}))),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"hljs language-json"},(0,n.kt)("span",{parentName:"code",className:"token punctuation"},"{"),"\n  ",(0,n.kt)("span",{parentName:"code",className:"token property"},'"type"'),(0,n.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,n.kt)("span",{parentName:"code",className:"token string"},'"module"'),(0,n.kt)("span",{parentName:"code",className:"token punctuation"},","),"\n  ",(0,n.kt)("span",{parentName:"code",className:"token property"},'"exports"'),(0,n.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,n.kt)("span",{parentName:"code",className:"token punctuation"},"{"),"\n    ",(0,n.kt)("span",{parentName:"code",className:"token property"},'"development"'),(0,n.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,n.kt)("span",{parentName:"code",className:"token string"},'"./index-with-devtools.js"'),(0,n.kt)("span",{parentName:"code",className:"token punctuation"},","),"\n    ",(0,n.kt)("span",{parentName:"code",className:"token property"},'"default"'),(0,n.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,n.kt)("span",{parentName:"code",className:"token string"},'"./index-optimized.js"'),"\n  ",(0,n.kt)("span",{parentName:"code",className:"token punctuation"},"}"),"\n",(0,n.kt)("span",{parentName:"code",className:"token punctuation"},"}"))),(0,n.kt)("p",null,"When the ",(0,n.kt)("inlineCode",{parentName:"p"},"development")," condition is supported we use the version enhanced for development.\nOtherwise, in production or when mode is unknown, we use the optimized version."),(0,n.kt)("h4",{id:"with-nodejs-runtime-detection"},"With Node.js runtime detection",(0,n.kt)("a",{parentName:"h4",href:"#with-nodejs-runtime-detection","aria-hidden":"true",tabIndex:-1},(0,n.kt)("span",{parentName:"a",className:"header-link"}))),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"hljs language-json"},(0,n.kt)("span",{parentName:"code",className:"token punctuation"},"{"),"\n  ",(0,n.kt)("span",{parentName:"code",className:"token property"},'"type"'),(0,n.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,n.kt)("span",{parentName:"code",className:"token string"},'"module"'),(0,n.kt)("span",{parentName:"code",className:"token punctuation"},","),"\n  ",(0,n.kt)("span",{parentName:"code",className:"token property"},'"exports"'),(0,n.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,n.kt)("span",{parentName:"code",className:"token punctuation"},"{"),"\n    ",(0,n.kt)("span",{parentName:"code",className:"token property"},'"development"'),(0,n.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,n.kt)("span",{parentName:"code",className:"token string"},'"./index-with-devtools.js"'),(0,n.kt)("span",{parentName:"code",className:"token punctuation"},","),"\n    ",(0,n.kt)("span",{parentName:"code",className:"token property"},'"production"'),(0,n.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,n.kt)("span",{parentName:"code",className:"token string"},'"./index-optimized.js"'),(0,n.kt)("span",{parentName:"code",className:"token punctuation"},","),"\n    ",(0,n.kt)("span",{parentName:"code",className:"token property"},'"node"'),(0,n.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,n.kt)("span",{parentName:"code",className:"token string"},'"./wrapper-process-env.cjs"'),(0,n.kt)("span",{parentName:"code",className:"token punctuation"},","),"\n    ",(0,n.kt)("span",{parentName:"code",className:"token property"},'"default"'),(0,n.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,n.kt)("span",{parentName:"code",className:"token string"},'"./index-optimized.js"'),"\n  ",(0,n.kt)("span",{parentName:"code",className:"token punctuation"},"}"),"\n",(0,n.kt)("span",{parentName:"code",className:"token punctuation"},"}"))),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"hljs language-js"},(0,n.kt)("span",{parentName:"code",className:"token comment"},"// wrapper-process-env.cjs"),"\n",(0,n.kt)("span",{parentName:"code",className:"token keyword"},"if")," ",(0,n.kt)("span",{parentName:"code",className:"token punctuation"},"("),"process",(0,n.kt)("span",{parentName:"code",className:"token punctuation"},"."),"env",(0,n.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,n.kt)("span",{parentName:"code",className:"token constant"},"NODE_ENV")," ",(0,n.kt)("span",{parentName:"code",className:"token operator"},"!==")," ",(0,n.kt)("span",{parentName:"code",className:"token string"},"'development'"),(0,n.kt)("span",{parentName:"code",className:"token punctuation"},")")," ",(0,n.kt)("span",{parentName:"code",className:"token punctuation"},"{"),"\n  module",(0,n.kt)("span",{parentName:"code",className:"token punctuation"},"."),"exports ",(0,n.kt)("span",{parentName:"code",className:"token operator"},"=")," ",(0,n.kt)("span",{parentName:"code",className:"token function"},"require"),(0,n.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,n.kt)("span",{parentName:"code",className:"token string"},"'./index-optimized.cjs'"),(0,n.kt)("span",{parentName:"code",className:"token punctuation"},")"),(0,n.kt)("span",{parentName:"code",className:"token punctuation"},";"),"\n",(0,n.kt)("span",{parentName:"code",className:"token punctuation"},"}")," ",(0,n.kt)("span",{parentName:"code",className:"token keyword"},"else")," ",(0,n.kt)("span",{parentName:"code",className:"token punctuation"},"{"),"\n  module",(0,n.kt)("span",{parentName:"code",className:"token punctuation"},"."),"exports ",(0,n.kt)("span",{parentName:"code",className:"token operator"},"=")," ",(0,n.kt)("span",{parentName:"code",className:"token function"},"require"),(0,n.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,n.kt)("span",{parentName:"code",className:"token string"},"'./index-with-devtools.cjs'"),(0,n.kt)("span",{parentName:"code",className:"token punctuation"},")"),(0,n.kt)("span",{parentName:"code",className:"token punctuation"},";"),"\n",(0,n.kt)("span",{parentName:"code",className:"token punctuation"},"}"))),(0,n.kt)("p",null,"We prefer static detection of production/development mode via the ",(0,n.kt)("inlineCode",{parentName:"p"},"production")," or ",(0,n.kt)("inlineCode",{parentName:"p"},"development")," condition."),(0,n.kt)("p",null,"Node.js allows to detection production/development mode at runtime via ",(0,n.kt)("inlineCode",{parentName:"p"},"process.env.NODE_ENV"),", so we use that as fallback in Node.js. Sync conditional importing ESM is not possible and we don't want to load the package twice, so we have to use CommonJs for the runtime detection."),(0,n.kt)("p",null,"When it's not possible to detect mode we fallback to the production version."),(0,n.kt)("h3",{id:"providing-different-versions-depending-on-target-environment"},"Providing different versions depending on target environment",(0,n.kt)("a",{parentName:"h3",href:"#providing-different-versions-depending-on-target-environment","aria-hidden":"true",tabIndex:-1},(0,n.kt)("span",{parentName:"a",className:"header-link"}))),(0,n.kt)("p",null,"A fallback environment should be chosen that makes sense for the package to support future environments.\nIn general a browser-like environment should be assumed."),(0,n.kt)("h4",{id:"providing-nodejs-webworker-and-browser-versions"},"Providing Node.js, WebWorker and browser versions",(0,n.kt)("a",{parentName:"h4",href:"#providing-nodejs-webworker-and-browser-versions","aria-hidden":"true",tabIndex:-1},(0,n.kt)("span",{parentName:"a",className:"header-link"}))),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"hljs language-json"},(0,n.kt)("span",{parentName:"code",className:"token punctuation"},"{"),"\n  ",(0,n.kt)("span",{parentName:"code",className:"token property"},'"type"'),(0,n.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,n.kt)("span",{parentName:"code",className:"token string"},'"module"'),(0,n.kt)("span",{parentName:"code",className:"token punctuation"},","),"\n  ",(0,n.kt)("span",{parentName:"code",className:"token property"},'"exports"'),(0,n.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,n.kt)("span",{parentName:"code",className:"token punctuation"},"{"),"\n    ",(0,n.kt)("span",{parentName:"code",className:"token property"},'"node"'),(0,n.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,n.kt)("span",{parentName:"code",className:"token string"},'"./index-node.js"'),(0,n.kt)("span",{parentName:"code",className:"token punctuation"},","),"\n    ",(0,n.kt)("span",{parentName:"code",className:"token property"},'"worker"'),(0,n.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,n.kt)("span",{parentName:"code",className:"token string"},'"./index-worker.js"'),(0,n.kt)("span",{parentName:"code",className:"token punctuation"},","),"\n    ",(0,n.kt)("span",{parentName:"code",className:"token property"},'"default"'),(0,n.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,n.kt)("span",{parentName:"code",className:"token string"},'"./index.js"'),"\n  ",(0,n.kt)("span",{parentName:"code",className:"token punctuation"},"}"),"\n",(0,n.kt)("span",{parentName:"code",className:"token punctuation"},"}"))),(0,n.kt)("h4",{id:"providing-nodejs-browser-and-electron-versions"},"Providing Node.js, browser and electron versions",(0,n.kt)("a",{parentName:"h4",href:"#providing-nodejs-browser-and-electron-versions","aria-hidden":"true",tabIndex:-1},(0,n.kt)("span",{parentName:"a",className:"header-link"}))),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"hljs language-json"},(0,n.kt)("span",{parentName:"code",className:"token punctuation"},"{"),"\n  ",(0,n.kt)("span",{parentName:"code",className:"token property"},'"type"'),(0,n.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,n.kt)("span",{parentName:"code",className:"token string"},'"module"'),(0,n.kt)("span",{parentName:"code",className:"token punctuation"},","),"\n  ",(0,n.kt)("span",{parentName:"code",className:"token property"},'"exports"'),(0,n.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,n.kt)("span",{parentName:"code",className:"token punctuation"},"{"),"\n    ",(0,n.kt)("span",{parentName:"code",className:"token property"},'"electron"'),(0,n.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,n.kt)("span",{parentName:"code",className:"token punctuation"},"{"),"\n      ",(0,n.kt)("span",{parentName:"code",className:"token property"},'"node"'),(0,n.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,n.kt)("span",{parentName:"code",className:"token string"},'"./index-electron-node.js"'),(0,n.kt)("span",{parentName:"code",className:"token punctuation"},","),"\n      ",(0,n.kt)("span",{parentName:"code",className:"token property"},'"default"'),(0,n.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,n.kt)("span",{parentName:"code",className:"token string"},'"./index-electron.js"'),"\n    ",(0,n.kt)("span",{parentName:"code",className:"token punctuation"},"}"),(0,n.kt)("span",{parentName:"code",className:"token punctuation"},","),"\n    ",(0,n.kt)("span",{parentName:"code",className:"token property"},'"node"'),(0,n.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,n.kt)("span",{parentName:"code",className:"token string"},'"./index-node.js"'),(0,n.kt)("span",{parentName:"code",className:"token punctuation"},","),"\n    ",(0,n.kt)("span",{parentName:"code",className:"token property"},'"default"'),(0,n.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,n.kt)("span",{parentName:"code",className:"token string"},'"./index.js"'),"\n  ",(0,n.kt)("span",{parentName:"code",className:"token punctuation"},"}"),"\n",(0,n.kt)("span",{parentName:"code",className:"token punctuation"},"}"))),(0,n.kt)("h3",{id:"combining-patterns"},"Combining patterns",(0,n.kt)("a",{parentName:"h3",href:"#combining-patterns","aria-hidden":"true",tabIndex:-1},(0,n.kt)("span",{parentName:"a",className:"header-link"}))),(0,n.kt)("h4",{id:"example-1"},"Example 1",(0,n.kt)("a",{parentName:"h4",href:"#example-1","aria-hidden":"true",tabIndex:-1},(0,n.kt)("span",{parentName:"a",className:"header-link"}))),(0,n.kt)("p",null,"This is an example for a package that has optimizations for production and development usage with runtime detection for ",(0,n.kt)("inlineCode",{parentName:"p"},"process.env")," and also ships a CommonJs and ESM version"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"hljs language-json"},(0,n.kt)("span",{parentName:"code",className:"token punctuation"},"{"),"\n  ",(0,n.kt)("span",{parentName:"code",className:"token property"},'"type"'),(0,n.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,n.kt)("span",{parentName:"code",className:"token string"},'"module"'),(0,n.kt)("span",{parentName:"code",className:"token punctuation"},","),"\n  ",(0,n.kt)("span",{parentName:"code",className:"token property"},'"exports"'),(0,n.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,n.kt)("span",{parentName:"code",className:"token punctuation"},"{"),"\n    ",(0,n.kt)("span",{parentName:"code",className:"token property"},'"node"'),(0,n.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,n.kt)("span",{parentName:"code",className:"token punctuation"},"{"),"\n      ",(0,n.kt)("span",{parentName:"code",className:"token property"},'"development"'),(0,n.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,n.kt)("span",{parentName:"code",className:"token punctuation"},"{"),"\n        ",(0,n.kt)("span",{parentName:"code",className:"token property"},'"module"'),(0,n.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,n.kt)("span",{parentName:"code",className:"token string"},'"./index-with-devtools.js"'),(0,n.kt)("span",{parentName:"code",className:"token punctuation"},","),"\n        ",(0,n.kt)("span",{parentName:"code",className:"token property"},'"import"'),(0,n.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,n.kt)("span",{parentName:"code",className:"token string"},'"./wrapper-with-devtools.js"'),(0,n.kt)("span",{parentName:"code",className:"token punctuation"},","),"\n        ",(0,n.kt)("span",{parentName:"code",className:"token property"},'"require"'),(0,n.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,n.kt)("span",{parentName:"code",className:"token string"},'"./index-with-devtools.cjs"'),"\n      ",(0,n.kt)("span",{parentName:"code",className:"token punctuation"},"}"),(0,n.kt)("span",{parentName:"code",className:"token punctuation"},","),"\n      ",(0,n.kt)("span",{parentName:"code",className:"token property"},'"production"'),(0,n.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,n.kt)("span",{parentName:"code",className:"token punctuation"},"{"),"\n        ",(0,n.kt)("span",{parentName:"code",className:"token property"},'"module"'),(0,n.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,n.kt)("span",{parentName:"code",className:"token string"},'"./index-optimized.js"'),(0,n.kt)("span",{parentName:"code",className:"token punctuation"},","),"\n        ",(0,n.kt)("span",{parentName:"code",className:"token property"},'"import"'),(0,n.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,n.kt)("span",{parentName:"code",className:"token string"},'"./wrapper-optimized.js"'),(0,n.kt)("span",{parentName:"code",className:"token punctuation"},","),"\n        ",(0,n.kt)("span",{parentName:"code",className:"token property"},'"require"'),(0,n.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,n.kt)("span",{parentName:"code",className:"token string"},'"./index-optimized.cjs"'),"\n      ",(0,n.kt)("span",{parentName:"code",className:"token punctuation"},"}"),(0,n.kt)("span",{parentName:"code",className:"token punctuation"},","),"\n      ",(0,n.kt)("span",{parentName:"code",className:"token property"},'"default"'),(0,n.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,n.kt)("span",{parentName:"code",className:"token string"},'"./wrapper-process-env.cjs"'),"\n    ",(0,n.kt)("span",{parentName:"code",className:"token punctuation"},"}"),(0,n.kt)("span",{parentName:"code",className:"token punctuation"},","),"\n    ",(0,n.kt)("span",{parentName:"code",className:"token property"},'"development"'),(0,n.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,n.kt)("span",{parentName:"code",className:"token string"},'"./index-with-devtools.js"'),(0,n.kt)("span",{parentName:"code",className:"token punctuation"},","),"\n    ",(0,n.kt)("span",{parentName:"code",className:"token property"},'"production"'),(0,n.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,n.kt)("span",{parentName:"code",className:"token string"},'"./index-optimized.js"'),(0,n.kt)("span",{parentName:"code",className:"token punctuation"},","),"\n    ",(0,n.kt)("span",{parentName:"code",className:"token property"},'"default"'),(0,n.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,n.kt)("span",{parentName:"code",className:"token string"},'"./index-optimized.js"'),"\n  ",(0,n.kt)("span",{parentName:"code",className:"token punctuation"},"}"),"\n",(0,n.kt)("span",{parentName:"code",className:"token punctuation"},"}"))),(0,n.kt)("h4",{id:"example-2"},"Example 2",(0,n.kt)("a",{parentName:"h4",href:"#example-2","aria-hidden":"true",tabIndex:-1},(0,n.kt)("span",{parentName:"a",className:"header-link"}))),(0,n.kt)("p",null,"This is an example for a package that supports Node.js, browser and electron, has optimizations for production and development usage with runtime detection for ",(0,n.kt)("inlineCode",{parentName:"p"},"process.env")," and also ships a CommonJs and ESM version."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"hljs language-json"},(0,n.kt)("span",{parentName:"code",className:"token punctuation"},"{"),"\n  ",(0,n.kt)("span",{parentName:"code",className:"token property"},'"type"'),(0,n.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,n.kt)("span",{parentName:"code",className:"token string"},'"module"'),(0,n.kt)("span",{parentName:"code",className:"token punctuation"},","),"\n  ",(0,n.kt)("span",{parentName:"code",className:"token property"},'"exports"'),(0,n.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,n.kt)("span",{parentName:"code",className:"token punctuation"},"{"),"\n    ",(0,n.kt)("span",{parentName:"code",className:"token property"},'"electron"'),(0,n.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,n.kt)("span",{parentName:"code",className:"token punctuation"},"{"),"\n      ",(0,n.kt)("span",{parentName:"code",className:"token property"},'"node"'),(0,n.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,n.kt)("span",{parentName:"code",className:"token punctuation"},"{"),"\n        ",(0,n.kt)("span",{parentName:"code",className:"token property"},'"development"'),(0,n.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,n.kt)("span",{parentName:"code",className:"token punctuation"},"{"),"\n          ",(0,n.kt)("span",{parentName:"code",className:"token property"},'"module"'),(0,n.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,n.kt)("span",{parentName:"code",className:"token string"},'"./index-electron-node-with-devtools.js"'),(0,n.kt)("span",{parentName:"code",className:"token punctuation"},","),"\n          ",(0,n.kt)("span",{parentName:"code",className:"token property"},'"import"'),(0,n.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,n.kt)("span",{parentName:"code",className:"token string"},'"./wrapper-electron-node-with-devtools.js"'),(0,n.kt)("span",{parentName:"code",className:"token punctuation"},","),"\n          ",(0,n.kt)("span",{parentName:"code",className:"token property"},'"require"'),(0,n.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,n.kt)("span",{parentName:"code",className:"token string"},'"./index-electron-node-with-devtools.cjs"'),"\n        ",(0,n.kt)("span",{parentName:"code",className:"token punctuation"},"}"),(0,n.kt)("span",{parentName:"code",className:"token punctuation"},","),"\n        ",(0,n.kt)("span",{parentName:"code",className:"token property"},'"production"'),(0,n.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,n.kt)("span",{parentName:"code",className:"token punctuation"},"{"),"\n          ",(0,n.kt)("span",{parentName:"code",className:"token property"},'"module"'),(0,n.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,n.kt)("span",{parentName:"code",className:"token string"},'"./index-electron-node-optimized.js"'),(0,n.kt)("span",{parentName:"code",className:"token punctuation"},","),"\n          ",(0,n.kt)("span",{parentName:"code",className:"token property"},'"import"'),(0,n.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,n.kt)("span",{parentName:"code",className:"token string"},'"./wrapper-electron-node-optimized.js"'),(0,n.kt)("span",{parentName:"code",className:"token punctuation"},","),"\n          ",(0,n.kt)("span",{parentName:"code",className:"token property"},'"require"'),(0,n.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,n.kt)("span",{parentName:"code",className:"token string"},'"./index-electron-node-optimized.cjs"'),"\n        ",(0,n.kt)("span",{parentName:"code",className:"token punctuation"},"}"),(0,n.kt)("span",{parentName:"code",className:"token punctuation"},","),"\n        ",(0,n.kt)("span",{parentName:"code",className:"token property"},'"default"'),(0,n.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,n.kt)("span",{parentName:"code",className:"token string"},'"./wrapper-electron-node-process-env.cjs"'),"\n      ",(0,n.kt)("span",{parentName:"code",className:"token punctuation"},"}"),(0,n.kt)("span",{parentName:"code",className:"token punctuation"},","),"\n      ",(0,n.kt)("span",{parentName:"code",className:"token property"},'"development"'),(0,n.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,n.kt)("span",{parentName:"code",className:"token string"},'"./index-electron-with-devtools.js"'),(0,n.kt)("span",{parentName:"code",className:"token punctuation"},","),"\n      ",(0,n.kt)("span",{parentName:"code",className:"token property"},'"production"'),(0,n.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,n.kt)("span",{parentName:"code",className:"token string"},'"./index-electron-optimized.js"'),(0,n.kt)("span",{parentName:"code",className:"token punctuation"},","),"\n      ",(0,n.kt)("span",{parentName:"code",className:"token property"},'"default"'),(0,n.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,n.kt)("span",{parentName:"code",className:"token string"},'"./index-electron-optimized.js"'),"\n    ",(0,n.kt)("span",{parentName:"code",className:"token punctuation"},"}"),(0,n.kt)("span",{parentName:"code",className:"token punctuation"},","),"\n    ",(0,n.kt)("span",{parentName:"code",className:"token property"},'"node"'),(0,n.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,n.kt)("span",{parentName:"code",className:"token punctuation"},"{"),"\n      ",(0,n.kt)("span",{parentName:"code",className:"token property"},'"development"'),(0,n.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,n.kt)("span",{parentName:"code",className:"token punctuation"},"{"),"\n        ",(0,n.kt)("span",{parentName:"code",className:"token property"},'"module"'),(0,n.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,n.kt)("span",{parentName:"code",className:"token string"},'"./index-node-with-devtools.js"'),(0,n.kt)("span",{parentName:"code",className:"token punctuation"},","),"\n        ",(0,n.kt)("span",{parentName:"code",className:"token property"},'"import"'),(0,n.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,n.kt)("span",{parentName:"code",className:"token string"},'"./wrapper-node-with-devtools.js"'),(0,n.kt)("span",{parentName:"code",className:"token punctuation"},","),"\n        ",(0,n.kt)("span",{parentName:"code",className:"token property"},'"require"'),(0,n.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,n.kt)("span",{parentName:"code",className:"token string"},'"./index-node-with-devtools.cjs"'),"\n      ",(0,n.kt)("span",{parentName:"code",className:"token punctuation"},"}"),(0,n.kt)("span",{parentName:"code",className:"token punctuation"},","),"\n      ",(0,n.kt)("span",{parentName:"code",className:"token property"},'"production"'),(0,n.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,n.kt)("span",{parentName:"code",className:"token punctuation"},"{"),"\n        ",(0,n.kt)("span",{parentName:"code",className:"token property"},'"module"'),(0,n.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,n.kt)("span",{parentName:"code",className:"token string"},'"./index-node-optimized.js"'),(0,n.kt)("span",{parentName:"code",className:"token punctuation"},","),"\n        ",(0,n.kt)("span",{parentName:"code",className:"token property"},'"import"'),(0,n.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,n.kt)("span",{parentName:"code",className:"token string"},'"./wrapper-node-optimized.js"'),(0,n.kt)("span",{parentName:"code",className:"token punctuation"},","),"\n        ",(0,n.kt)("span",{parentName:"code",className:"token property"},'"require"'),(0,n.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,n.kt)("span",{parentName:"code",className:"token string"},'"./index-node-optimized.cjs"'),"\n      ",(0,n.kt)("span",{parentName:"code",className:"token punctuation"},"}"),(0,n.kt)("span",{parentName:"code",className:"token punctuation"},","),"\n      ",(0,n.kt)("span",{parentName:"code",className:"token property"},'"default"'),(0,n.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,n.kt)("span",{parentName:"code",className:"token string"},'"./wrapper-node-process-env.cjs"'),"\n    ",(0,n.kt)("span",{parentName:"code",className:"token punctuation"},"}"),(0,n.kt)("span",{parentName:"code",className:"token punctuation"},","),"\n    ",(0,n.kt)("span",{parentName:"code",className:"token property"},'"development"'),(0,n.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,n.kt)("span",{parentName:"code",className:"token string"},'"./index-with-devtools.js"'),(0,n.kt)("span",{parentName:"code",className:"token punctuation"},","),"\n    ",(0,n.kt)("span",{parentName:"code",className:"token property"},'"production"'),(0,n.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,n.kt)("span",{parentName:"code",className:"token string"},'"./index-optimized.js"'),(0,n.kt)("span",{parentName:"code",className:"token punctuation"},","),"\n    ",(0,n.kt)("span",{parentName:"code",className:"token property"},'"default"'),(0,n.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,n.kt)("span",{parentName:"code",className:"token string"},'"./index-optimized.js"'),"\n  ",(0,n.kt)("span",{parentName:"code",className:"token punctuation"},"}"),"\n",(0,n.kt)("span",{parentName:"code",className:"token punctuation"},"}"))),(0,n.kt)("p",null,"Looks complex, yes. We were already able to reduce some complexity due to a assumption we can make: Only ",(0,n.kt)("inlineCode",{parentName:"p"},"node")," need a CommonJs version and can detect production/development with ",(0,n.kt)("inlineCode",{parentName:"p"},"process.env"),"."),(0,n.kt)("h2",{id:"guidelines"},"Guidelines",(0,n.kt)("a",{parentName:"h2",href:"#guidelines","aria-hidden":"true",tabIndex:-1},(0,n.kt)("span",{parentName:"a",className:"header-link"}))),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"Avoid the ",(0,n.kt)("inlineCode",{parentName:"li"},"default")," export. It's handled differently between tooling. Only use named exports."),(0,n.kt)("li",{parentName:"ul"},"Never provide different APIs or semantics for different conditions."),(0,n.kt)("li",{parentName:"ul"},"Write your source code as ESM and transpile to CJS via babel, typescript or similar tools."),(0,n.kt)("li",{parentName:"ul"},"Either use ",(0,n.kt)("inlineCode",{parentName:"li"},".cjs")," or ",(0,n.kt)("inlineCode",{parentName:"li"},'type: "commonjs"')," in package.json to clearly mark source code as CommonJs. This makes it statically detectable for tools if CommonJs or ESM is used. This is important for tools that only support ESM and no CommonJs."),(0,n.kt)("li",{parentName:"ul"},"ESM used in packages support the following types of requests:",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"module requests are supported, pointing to other packages with a package.json."),(0,n.kt)("li",{parentName:"ul"},"relative requests are supported, pointing to other files within the package.",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"They must not point to files outside of the package."))),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("inlineCode",{parentName:"li"},"data:")," url requests are supported."),(0,n.kt)("li",{parentName:"ul"},"other absolute or server-relative requests are not supported by default, but they might be supported by some tools or environments.")))))}s.isMDXComponent=!0}}]);