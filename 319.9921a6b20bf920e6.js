"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[319],{319:function(e,n,s){s.r(n),s.d(n,{default:function(){return c}});var a=s(2540),t=s(3317);function i(e){const n={a:"a",aside:"aside",code:"code",em:"em",h2:"h2",h3:"h3",h4:"h4",h6:"h6",li:"li",ol:"ol",p:"p",pre:"pre",span:"span",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.em,{children:"Tree shaking"})," is a term commonly used in the JavaScript context for dead-code elimination. It relies on the ",(0,a.jsx)(n.a,{href:"http://exploringjs.com/es6/ch_modules.html#static-module-structure",children:"static structure"})," of ES2015 module syntax, i.e. ",(0,a.jsx)(n.a,{href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/import",children:(0,a.jsx)(n.code,{children:"import"})})," and ",(0,a.jsx)(n.a,{href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/export",children:(0,a.jsx)(n.code,{children:"export"})}),". The name and concept have been popularized by the ES2015 module bundler ",(0,a.jsx)(n.a,{href:"https://github.com/rollup/rollup",children:"rollup"}),"."]}),"\n",(0,a.jsxs)(n.p,{children:["The webpack 2 release came with built-in support for ES2015 modules (alias ",(0,a.jsx)(n.em,{children:"harmony modules"}),") as well as unused module export detection. The new webpack 4 release expands on this capability with a way to provide hints to the compiler via the ",(0,a.jsx)(n.code,{children:'"sideEffects"'})," ",(0,a.jsx)(n.code,{children:"package.json"}),' property to denote which files in your project are "pure" and therefore safe to prune if unused.']}),"\n",(0,a.jsxs)(n.aside,{className:"tip",children:[(0,a.jsx)(n.h6,{className:"tip__prefix",children:"tip"}),(0,a.jsxs)(n.p,{children:["The remainder of this guide will stem from ",(0,a.jsx)(n.a,{href:"/guides/getting-started",children:"Getting Started"}),". If you haven't read through that guide already, please do so now."]})]}),"\n",(0,a.jsxs)(n.h2,{children:[(0,a.jsx)(n.span,{id:"add-a-utility"}),"Add a Utility",(0,a.jsx)(n.a,{href:"#add-a-utility","aria-hidden":"true",tabIndex:"-1",children:(0,a.jsx)(n.span,{className:"header-link"})})]}),"\n",(0,a.jsxs)(n.p,{children:["Let's add a new utility file to our project, ",(0,a.jsx)(n.code,{children:"src/math.js"}),", that exports two functions:"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"project"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsxs)(n.code,{className:"hljs language-diff",children:["webpack-demo\n|- package.json\n|- package-lock.json\n|- webpack.config.js\n|- /dist\n",(0,a.jsxs)(n.span,{className:"token unchanged",children:[(0,a.jsx)(n.span,{className:"token prefix unchanged",children:" "}),(0,a.jsx)(n.span,{className:"token line",children:" |- bundle.js\n"}),(0,a.jsx)(n.span,{className:"token prefix unchanged",children:" "}),(0,a.jsx)(n.span,{className:"token line",children:" |- index.html\n"})]}),"|- /src\n",(0,a.jsxs)(n.span,{className:"token unchanged",children:[(0,a.jsx)(n.span,{className:"token prefix unchanged",children:" "}),(0,a.jsx)(n.span,{className:"token line",children:" |- index.js\n"})]}),(0,a.jsxs)(n.span,{className:"token inserted-sign inserted",children:[(0,a.jsx)(n.span,{className:"token prefix inserted",children:"+"}),(0,a.jsx)(n.span,{className:"token line",children:" |- math.js\n"})]}),"|- /node_modules"]})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"src/math.js"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsxs)(n.code,{className:"hljs language-javascript",children:[(0,a.jsx)(n.span,{className:"token keyword",children:"export"})," ",(0,a.jsx)(n.span,{className:"token keyword",children:"function"})," ",(0,a.jsx)(n.span,{className:"token function",children:"square"}),(0,a.jsx)(n.span,{className:"token punctuation",children:"("}),(0,a.jsx)(n.span,{className:"token parameter",children:"x"}),(0,a.jsx)(n.span,{className:"token punctuation",children:")"})," ",(0,a.jsx)(n.span,{className:"token punctuation",children:"{"}),"\n  ",(0,a.jsx)(n.span,{className:"token keyword",children:"return"})," x ",(0,a.jsx)(n.span,{className:"token operator",children:"*"})," x",(0,a.jsx)(n.span,{className:"token punctuation",children:";"}),"\n",(0,a.jsx)(n.span,{className:"token punctuation",children:"}"}),"\n\n",(0,a.jsx)(n.span,{className:"token keyword",children:"export"})," ",(0,a.jsx)(n.span,{className:"token keyword",children:"function"})," ",(0,a.jsx)(n.span,{className:"token function",children:"cube"}),(0,a.jsx)(n.span,{className:"token punctuation",children:"("}),(0,a.jsx)(n.span,{className:"token parameter",children:"x"}),(0,a.jsx)(n.span,{className:"token punctuation",children:")"})," ",(0,a.jsx)(n.span,{className:"token punctuation",children:"{"}),"\n  ",(0,a.jsx)(n.span,{className:"token keyword",children:"return"})," x ",(0,a.jsx)(n.span,{className:"token operator",children:"*"})," x ",(0,a.jsx)(n.span,{className:"token operator",children:"*"})," x",(0,a.jsx)(n.span,{className:"token punctuation",children:";"}),"\n",(0,a.jsx)(n.span,{className:"token punctuation",children:"}"})]})}),"\n",(0,a.jsxs)(n.p,{children:["Set the ",(0,a.jsx)(n.code,{children:"mode"})," configuration option to ",(0,a.jsx)(n.a,{href:"/configuration/mode/#mode-development",children:"development"})," to make sure that the bundle is not minified:"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"webpack.config.js"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsxs)(n.code,{className:"hljs language-diff",children:["const path = require('path');\n\nmodule.exports = {\n",(0,a.jsxs)(n.span,{className:"token unchanged",children:[(0,a.jsx)(n.span,{className:"token prefix unchanged",children:" "}),(0,a.jsx)(n.span,{className:"token line",children:" entry: './src/index.js',\n"}),(0,a.jsx)(n.span,{className:"token prefix unchanged",children:" "}),(0,a.jsx)(n.span,{className:"token line",children:" output: {\n"}),(0,a.jsx)(n.span,{className:"token prefix unchanged",children:" "}),(0,a.jsx)(n.span,{className:"token line",children:"   filename: 'bundle.js',\n"}),(0,a.jsx)(n.span,{className:"token prefix unchanged",children:" "}),(0,a.jsx)(n.span,{className:"token line",children:"   path: path.resolve(__dirname, 'dist'),\n"}),(0,a.jsx)(n.span,{className:"token prefix unchanged",children:" "}),(0,a.jsx)(n.span,{className:"token line",children:" },\n"})]}),(0,a.jsxs)(n.span,{className:"token inserted-sign inserted",children:[(0,a.jsx)(n.span,{className:"token prefix inserted",children:"+"}),(0,a.jsx)(n.span,{className:"token line",children:" mode: 'development',\n"}),(0,a.jsx)(n.span,{className:"token prefix inserted",children:"+"}),(0,a.jsx)(n.span,{className:"token line",children:" optimization: {\n"}),(0,a.jsx)(n.span,{className:"token prefix inserted",children:"+"}),(0,a.jsx)(n.span,{className:"token line",children:"   usedExports: true,\n"}),(0,a.jsx)(n.span,{className:"token prefix inserted",children:"+"}),(0,a.jsx)(n.span,{className:"token line",children:" },\n"})]}),"};"]})}),"\n",(0,a.jsxs)(n.p,{children:["With that in place, let's update our entry script to utilize one of these new methods and remove ",(0,a.jsx)(n.code,{children:"lodash"})," for simplicity:"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"src/index.js"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsxs)(n.code,{className:"hljs language-diff",children:[(0,a.jsxs)(n.span,{className:"token deleted-sign deleted",children:[(0,a.jsx)(n.span,{className:"token prefix deleted",children:"-"}),(0,a.jsx)(n.span,{className:"token line",children:" import _ from 'lodash';\n"})]}),(0,a.jsxs)(n.span,{className:"token inserted-sign inserted",children:[(0,a.jsx)(n.span,{className:"token prefix inserted",children:"+"}),(0,a.jsx)(n.span,{className:"token line",children:" import { cube } from './math.js';\n"})]}),"\n",(0,a.jsxs)(n.span,{className:"token unchanged",children:[(0,a.jsx)(n.span,{className:"token prefix unchanged",children:" "}),(0,a.jsx)(n.span,{className:"token line",children:" function component() {\n"})]}),(0,a.jsxs)(n.span,{className:"token deleted-sign deleted",children:[(0,a.jsx)(n.span,{className:"token prefix deleted",children:"-"}),(0,a.jsx)(n.span,{className:"token line",children:"   const element = document.createElement('div');\n"})]}),(0,a.jsxs)(n.span,{className:"token inserted-sign inserted",children:[(0,a.jsx)(n.span,{className:"token prefix inserted",children:"+"}),(0,a.jsx)(n.span,{className:"token line",children:"   const element = document.createElement('pre');\n"})]}),"\n",(0,a.jsxs)(n.span,{className:"token deleted-sign deleted",children:[(0,a.jsx)(n.span,{className:"token prefix deleted",children:"-"}),(0,a.jsx)(n.span,{className:"token line",children:"   // Lodash, now imported by this script\n"}),(0,a.jsx)(n.span,{className:"token prefix deleted",children:"-"}),(0,a.jsx)(n.span,{className:"token line",children:"   element.innerHTML = _.join(['Hello', 'webpack'], ' ');\n"})]}),(0,a.jsxs)(n.span,{className:"token inserted-sign inserted",children:[(0,a.jsx)(n.span,{className:"token prefix inserted",children:"+"}),(0,a.jsx)(n.span,{className:"token line",children:"   element.innerHTML = [\n"}),(0,a.jsx)(n.span,{className:"token prefix inserted",children:"+"}),(0,a.jsx)(n.span,{className:"token line",children:"     'Hello webpack!',\n"}),(0,a.jsx)(n.span,{className:"token prefix inserted",children:"+"}),(0,a.jsx)(n.span,{className:"token line",children:"     '5 cubed is equal to ' + cube(5)\n"}),(0,a.jsx)(n.span,{className:"token prefix inserted",children:"+"}),(0,a.jsx)(n.span,{className:"token line",children:"   ].join('\\n\\n');\n"})]}),"\n",(0,a.jsxs)(n.span,{className:"token unchanged",children:[(0,a.jsx)(n.span,{className:"token prefix unchanged",children:" "}),(0,a.jsx)(n.span,{className:"token line",children:"   return element;\n"}),(0,a.jsx)(n.span,{className:"token prefix unchanged",children:" "}),(0,a.jsx)(n.span,{className:"token line",children:" }\n"})]}),"\n",(0,a.jsxs)(n.span,{className:"token unchanged",children:[(0,a.jsx)(n.span,{className:"token prefix unchanged",children:" "}),(0,a.jsx)(n.span,{className:"token line",children:" document.body.appendChild(component());"})]})]})}),"\n",(0,a.jsxs)(n.p,{children:["Note that we ",(0,a.jsxs)(n.strong,{children:["did not ",(0,a.jsx)(n.code,{children:"import"})," the ",(0,a.jsx)(n.code,{children:"square"})," method"]})," from the ",(0,a.jsx)(n.code,{children:"src/math.js"}),' module. That function is what\'s known as "dead code", meaning an unused ',(0,a.jsx)(n.code,{children:"export"})," that should be dropped. Now let's run our npm script, ",(0,a.jsx)(n.code,{children:"npm run build"}),", and inspect the output bundle:"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"dist/bundle.js (around lines 90 - 100)"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsxs)(n.code,{className:"hljs language-js",children:[(0,a.jsx)(n.span,{className:"token comment",children:"/* 1 */"}),"\n",(0,a.jsx)(n.span,{className:"token comment",children:"/***/"})," ",(0,a.jsx)(n.span,{className:"token punctuation",children:"("}),(0,a.jsx)(n.span,{className:"token keyword",children:"function"})," ",(0,a.jsx)(n.span,{className:"token punctuation",children:"("}),(0,a.jsxs)(n.span,{className:"token parameter",children:["module",(0,a.jsx)(n.span,{className:"token punctuation",children:","})," __webpack_exports__",(0,a.jsx)(n.span,{className:"token punctuation",children:","})," __webpack_require__"]}),(0,a.jsx)(n.span,{className:"token punctuation",children:")"})," ",(0,a.jsx)(n.span,{className:"token punctuation",children:"{"}),"\n  ",(0,a.jsx)(n.span,{className:"token string",children:"'use strict'"}),(0,a.jsx)(n.span,{className:"token punctuation",children:";"}),"\n  ",(0,a.jsx)(n.span,{className:"token comment",children:"/* unused harmony export square */"}),"\n  ",(0,a.jsx)(n.span,{className:"token comment",children:"/* harmony export (immutable) */"})," __webpack_exports__",(0,a.jsx)(n.span,{className:"token punctuation",children:"["}),(0,a.jsx)(n.span,{className:"token string",children:"'a'"}),(0,a.jsx)(n.span,{className:"token punctuation",children:"]"})," ",(0,a.jsx)(n.span,{className:"token operator",children:"="})," cube",(0,a.jsx)(n.span,{className:"token punctuation",children:";"}),"\n  ",(0,a.jsx)(n.span,{className:"token keyword",children:"function"})," ",(0,a.jsx)(n.span,{className:"token function",children:"square"}),(0,a.jsx)(n.span,{className:"token punctuation",children:"("}),(0,a.jsx)(n.span,{className:"token parameter",children:"x"}),(0,a.jsx)(n.span,{className:"token punctuation",children:")"})," ",(0,a.jsx)(n.span,{className:"token punctuation",children:"{"}),"\n    ",(0,a.jsx)(n.span,{className:"token keyword",children:"return"})," x ",(0,a.jsx)(n.span,{className:"token operator",children:"*"})," x",(0,a.jsx)(n.span,{className:"token punctuation",children:";"}),"\n  ",(0,a.jsx)(n.span,{className:"token punctuation",children:"}"}),"\n\n  ",(0,a.jsx)(n.span,{className:"token keyword",children:"function"})," ",(0,a.jsx)(n.span,{className:"token function",children:"cube"}),(0,a.jsx)(n.span,{className:"token punctuation",children:"("}),(0,a.jsx)(n.span,{className:"token parameter",children:"x"}),(0,a.jsx)(n.span,{className:"token punctuation",children:")"})," ",(0,a.jsx)(n.span,{className:"token punctuation",children:"{"}),"\n    ",(0,a.jsx)(n.span,{className:"token keyword",children:"return"})," x ",(0,a.jsx)(n.span,{className:"token operator",children:"*"})," x ",(0,a.jsx)(n.span,{className:"token operator",children:"*"})," x",(0,a.jsx)(n.span,{className:"token punctuation",children:";"}),"\n  ",(0,a.jsx)(n.span,{className:"token punctuation",children:"}"}),"\n",(0,a.jsx)(n.span,{className:"token punctuation",children:"}"}),(0,a.jsx)(n.span,{className:"token punctuation",children:")"}),(0,a.jsx)(n.span,{className:"token punctuation",children:";"})]})}),"\n",(0,a.jsxs)(n.p,{children:["Note the ",(0,a.jsx)(n.code,{children:"unused harmony export square"})," comment above. If you look at the code below it, you'll notice that ",(0,a.jsx)(n.code,{children:"square"})," is not being imported, however, it is still included in the bundle. We'll fix that in the next section."]}),"\n",(0,a.jsxs)(n.h2,{children:[(0,a.jsx)(n.span,{id:"mark-the-file-as-side-effect-free"}),"Mark the file as side-effect-free",(0,a.jsx)(n.a,{href:"#mark-the-file-as-side-effect-free","aria-hidden":"true",tabIndex:"-1",children:(0,a.jsx)(n.span,{className:"header-link"})})]}),"\n",(0,a.jsx)(n.p,{children:"In a 100% ESM module world, identifying side effects is straightforward. However, we aren't there quite yet, so in the mean time it's necessary to provide hints to webpack's compiler on the \"pureness\" of your code."}),"\n",(0,a.jsxs)(n.p,{children:["The way this is accomplished is the ",(0,a.jsx)(n.code,{children:'"sideEffects"'})," package.json property."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsxs)(n.code,{className:"hljs language-json",children:[(0,a.jsx)(n.span,{className:"token punctuation",children:"{"}),"\n  ",(0,a.jsx)(n.span,{className:"token property",children:'"name"'}),(0,a.jsx)(n.span,{className:"token operator",children:":"})," ",(0,a.jsx)(n.span,{className:"token string",children:'"your-project"'}),(0,a.jsx)(n.span,{className:"token punctuation",children:","}),"\n  ",(0,a.jsx)(n.span,{className:"token property",children:'"sideEffects"'}),(0,a.jsx)(n.span,{className:"token operator",children:":"})," ",(0,a.jsx)(n.span,{className:"token boolean",children:"false"}),"\n",(0,a.jsx)(n.span,{className:"token punctuation",children:"}"})]})}),"\n",(0,a.jsxs)(n.p,{children:["All the code noted above does not contain side effects, so we can mark the property as ",(0,a.jsx)(n.code,{children:"false"})," to inform webpack that it can safely prune unused exports."]}),"\n",(0,a.jsxs)(n.aside,{className:"tip",children:[(0,a.jsx)(n.h6,{className:"tip__prefix",children:"tip"}),(0,a.jsx)(n.p,{children:'A "side effect" is defined as code that performs a special behavior when imported, other than exposing one or more exports. An example of this are polyfills, which affect the global scope and usually do not provide an export.'})]}),"\n",(0,a.jsx)(n.p,{children:"If your code did have some side effects though, an array can be provided instead:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsxs)(n.code,{className:"hljs language-json",children:[(0,a.jsx)(n.span,{className:"token punctuation",children:"{"}),"\n  ",(0,a.jsx)(n.span,{className:"token property",children:'"name"'}),(0,a.jsx)(n.span,{className:"token operator",children:":"})," ",(0,a.jsx)(n.span,{className:"token string",children:'"your-project"'}),(0,a.jsx)(n.span,{className:"token punctuation",children:","}),"\n  ",(0,a.jsx)(n.span,{className:"token property",children:'"sideEffects"'}),(0,a.jsx)(n.span,{className:"token operator",children:":"})," ",(0,a.jsx)(n.span,{className:"token punctuation",children:"["}),(0,a.jsx)(n.span,{className:"token string",children:'"./src/some-side-effectful-file.js"'}),(0,a.jsx)(n.span,{className:"token punctuation",children:"]"}),"\n",(0,a.jsx)(n.span,{className:"token punctuation",children:"}"})]})}),"\n",(0,a.jsxs)(n.p,{children:["The array accepts simple glob patterns to the relevant files. It uses ",(0,a.jsx)(n.a,{href:"https://github.com/fitzgen/glob-to-regexp",children:"glob-to-regexp"})," under the hood (Supports: ",(0,a.jsx)(n.code,{children:"*"}),", ",(0,a.jsx)(n.code,{children:"**"}),", ",(0,a.jsx)(n.code,{children:"{a,b}"}),", ",(0,a.jsx)(n.code,{children:"[a-z]"}),"). Patterns like ",(0,a.jsx)(n.code,{children:"*.css"}),", which do not include a ",(0,a.jsx)(n.code,{children:"/"}),", will be treated like ",(0,a.jsx)(n.code,{children:"**/*.css"}),"."]}),"\n",(0,a.jsxs)(n.aside,{className:"tip",children:[(0,a.jsx)(n.h6,{className:"tip__prefix",children:"tip"}),(0,a.jsxs)(n.p,{children:["Note that any imported file is subject to tree shaking. This means if you use something like ",(0,a.jsx)(n.code,{children:"css-loader"})," in your project and import a CSS file, it needs to be added to the side effect list so it will not be unintentionally dropped in production mode:"]})]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsxs)(n.code,{className:"hljs language-json",children:[(0,a.jsx)(n.span,{className:"token punctuation",children:"{"}),"\n  ",(0,a.jsx)(n.span,{className:"token property",children:'"name"'}),(0,a.jsx)(n.span,{className:"token operator",children:":"})," ",(0,a.jsx)(n.span,{className:"token string",children:'"your-project"'}),(0,a.jsx)(n.span,{className:"token punctuation",children:","}),"\n  ",(0,a.jsx)(n.span,{className:"token property",children:'"sideEffects"'}),(0,a.jsx)(n.span,{className:"token operator",children:":"})," ",(0,a.jsx)(n.span,{className:"token punctuation",children:"["}),(0,a.jsx)(n.span,{className:"token string",children:'"./src/some-side-effectful-file.js"'}),(0,a.jsx)(n.span,{className:"token punctuation",children:","})," ",(0,a.jsx)(n.span,{className:"token string",children:'"*.css"'}),(0,a.jsx)(n.span,{className:"token punctuation",children:"]"}),"\n",(0,a.jsx)(n.span,{className:"token punctuation",children:"}"})]})}),"\n",(0,a.jsxs)(n.p,{children:["Finally, ",(0,a.jsx)(n.code,{children:'"sideEffects"'})," can also be set from the ",(0,a.jsxs)(n.a,{href:"/configuration/module/#modulerules",children:[(0,a.jsx)(n.code,{children:"module.rules"})," configuration option"]}),"."]}),"\n",(0,a.jsxs)(n.h2,{children:[(0,a.jsx)(n.span,{id:"clarifying-tree-shaking-and-sideeffects"}),"Clarifying tree shaking and ",(0,a.jsx)(n.code,{children:"sideEffects"}),(0,a.jsx)(n.a,{href:"#clarifying-tree-shaking-and-sideeffects","aria-hidden":"true",tabIndex:"-1",children:(0,a.jsx)(n.span,{className:"header-link"})})]}),"\n",(0,a.jsxs)(n.p,{children:["The ",(0,a.jsx)(n.a,{href:"/configuration/optimization/#optimizationsideeffects",children:(0,a.jsx)(n.code,{children:"sideEffects"})})," and ",(0,a.jsx)(n.a,{href:"/configuration/optimization/#optimizationusedexports",children:(0,a.jsx)(n.code,{children:"usedExports"})})," (more known as tree shaking) optimizations are two different things."]}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsxs)(n.strong,{children:[(0,a.jsx)(n.code,{children:"sideEffects"})," is much more effective"]})," since it allows to skip whole modules/files and the complete subtree."]}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.code,{children:"usedExports"})," relies on ",(0,a.jsx)(n.a,{href:"https://github.com/terser-js/terser",children:"terser"})," to detect side effects in statements. It is a difficult task in JavaScript and not as effective as straightforward ",(0,a.jsx)(n.code,{children:"sideEffects"})," flag. It also can't skip subtree/dependencies since the spec says that side effects need to be evaluated. While exporting function works fine, React's Higher Order Components (HOC) are problematic in this regard."]}),"\n",(0,a.jsx)(n.p,{children:"Let's make an example:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsxs)(n.code,{className:"hljs language-javascript",children:[(0,a.jsx)(n.span,{className:"token keyword",children:"import"})," ",(0,a.jsx)(n.span,{className:"token punctuation",children:"{"})," Button ",(0,a.jsx)(n.span,{className:"token punctuation",children:"}"})," ",(0,a.jsx)(n.span,{className:"token keyword",children:"from"})," ",(0,a.jsx)(n.span,{className:"token string",children:"'@shopify/polaris'"}),(0,a.jsx)(n.span,{className:"token punctuation",children:";"})]})}),"\n",(0,a.jsx)(n.p,{children:"The pre-bundled version looks like this:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsxs)(n.code,{className:"hljs language-javascript",children:[(0,a.jsx)(n.span,{className:"token keyword",children:"import"})," hoistStatics ",(0,a.jsx)(n.span,{className:"token keyword",children:"from"})," ",(0,a.jsx)(n.span,{className:"token string",children:"'hoist-non-react-statics'"}),(0,a.jsx)(n.span,{className:"token punctuation",children:";"}),"\n\n",(0,a.jsx)(n.span,{className:"token keyword",children:"function"})," ",(0,a.jsx)(n.span,{className:"token function",children:"Button"}),(0,a.jsx)(n.span,{className:"token punctuation",children:"("}),(0,a.jsx)(n.span,{className:"token parameter",children:"_ref"}),(0,a.jsx)(n.span,{className:"token punctuation",children:")"})," ",(0,a.jsx)(n.span,{className:"token punctuation",children:"{"}),"\n  ",(0,a.jsx)(n.span,{className:"token comment",children:"// ..."}),"\n",(0,a.jsx)(n.span,{className:"token punctuation",children:"}"}),"\n\n",(0,a.jsx)(n.span,{className:"token keyword",children:"function"})," ",(0,a.jsx)(n.span,{className:"token function",children:"merge"}),(0,a.jsx)(n.span,{className:"token punctuation",children:"("}),(0,a.jsx)(n.span,{className:"token punctuation",children:")"})," ",(0,a.jsx)(n.span,{className:"token punctuation",children:"{"}),"\n  ",(0,a.jsx)(n.span,{className:"token keyword",children:"var"})," _final ",(0,a.jsx)(n.span,{className:"token operator",children:"="})," ",(0,a.jsx)(n.span,{className:"token punctuation",children:"{"}),(0,a.jsx)(n.span,{className:"token punctuation",children:"}"}),(0,a.jsx)(n.span,{className:"token punctuation",children:";"}),"\n\n  ",(0,a.jsx)(n.span,{className:"token keyword",children:"for"})," ",(0,a.jsx)(n.span,{className:"token punctuation",children:"("}),"\n    ",(0,a.jsx)(n.span,{className:"token keyword",children:"var"})," _len ",(0,a.jsx)(n.span,{className:"token operator",children:"="})," arguments",(0,a.jsx)(n.span,{className:"token punctuation",children:"."}),"length",(0,a.jsx)(n.span,{className:"token punctuation",children:","})," objs ",(0,a.jsx)(n.span,{className:"token operator",children:"="})," ",(0,a.jsx)(n.span,{className:"token keyword",children:"new"})," ",(0,a.jsx)(n.span,{className:"token class-name",children:"Array"}),(0,a.jsx)(n.span,{className:"token punctuation",children:"("}),"_len",(0,a.jsx)(n.span,{className:"token punctuation",children:")"}),(0,a.jsx)(n.span,{className:"token punctuation",children:","})," _key ",(0,a.jsx)(n.span,{className:"token operator",children:"="})," ",(0,a.jsx)(n.span,{className:"token number",children:"0"}),(0,a.jsx)(n.span,{className:"token punctuation",children:";"}),"\n    _key ",(0,a.jsx)(n.span,{className:"token operator",children:"<"})," _len",(0,a.jsx)(n.span,{className:"token punctuation",children:";"}),"\n    _key",(0,a.jsx)(n.span,{className:"token operator",children:"++"}),"\n  ",(0,a.jsx)(n.span,{className:"token punctuation",children:")"})," ",(0,a.jsx)(n.span,{className:"token punctuation",children:"{"}),"\n    objs",(0,a.jsx)(n.span,{className:"token punctuation",children:"["}),"_key",(0,a.jsx)(n.span,{className:"token punctuation",children:"]"})," ",(0,a.jsx)(n.span,{className:"token operator",children:"="})," arguments",(0,a.jsx)(n.span,{className:"token punctuation",children:"["}),"_key",(0,a.jsx)(n.span,{className:"token punctuation",children:"]"}),(0,a.jsx)(n.span,{className:"token punctuation",children:";"}),"\n  ",(0,a.jsx)(n.span,{className:"token punctuation",children:"}"}),"\n\n  ",(0,a.jsx)(n.span,{className:"token keyword",children:"for"})," ",(0,a.jsx)(n.span,{className:"token punctuation",children:"("}),(0,a.jsx)(n.span,{className:"token keyword",children:"var"})," _i ",(0,a.jsx)(n.span,{className:"token operator",children:"="})," ",(0,a.jsx)(n.span,{className:"token number",children:"0"}),(0,a.jsx)(n.span,{className:"token punctuation",children:","})," _objs ",(0,a.jsx)(n.span,{className:"token operator",children:"="})," objs",(0,a.jsx)(n.span,{className:"token punctuation",children:";"})," _i ",(0,a.jsx)(n.span,{className:"token operator",children:"<"})," _objs",(0,a.jsx)(n.span,{className:"token punctuation",children:"."}),"length",(0,a.jsx)(n.span,{className:"token punctuation",children:";"})," _i",(0,a.jsx)(n.span,{className:"token operator",children:"++"}),(0,a.jsx)(n.span,{className:"token punctuation",children:")"})," ",(0,a.jsx)(n.span,{className:"token punctuation",children:"{"}),"\n    ",(0,a.jsx)(n.span,{className:"token keyword",children:"var"})," obj ",(0,a.jsx)(n.span,{className:"token operator",children:"="})," _objs",(0,a.jsx)(n.span,{className:"token punctuation",children:"["}),"_i",(0,a.jsx)(n.span,{className:"token punctuation",children:"]"}),(0,a.jsx)(n.span,{className:"token punctuation",children:";"}),"\n    ",(0,a.jsx)(n.span,{className:"token function",children:"mergeRecursively"}),(0,a.jsx)(n.span,{className:"token punctuation",children:"("}),"_final",(0,a.jsx)(n.span,{className:"token punctuation",children:","})," obj",(0,a.jsx)(n.span,{className:"token punctuation",children:")"}),(0,a.jsx)(n.span,{className:"token punctuation",children:";"}),"\n  ",(0,a.jsx)(n.span,{className:"token punctuation",children:"}"}),"\n\n  ",(0,a.jsx)(n.span,{className:"token keyword",children:"return"})," _final",(0,a.jsx)(n.span,{className:"token punctuation",children:";"}),"\n",(0,a.jsx)(n.span,{className:"token punctuation",children:"}"}),"\n\n",(0,a.jsx)(n.span,{className:"token keyword",children:"function"})," ",(0,a.jsx)(n.span,{className:"token function",children:"withAppProvider"}),(0,a.jsx)(n.span,{className:"token punctuation",children:"("}),(0,a.jsx)(n.span,{className:"token punctuation",children:")"})," ",(0,a.jsx)(n.span,{className:"token punctuation",children:"{"}),"\n  ",(0,a.jsx)(n.span,{className:"token keyword",children:"return"})," ",(0,a.jsx)(n.span,{className:"token keyword",children:"function"})," ",(0,a.jsx)(n.span,{className:"token function",children:"addProvider"}),(0,a.jsx)(n.span,{className:"token punctuation",children:"("}),(0,a.jsx)(n.span,{className:"token parameter",children:"WrappedComponent"}),(0,a.jsx)(n.span,{className:"token punctuation",children:")"})," ",(0,a.jsx)(n.span,{className:"token punctuation",children:"{"}),"\n    ",(0,a.jsx)(n.span,{className:"token keyword",children:"var"})," WithProvider ",(0,a.jsx)(n.span,{className:"token operator",children:"="}),"\n      ",(0,a.jsx)(n.span,{className:"token comment",children:"/*#__PURE__*/"}),"\n      ",(0,a.jsx)(n.span,{className:"token punctuation",children:"("}),(0,a.jsx)(n.span,{className:"token keyword",children:"function"})," ",(0,a.jsx)(n.span,{className:"token punctuation",children:"("}),(0,a.jsx)(n.span,{className:"token parameter",children:"_React$Component"}),(0,a.jsx)(n.span,{className:"token punctuation",children:")"})," ",(0,a.jsx)(n.span,{className:"token punctuation",children:"{"}),"\n        ",(0,a.jsx)(n.span,{className:"token comment",children:"// ..."}),"\n        ",(0,a.jsx)(n.span,{className:"token keyword",children:"return"})," WithProvider",(0,a.jsx)(n.span,{className:"token punctuation",children:";"}),"\n      ",(0,a.jsx)(n.span,{className:"token punctuation",children:"}"}),(0,a.jsx)(n.span,{className:"token punctuation",children:")"}),(0,a.jsx)(n.span,{className:"token punctuation",children:"("}),"Component",(0,a.jsx)(n.span,{className:"token punctuation",children:")"}),(0,a.jsx)(n.span,{className:"token punctuation",children:";"}),"\n\n    WithProvider",(0,a.jsx)(n.span,{className:"token punctuation",children:"."}),"contextTypes ",(0,a.jsx)(n.span,{className:"token operator",children:"="})," WrappedComponent",(0,a.jsx)(n.span,{className:"token punctuation",children:"."}),"contextTypes\n      ",(0,a.jsx)(n.span,{className:"token operator",children:"?"})," ",(0,a.jsx)(n.span,{className:"token function",children:"merge"}),(0,a.jsx)(n.span,{className:"token punctuation",children:"("}),"WrappedComponent",(0,a.jsx)(n.span,{className:"token punctuation",children:"."}),"contextTypes",(0,a.jsx)(n.span,{className:"token punctuation",children:","})," polarisAppProviderContextTypes",(0,a.jsx)(n.span,{className:"token punctuation",children:")"}),"\n      ",(0,a.jsx)(n.span,{className:"token operator",children:":"})," polarisAppProviderContextTypes",(0,a.jsx)(n.span,{className:"token punctuation",children:";"}),"\n    ",(0,a.jsx)(n.span,{className:"token keyword",children:"var"})," FinalComponent ",(0,a.jsx)(n.span,{className:"token operator",children:"="})," ",(0,a.jsx)(n.span,{className:"token function",children:"hoistStatics"}),(0,a.jsx)(n.span,{className:"token punctuation",children:"("}),"WithProvider",(0,a.jsx)(n.span,{className:"token punctuation",children:","})," WrappedComponent",(0,a.jsx)(n.span,{className:"token punctuation",children:")"}),(0,a.jsx)(n.span,{className:"token punctuation",children:";"}),"\n    ",(0,a.jsx)(n.span,{className:"token keyword",children:"return"})," FinalComponent",(0,a.jsx)(n.span,{className:"token punctuation",children:";"}),"\n  ",(0,a.jsx)(n.span,{className:"token punctuation",children:"}"}),(0,a.jsx)(n.span,{className:"token punctuation",children:";"}),"\n",(0,a.jsx)(n.span,{className:"token punctuation",children:"}"}),"\n\n",(0,a.jsx)(n.span,{className:"token keyword",children:"var"})," Button$",(0,a.jsx)(n.span,{className:"token number",children:"1"})," ",(0,a.jsx)(n.span,{className:"token operator",children:"="})," ",(0,a.jsx)(n.span,{className:"token function",children:"withAppProvider"}),(0,a.jsx)(n.span,{className:"token punctuation",children:"("}),(0,a.jsx)(n.span,{className:"token punctuation",children:")"}),(0,a.jsx)(n.span,{className:"token punctuation",children:"("}),"Button",(0,a.jsx)(n.span,{className:"token punctuation",children:")"}),(0,a.jsx)(n.span,{className:"token punctuation",children:";"}),"\n\n",(0,a.jsx)(n.span,{className:"token keyword",children:"export"})," ",(0,a.jsx)(n.span,{className:"token punctuation",children:"{"}),"\n  ",(0,a.jsx)(n.span,{className:"token comment",children:"// ...,"}),"\n  Button$",(0,a.jsx)(n.span,{className:"token number",children:"1"}),(0,a.jsx)(n.span,{className:"token punctuation",children:","}),"\n",(0,a.jsx)(n.span,{className:"token punctuation",children:"}"}),(0,a.jsx)(n.span,{className:"token punctuation",children:";"})]})}),"\n",(0,a.jsxs)(n.p,{children:["When ",(0,a.jsx)(n.code,{children:"Button"})," is unused you can effectively remove the ",(0,a.jsx)(n.code,{children:"export { Button$1 };"}),' which leaves all the remaining code. So the question is "Does this code have any side effects or can it be safely removed?". Difficult to say, especially because of this line ',(0,a.jsx)(n.code,{children:"withAppProvider()(Button)"}),". ",(0,a.jsx)(n.code,{children:"withAppProvider"})," is called and the return value is also called. Are there any side effects when calling ",(0,a.jsx)(n.code,{children:"merge"})," or ",(0,a.jsx)(n.code,{children:"hoistStatics"}),"? Are there side effects when assigning ",(0,a.jsx)(n.code,{children:"WithProvider.contextTypes"})," (Setter?) or when reading ",(0,a.jsx)(n.code,{children:"WrappedComponent.contextTypes"})," (Getter?)."]}),"\n",(0,a.jsx)(n.p,{children:"Terser actually tries to figure it out, but it doesn't know for sure in many cases. This doesn't mean that terser is not doing its job well because it can't figure it out. It's too difficult to determine it reliably in a dynamic language like JavaScript."}),"\n",(0,a.jsxs)(n.p,{children:["But we can help terser by using the ",(0,a.jsx)(n.code,{children:"/*#__PURE__*/"})," annotation. It flags a statement as side effect free. So a small change would make it possible to tree-shake the code:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsxs)(n.code,{className:"hljs language-javascript",children:[(0,a.jsx)(n.span,{className:"token keyword",children:"var"})," Button$",(0,a.jsx)(n.span,{className:"token number",children:"1"})," ",(0,a.jsx)(n.span,{className:"token operator",children:"="})," ",(0,a.jsx)(n.span,{className:"token comment",children:"/*#__PURE__*/"})," ",(0,a.jsx)(n.span,{className:"token function",children:"withAppProvider"}),(0,a.jsx)(n.span,{className:"token punctuation",children:"("}),(0,a.jsx)(n.span,{className:"token punctuation",children:")"}),(0,a.jsx)(n.span,{className:"token punctuation",children:"("}),"Button",(0,a.jsx)(n.span,{className:"token punctuation",children:")"}),(0,a.jsx)(n.span,{className:"token punctuation",children:";"})]})}),"\n",(0,a.jsx)(n.p,{children:"This would allow to remove this piece of code. But there are still questions with the imports which need to be included/evaluated because they could contain side effects."}),"\n",(0,a.jsxs)(n.p,{children:["To tackle this, we use the ",(0,a.jsx)(n.a,{href:"/guides/tree-shaking/#mark-the-file-as-side-effect-free",children:(0,a.jsx)(n.code,{children:'"sideEffects"'})})," property in ",(0,a.jsx)(n.code,{children:"package.json"}),"."]}),"\n",(0,a.jsxs)(n.p,{children:["It's similar to ",(0,a.jsx)(n.code,{children:"/*#__PURE__*/"})," but on a module level instead of a statement level. It says (",(0,a.jsx)(n.code,{children:'"sideEffects"'}),' property): "If no direct export from a module flagged with no-sideEffects is used, the bundler can skip evaluating the module for side effects.".']}),"\n",(0,a.jsx)(n.p,{children:"In the Shopify's Polaris example, original modules look like this:"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"index.js"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsxs)(n.code,{className:"hljs language-javascript",children:[(0,a.jsx)(n.span,{className:"token keyword",children:"import"})," ",(0,a.jsx)(n.span,{className:"token string",children:"'./configure'"}),(0,a.jsx)(n.span,{className:"token punctuation",children:";"}),"\n",(0,a.jsx)(n.span,{className:"token keyword",children:"export"})," ",(0,a.jsx)(n.span,{className:"token operator",children:"*"})," ",(0,a.jsx)(n.span,{className:"token keyword",children:"from"})," ",(0,a.jsx)(n.span,{className:"token string",children:"'./types'"}),(0,a.jsx)(n.span,{className:"token punctuation",children:";"}),"\n",(0,a.jsx)(n.span,{className:"token keyword",children:"export"})," ",(0,a.jsx)(n.span,{className:"token operator",children:"*"})," ",(0,a.jsx)(n.span,{className:"token keyword",children:"from"})," ",(0,a.jsx)(n.span,{className:"token string",children:"'./components'"}),(0,a.jsx)(n.span,{className:"token punctuation",children:";"})]})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"components/index.js"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsxs)(n.code,{className:"hljs language-javascript",children:[(0,a.jsx)(n.span,{className:"token comment",children:"// ..."}),"\n",(0,a.jsx)(n.span,{className:"token keyword",children:"export"})," ",(0,a.jsx)(n.span,{className:"token punctuation",children:"{"})," ",(0,a.jsx)(n.span,{className:"token keyword",children:"default"})," ",(0,a.jsx)(n.span,{className:"token keyword",children:"as"})," Breadcrumbs ",(0,a.jsx)(n.span,{className:"token punctuation",children:"}"})," ",(0,a.jsx)(n.span,{className:"token keyword",children:"from"})," ",(0,a.jsx)(n.span,{className:"token string",children:"'./Breadcrumbs'"}),(0,a.jsx)(n.span,{className:"token punctuation",children:";"}),"\n",(0,a.jsx)(n.span,{className:"token keyword",children:"export"})," ",(0,a.jsx)(n.span,{className:"token punctuation",children:"{"})," ",(0,a.jsx)(n.span,{className:"token keyword",children:"default"})," ",(0,a.jsx)(n.span,{className:"token keyword",children:"as"})," Button",(0,a.jsx)(n.span,{className:"token punctuation",children:","})," buttonFrom",(0,a.jsx)(n.span,{className:"token punctuation",children:","})," buttonsFrom ",(0,a.jsx)(n.span,{className:"token punctuation",children:"}"})," ",(0,a.jsx)(n.span,{className:"token keyword",children:"from"})," ",(0,a.jsx)(n.span,{className:"token string",children:"'./Button'"}),(0,a.jsx)(n.span,{className:"token punctuation",children:";"}),"\n",(0,a.jsx)(n.span,{className:"token keyword",children:"export"})," ",(0,a.jsx)(n.span,{className:"token punctuation",children:"{"})," ",(0,a.jsx)(n.span,{className:"token keyword",children:"default"})," ",(0,a.jsx)(n.span,{className:"token keyword",children:"as"})," ButtonGroup ",(0,a.jsx)(n.span,{className:"token punctuation",children:"}"})," ",(0,a.jsx)(n.span,{className:"token keyword",children:"from"})," ",(0,a.jsx)(n.span,{className:"token string",children:"'./ButtonGroup'"}),(0,a.jsx)(n.span,{className:"token punctuation",children:";"}),"\n",(0,a.jsx)(n.span,{className:"token comment",children:"// ..."})]})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"package.json"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsxs)(n.code,{className:"hljs language-json",children:[(0,a.jsx)(n.span,{className:"token comment",children:"// ..."}),"\n",(0,a.jsx)(n.span,{className:"token property",children:'"sideEffects"'}),(0,a.jsx)(n.span,{className:"token operator",children:":"})," ",(0,a.jsx)(n.span,{className:"token punctuation",children:"["}),"\n  ",(0,a.jsx)(n.span,{className:"token string",children:'"**/*.css"'}),(0,a.jsx)(n.span,{className:"token punctuation",children:","}),"\n  ",(0,a.jsx)(n.span,{className:"token string",children:'"**/*.scss"'}),(0,a.jsx)(n.span,{className:"token punctuation",children:","}),"\n  ",(0,a.jsx)(n.span,{className:"token string",children:'"./esnext/index.js"'}),(0,a.jsx)(n.span,{className:"token punctuation",children:","}),"\n  ",(0,a.jsx)(n.span,{className:"token string",children:'"./esnext/configure.js"'}),"\n",(0,a.jsx)(n.span,{className:"token punctuation",children:"]"}),(0,a.jsx)(n.span,{className:"token punctuation",children:","}),"\n",(0,a.jsx)(n.span,{className:"token comment",children:"// ..."})]})}),"\n",(0,a.jsxs)(n.p,{children:["For ",(0,a.jsx)(n.code,{children:'import { Button } from "@shopify/polaris";'})," this has the following implications:"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"include it: include the module, evaluate it and continue analysing dependencies"}),"\n",(0,a.jsx)(n.li,{children:"skip over: don't include it, don't evaluate it but continue analysing dependencies"}),"\n",(0,a.jsx)(n.li,{children:"exclude it: don't include it, don't evaluate it and don't analyse dependencies"}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"Specifically per matching resource(s):"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"index.js"}),": No direct export is used, but flagged with sideEffects -> include it"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"configure.js"}),": No export is used, but flagged with sideEffects -> include it"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"types/index.js"}),": No export is used, not flagged with sideEffects -> exclude it"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"components/index.js"}),": No direct export is used, not flagged with sideEffects, but reexported exports are used -> skip over"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"components/Breadcrumbs.js"}),": No export is used, not flagged with sideEffects -> exclude it. This also excluded all dependencies like ",(0,a.jsx)(n.code,{children:"components/Breadcrumbs.css"})," even if they are flagged with sideEffects."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"components/Button.js"}),": Direct export is used, not flagged with sideEffects -> include it"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"components/Button.css"}),": No export is used, but flagged with sideEffects -> include it"]}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"In this case only 4 modules are included into the bundle:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"index.js"}),": pretty much empty"]}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.code,{children:"configure.js"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.code,{children:"components/Button.js"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.code,{children:"components/Button.css"})}),"\n"]}),"\n",(0,a.jsxs)(n.p,{children:["After this optimization, other optimizations can still apply. For example: ",(0,a.jsx)(n.code,{children:"buttonFrom"})," and ",(0,a.jsx)(n.code,{children:"buttonsFrom"})," exports from ",(0,a.jsx)(n.code,{children:"Button.js"})," are unused too. ",(0,a.jsx)(n.code,{children:"usedExports"})," optimization will pick it up and terser may be able to drop some statements from the module."]}),"\n",(0,a.jsxs)(n.p,{children:["Module Concatenation also applies. So that these 4 modules plus the entry module (and probably more dependencies) can be concatenated. ",(0,a.jsxs)(n.strong,{children:[(0,a.jsx)(n.code,{children:"index.js"})," has no code generated in the end"]}),"."]}),"\n",(0,a.jsxs)(n.h2,{children:[(0,a.jsx)(n.span,{id:"full-example-understanding-side-effects-with-css-files"}),"Full Example: Understanding Side Effects with CSS Files",(0,a.jsx)(n.a,{href:"#full-example-understanding-side-effects-with-css-files","aria-hidden":"true",tabIndex:"-1",children:(0,a.jsx)(n.span,{className:"header-link"})})]}),"\n",(0,a.jsxs)(n.p,{children:["To better understand the impact of the ",(0,a.jsx)(n.code,{children:"sideEffects"})," flag, let's look at a complete example of an npm package with CSS assets and how they might be affected during tree shaking. We'll create a fictional UI component library called \"awesome-ui\"."]}),"\n",(0,a.jsxs)(n.h3,{children:[(0,a.jsx)(n.span,{id:"package-structure"}),"Package Structure",(0,a.jsx)(n.a,{href:"#package-structure","aria-hidden":"true",tabIndex:"-1",children:(0,a.jsx)(n.span,{className:"header-link"})})]}),"\n",(0,a.jsx)(n.p,{children:"Our example package looks like this:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"hljs language-bash",children:"awesome-ui/\n├── package.json\n├── dist/\n│   ├── index.js\n│   ├── components/\n│   │   ├── index.js\n│   │   ├── Button/\n│   │   │   ├── index.js\n│   │   │   └── Button.css\n│   │   ├── Card/\n│   │   │   ├── index.js\n│   │   │   └── Card.css\n│   │   └── Modal/\n│   │       ├── index.js\n│   │       └── Modal.css\n│   └── theme/\n│       ├── index.js\n│       └── defaultTheme.css"})}),"\n",(0,a.jsxs)(n.h3,{children:[(0,a.jsx)(n.span,{id:"package-files-content"}),"Package Files Content",(0,a.jsx)(n.a,{href:"#package-files-content","aria-hidden":"true",tabIndex:"-1",children:(0,a.jsx)(n.span,{className:"header-link"})})]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"package.json"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsxs)(n.code,{className:"hljs language-json",children:[(0,a.jsx)(n.span,{className:"token punctuation",children:"{"}),"\n  ",(0,a.jsx)(n.span,{className:"token property",children:'"name"'}),(0,a.jsx)(n.span,{className:"token operator",children:":"})," ",(0,a.jsx)(n.span,{className:"token string",children:'"awesome-ui"'}),(0,a.jsx)(n.span,{className:"token punctuation",children:","}),"\n  ",(0,a.jsx)(n.span,{className:"token property",children:'"version"'}),(0,a.jsx)(n.span,{className:"token operator",children:":"})," ",(0,a.jsx)(n.span,{className:"token string",children:'"1.0.0"'}),(0,a.jsx)(n.span,{className:"token punctuation",children:","}),"\n  ",(0,a.jsx)(n.span,{className:"token property",children:'"main"'}),(0,a.jsx)(n.span,{className:"token operator",children:":"})," ",(0,a.jsx)(n.span,{className:"token string",children:'"dist/index.js"'}),(0,a.jsx)(n.span,{className:"token punctuation",children:","}),"\n  ",(0,a.jsx)(n.span,{className:"token property",children:'"sideEffects"'}),(0,a.jsx)(n.span,{className:"token operator",children:":"})," ",(0,a.jsx)(n.span,{className:"token boolean",children:"false"}),"\n",(0,a.jsx)(n.span,{className:"token punctuation",children:"}"})]})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"dist/index.js"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsxs)(n.code,{className:"hljs language-javascript",children:[(0,a.jsx)(n.span,{className:"token keyword",children:"export"})," ",(0,a.jsx)(n.span,{className:"token operator",children:"*"})," ",(0,a.jsx)(n.span,{className:"token keyword",children:"from"})," ",(0,a.jsx)(n.span,{className:"token string",children:"'./components'"}),(0,a.jsx)(n.span,{className:"token punctuation",children:";"}),"\n",(0,a.jsx)(n.span,{className:"token keyword",children:"export"})," ",(0,a.jsx)(n.span,{className:"token operator",children:"*"})," ",(0,a.jsx)(n.span,{className:"token keyword",children:"from"})," ",(0,a.jsx)(n.span,{className:"token string",children:"'./theme'"}),(0,a.jsx)(n.span,{className:"token punctuation",children:";"})]})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"dist/components/index.js"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsxs)(n.code,{className:"hljs language-javascript",children:[(0,a.jsx)(n.span,{className:"token keyword",children:"export"})," ",(0,a.jsx)(n.span,{className:"token punctuation",children:"{"})," ",(0,a.jsx)(n.span,{className:"token keyword",children:"default"})," ",(0,a.jsx)(n.span,{className:"token keyword",children:"as"})," Button ",(0,a.jsx)(n.span,{className:"token punctuation",children:"}"})," ",(0,a.jsx)(n.span,{className:"token keyword",children:"from"})," ",(0,a.jsx)(n.span,{className:"token string",children:"'./Button'"}),(0,a.jsx)(n.span,{className:"token punctuation",children:";"}),"\n",(0,a.jsx)(n.span,{className:"token keyword",children:"export"})," ",(0,a.jsx)(n.span,{className:"token punctuation",children:"{"})," ",(0,a.jsx)(n.span,{className:"token keyword",children:"default"})," ",(0,a.jsx)(n.span,{className:"token keyword",children:"as"})," Card ",(0,a.jsx)(n.span,{className:"token punctuation",children:"}"})," ",(0,a.jsx)(n.span,{className:"token keyword",children:"from"})," ",(0,a.jsx)(n.span,{className:"token string",children:"'./Card'"}),(0,a.jsx)(n.span,{className:"token punctuation",children:";"}),"\n",(0,a.jsx)(n.span,{className:"token keyword",children:"export"})," ",(0,a.jsx)(n.span,{className:"token punctuation",children:"{"})," ",(0,a.jsx)(n.span,{className:"token keyword",children:"default"})," ",(0,a.jsx)(n.span,{className:"token keyword",children:"as"})," Modal ",(0,a.jsx)(n.span,{className:"token punctuation",children:"}"})," ",(0,a.jsx)(n.span,{className:"token keyword",children:"from"})," ",(0,a.jsx)(n.span,{className:"token string",children:"'./Modal'"}),(0,a.jsx)(n.span,{className:"token punctuation",children:";"})]})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"dist/components/Button/index.js"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsxs)(n.code,{className:"hljs language-javascript",children:[(0,a.jsx)(n.span,{className:"token keyword",children:"import"})," ",(0,a.jsx)(n.span,{className:"token string",children:"'./Button.css'"}),(0,a.jsx)(n.span,{className:"token punctuation",children:";"})," ",(0,a.jsx)(n.span,{className:"token comment",children:"// This has a side effect - it applies styles when imported!"}),"\n\n",(0,a.jsx)(n.span,{className:"token keyword",children:"export"})," ",(0,a.jsx)(n.span,{className:"token keyword",children:"default"})," ",(0,a.jsx)(n.span,{className:"token keyword",children:"function"})," ",(0,a.jsx)(n.span,{className:"token function",children:"Button"}),(0,a.jsx)(n.span,{className:"token punctuation",children:"("}),(0,a.jsx)(n.span,{className:"token parameter",children:"props"}),(0,a.jsx)(n.span,{className:"token punctuation",children:")"})," ",(0,a.jsx)(n.span,{className:"token punctuation",children:"{"}),"\n  ",(0,a.jsx)(n.span,{className:"token comment",children:"// Button component implementation"}),"\n  ",(0,a.jsx)(n.span,{className:"token keyword",children:"return"})," ",(0,a.jsx)(n.span,{className:"token punctuation",children:"{"}),"\n    type",(0,a.jsx)(n.span,{className:"token operator",children:":"})," ",(0,a.jsx)(n.span,{className:"token string",children:"'button'"}),(0,a.jsx)(n.span,{className:"token punctuation",children:","}),"\n    ",(0,a.jsx)(n.span,{className:"token operator",children:"..."}),"props",(0,a.jsx)(n.span,{className:"token punctuation",children:","}),"\n  ",(0,a.jsx)(n.span,{className:"token punctuation",children:"}"}),(0,a.jsx)(n.span,{className:"token punctuation",children:";"}),"\n",(0,a.jsx)(n.span,{className:"token punctuation",children:"}"})]})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"dist/components/Button/Button.css"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsxs)(n.code,{className:"hljs language-css",children:[(0,a.jsx)(n.span,{className:"token selector",children:".awesome-ui-button"})," ",(0,a.jsx)(n.span,{className:"token punctuation",children:"{"}),"\n  ",(0,a.jsx)(n.span,{className:"token property",children:"background-color"}),(0,a.jsx)(n.span,{className:"token punctuation",children:":"})," #0078d7",(0,a.jsx)(n.span,{className:"token punctuation",children:";"}),"\n  ",(0,a.jsx)(n.span,{className:"token property",children:"color"}),(0,a.jsx)(n.span,{className:"token punctuation",children:":"})," white",(0,a.jsx)(n.span,{className:"token punctuation",children:";"}),"\n  ",(0,a.jsx)(n.span,{className:"token property",children:"padding"}),(0,a.jsx)(n.span,{className:"token punctuation",children:":"})," 8px 16px",(0,a.jsx)(n.span,{className:"token punctuation",children:";"}),"\n  ",(0,a.jsx)(n.span,{className:"token property",children:"border-radius"}),(0,a.jsx)(n.span,{className:"token punctuation",children:":"})," 4px",(0,a.jsx)(n.span,{className:"token punctuation",children:";"}),"\n  ",(0,a.jsx)(n.span,{className:"token property",children:"border"}),(0,a.jsx)(n.span,{className:"token punctuation",children:":"})," none",(0,a.jsx)(n.span,{className:"token punctuation",children:";"}),"\n  ",(0,a.jsx)(n.span,{className:"token property",children:"cursor"}),(0,a.jsx)(n.span,{className:"token punctuation",children:":"})," pointer",(0,a.jsx)(n.span,{className:"token punctuation",children:";"}),"\n",(0,a.jsx)(n.span,{className:"token punctuation",children:"}"})]})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"dist/components/Card/index.js"})," and ",(0,a.jsx)(n.strong,{children:"dist/components/Modal/index.js"})," would have similar structure."]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"dist/theme/index.js"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsxs)(n.code,{className:"hljs language-javascript",children:[(0,a.jsx)(n.span,{className:"token keyword",children:"import"})," ",(0,a.jsx)(n.span,{className:"token string",children:"'./defaultTheme.css'"}),(0,a.jsx)(n.span,{className:"token punctuation",children:";"})," ",(0,a.jsx)(n.span,{className:"token comment",children:"// This has a side effect!"}),"\n\n",(0,a.jsx)(n.span,{className:"token keyword",children:"export"})," ",(0,a.jsx)(n.span,{className:"token keyword",children:"const"})," themeColors ",(0,a.jsx)(n.span,{className:"token operator",children:"="})," ",(0,a.jsx)(n.span,{className:"token punctuation",children:"{"}),"\n  primary",(0,a.jsx)(n.span,{className:"token operator",children:":"})," ",(0,a.jsx)(n.span,{className:"token string",children:"'#0078d7'"}),(0,a.jsx)(n.span,{className:"token punctuation",children:","}),"\n  secondary",(0,a.jsx)(n.span,{className:"token operator",children:":"})," ",(0,a.jsx)(n.span,{className:"token string",children:"'#f3f2f1'"}),(0,a.jsx)(n.span,{className:"token punctuation",children:","}),"\n  danger",(0,a.jsx)(n.span,{className:"token operator",children:":"})," ",(0,a.jsx)(n.span,{className:"token string",children:"'#d13438'"}),(0,a.jsx)(n.span,{className:"token punctuation",children:","}),"\n",(0,a.jsx)(n.span,{className:"token punctuation",children:"}"}),(0,a.jsx)(n.span,{className:"token punctuation",children:";"})]})}),"\n",(0,a.jsxs)(n.h3,{children:[(0,a.jsx)(n.span,{id:"what-happens-when-consuming-this-package"}),"What Happens When Consuming This Package?",(0,a.jsx)(n.a,{href:"#what-happens-when-consuming-this-package","aria-hidden":"true",tabIndex:"-1",children:(0,a.jsx)(n.span,{className:"header-link"})})]}),"\n",(0,a.jsx)(n.p,{children:"Now, imagine a consumer application that only wants to use the Button component:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsxs)(n.code,{className:"hljs language-javascript",children:[(0,a.jsx)(n.span,{className:"token keyword",children:"import"})," ",(0,a.jsx)(n.span,{className:"token punctuation",children:"{"})," Button ",(0,a.jsx)(n.span,{className:"token punctuation",children:"}"})," ",(0,a.jsx)(n.span,{className:"token keyword",children:"from"})," ",(0,a.jsx)(n.span,{className:"token string",children:"'awesome-ui'"}),(0,a.jsx)(n.span,{className:"token punctuation",children:";"}),"\n\n",(0,a.jsx)(n.span,{className:"token comment",children:"// Use the Button component"})]})}),"\n",(0,a.jsxs)(n.h4,{children:[(0,a.jsx)(n.span,{id:"with-sideeffects-false-in-packagejson"}),"With ",(0,a.jsx)(n.code,{children:"sideEffects: false"})," in package.json",(0,a.jsx)(n.a,{href:"#with-sideeffects-false-in-packagejson","aria-hidden":"true",tabIndex:"-1",children:(0,a.jsx)(n.span,{className:"header-link"})})]}),"\n",(0,a.jsx)(n.p,{children:"When webpack processes this import with tree shaking enabled:"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsx)(n.li,{children:"It sees the import for only Button"}),"\n",(0,a.jsxs)(n.li,{children:["It looks at the package.json and sees ",(0,a.jsx)(n.code,{children:"sideEffects: false"})]}),"\n",(0,a.jsx)(n.li,{children:"It determines it only needs to include the Button component code"}),"\n",(0,a.jsxs)(n.li,{children:["Since all files are marked as having no side effects, it will include ",(0,a.jsx)(n.strong,{children:"only"})," the JavaScript code for the Button"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"The CSS file import gets dropped!"})," Even though Button.css is imported in Button/index.js, webpack assumes this import has no side effects."]}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"The result: The Button component will render, but without any styling since Button.css was eliminated during tree shaking."}),"\n",(0,a.jsxs)(n.h4,{children:[(0,a.jsx)(n.span,{id:"the-correct-configuration-for-this-package"}),"The Correct Configuration for This Package",(0,a.jsx)(n.a,{href:"#the-correct-configuration-for-this-package","aria-hidden":"true",tabIndex:"-1",children:(0,a.jsx)(n.span,{className:"header-link"})})]}),"\n",(0,a.jsx)(n.p,{children:"To fix this, we need to update package.json to properly mark CSS files as having side effects:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsxs)(n.code,{className:"hljs language-json",children:[(0,a.jsx)(n.span,{className:"token punctuation",children:"{"}),"\n  ",(0,a.jsx)(n.span,{className:"token property",children:'"name"'}),(0,a.jsx)(n.span,{className:"token operator",children:":"})," ",(0,a.jsx)(n.span,{className:"token string",children:'"awesome-ui"'}),(0,a.jsx)(n.span,{className:"token punctuation",children:","}),"\n  ",(0,a.jsx)(n.span,{className:"token property",children:'"version"'}),(0,a.jsx)(n.span,{className:"token operator",children:":"})," ",(0,a.jsx)(n.span,{className:"token string",children:'"1.0.0"'}),(0,a.jsx)(n.span,{className:"token punctuation",children:","}),"\n  ",(0,a.jsx)(n.span,{className:"token property",children:'"main"'}),(0,a.jsx)(n.span,{className:"token operator",children:":"})," ",(0,a.jsx)(n.span,{className:"token string",children:'"dist/index.js"'}),(0,a.jsx)(n.span,{className:"token punctuation",children:","}),"\n  ",(0,a.jsx)(n.span,{className:"token property",children:'"sideEffects"'}),(0,a.jsx)(n.span,{className:"token operator",children:":"})," ",(0,a.jsx)(n.span,{className:"token punctuation",children:"["}),(0,a.jsx)(n.span,{className:"token string",children:'"**/*.css"'}),(0,a.jsx)(n.span,{className:"token punctuation",children:"]"}),"\n",(0,a.jsx)(n.span,{className:"token punctuation",children:"}"})]})}),"\n",(0,a.jsx)(n.p,{children:"With this configuration:"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsx)(n.li,{children:"Webpack still identifies that only the Button component is needed"}),"\n",(0,a.jsx)(n.li,{children:"But now it recognizes that CSS files have side effects"}),"\n",(0,a.jsx)(n.li,{children:"So, it includes Button.css when processing Button/index.js"}),"\n"]}),"\n",(0,a.jsxs)(n.h3,{children:[(0,a.jsx)(n.span,{id:"the-decision-tree-for-side-effects"}),"The Decision Tree for Side Effects",(0,a.jsx)(n.a,{href:"#the-decision-tree-for-side-effects","aria-hidden":"true",tabIndex:"-1",children:(0,a.jsx)(n.span,{className:"header-link"})})]}),"\n",(0,a.jsx)(n.p,{children:"Here's how webpack evaluates modules during tree shaking:"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:"Is the export from this module used directly or indirectly?"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"If yes: Include the module"}),"\n",(0,a.jsx)(n.li,{children:"If no: Continue to step 2"}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:"Is the module marked with side effects?"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["If yes (",(0,a.jsx)(n.code,{children:"sideEffects"})," includes this file or is ",(0,a.jsx)(n.code,{children:"true"}),"): Include the module"]}),"\n",(0,a.jsxs)(n.li,{children:["If no (",(0,a.jsx)(n.code,{children:"sideEffects"})," is ",(0,a.jsx)(n.code,{children:"false"})," or doesn't include this file): Exclude the module and its dependencies"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"For our library's files with the proper sideEffects configuration:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"dist/index.js"}),": No direct export used, no side effects -> Skip over"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"dist/components/index.js"}),": No direct export used, no side effects -> Skip over"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"dist/components/Button/index.js"}),": Direct export used -> Include"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"dist/components/Button/Button.css"}),": No exports, has side effects -> Include"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"dist/components/Card/*"}),": No exports used, no side effects -> Exclude"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"dist/components/Modal/*"}),": No exports used, no side effects -> Exclude"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"dist/theme/*"}),": No exports used, no side effects -> Exclude"]}),"\n"]}),"\n",(0,a.jsxs)(n.h3,{children:[(0,a.jsx)(n.span,{id:"real-world-impact"}),"Real-World Impact",(0,a.jsx)(n.a,{href:"#real-world-impact","aria-hidden":"true",tabIndex:"-1",children:(0,a.jsx)(n.span,{className:"header-link"})})]}),"\n",(0,a.jsx)(n.p,{children:"The impact of incorrect side effects configuration can be significant:"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"CSS not being included"}),": Components render without styles"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Global JavaScript not running"}),": Polyfills or global configurations don't execute"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Initialization code skipped"}),": Functions that register components or set up event listeners never run"]}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"These issues can be particularly hard to debug because they often only appear in production builds when tree shaking is enabled."}),"\n",(0,a.jsxs)(n.h3,{children:[(0,a.jsx)(n.span,{id:"testing-side-effects-configuration"}),"Testing Side Effects Configuration",(0,a.jsx)(n.a,{href:"#testing-side-effects-configuration","aria-hidden":"true",tabIndex:"-1",children:(0,a.jsx)(n.span,{className:"header-link"})})]}),"\n",(0,a.jsx)(n.p,{children:"A good way to test if your side effects configuration is correct:"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsx)(n.li,{children:"Create a minimal application that imports just one component"}),"\n",(0,a.jsx)(n.li,{children:"Build it with production settings (with tree shaking enabled)"}),"\n",(0,a.jsx)(n.li,{children:"Check if all necessary styles and behaviors work correctly"}),"\n",(0,a.jsx)(n.li,{children:"Look at the generated bundle to confirm the right files are included"}),"\n"]}),"\n",(0,a.jsxs)(n.h2,{children:[(0,a.jsx)(n.span,{id:"mark-a-function-call-as-side-effect-free"}),"Mark a function call as side-effect-free",(0,a.jsx)(n.a,{href:"#mark-a-function-call-as-side-effect-free","aria-hidden":"true",tabIndex:"-1",children:(0,a.jsx)(n.span,{className:"header-link"})})]}),"\n",(0,a.jsxs)(n.p,{children:["It is possible to tell webpack that a function call is side-effect-free (pure) by using the ",(0,a.jsx)(n.code,{children:"/*#__PURE__*/"})," annotation. It can be put in front of function calls to mark them as side-effect-free. Arguments passed to the function are not being marked by the annotation and may need to be marked individually. When the initial value in a variable declaration of an unused variable is considered as side-effect-free (pure), it is getting marked as dead code, not executed and dropped by the minimizer.\nThis behavior is enabled when ",(0,a.jsx)(n.a,{href:"/configuration/optimization/#optimizationinnergraph",children:(0,a.jsx)(n.code,{children:"optimization.innerGraph"})})," is set to ",(0,a.jsx)(n.code,{children:"true"}),"."]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"file.js"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsxs)(n.code,{className:"hljs language-javascript",children:[(0,a.jsx)(n.span,{className:"token comment",children:"/*#__PURE__*/"})," ",(0,a.jsx)(n.span,{className:"token function",children:"double"}),(0,a.jsx)(n.span,{className:"token punctuation",children:"("}),(0,a.jsx)(n.span,{className:"token number",children:"55"}),(0,a.jsx)(n.span,{className:"token punctuation",children:")"}),(0,a.jsx)(n.span,{className:"token punctuation",children:";"})]})}),"\n",(0,a.jsxs)(n.h2,{children:[(0,a.jsx)(n.span,{id:"minify-the-output"}),"Minify the Output",(0,a.jsx)(n.a,{href:"#minify-the-output","aria-hidden":"true",tabIndex:"-1",children:(0,a.jsx)(n.span,{className:"header-link"})})]}),"\n",(0,a.jsxs)(n.p,{children:['So we\'ve cued up our "dead code" to be dropped by using the ',(0,a.jsx)(n.code,{children:"import"})," and ",(0,a.jsx)(n.code,{children:"export"})," syntax, but we still need to drop it from the bundle. To do that, set the ",(0,a.jsx)(n.code,{children:"mode"})," configuration option to ",(0,a.jsx)(n.a,{href:"/configuration/mode/#mode-production",children:(0,a.jsx)(n.code,{children:"production"})}),"."]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"webpack.config.js"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsxs)(n.code,{className:"hljs language-diff",children:["const path = require('path');\n\nmodule.exports = {\n",(0,a.jsxs)(n.span,{className:"token unchanged",children:[(0,a.jsx)(n.span,{className:"token prefix unchanged",children:" "}),(0,a.jsx)(n.span,{className:"token line",children:" entry: './src/index.js',\n"}),(0,a.jsx)(n.span,{className:"token prefix unchanged",children:" "}),(0,a.jsx)(n.span,{className:"token line",children:" output: {\n"}),(0,a.jsx)(n.span,{className:"token prefix unchanged",children:" "}),(0,a.jsx)(n.span,{className:"token line",children:"   filename: 'bundle.js',\n"}),(0,a.jsx)(n.span,{className:"token prefix unchanged",children:" "}),(0,a.jsx)(n.span,{className:"token line",children:"   path: path.resolve(__dirname, 'dist'),\n"}),(0,a.jsx)(n.span,{className:"token prefix unchanged",children:" "}),(0,a.jsx)(n.span,{className:"token line",children:" },\n"})]}),(0,a.jsxs)(n.span,{className:"token deleted-sign deleted",children:[(0,a.jsx)(n.span,{className:"token prefix deleted",children:"-"}),(0,a.jsx)(n.span,{className:"token line",children:" mode: 'development',\n"}),(0,a.jsx)(n.span,{className:"token prefix deleted",children:"-"}),(0,a.jsx)(n.span,{className:"token line",children:" optimization: {\n"}),(0,a.jsx)(n.span,{className:"token prefix deleted",children:"-"}),(0,a.jsx)(n.span,{className:"token line",children:"   usedExports: true,\n"}),(0,a.jsx)(n.span,{className:"token prefix deleted",children:"-"}),(0,a.jsx)(n.span,{className:"token line",children:" }\n"})]}),(0,a.jsxs)(n.span,{className:"token inserted-sign inserted",children:[(0,a.jsx)(n.span,{className:"token prefix inserted",children:"+"}),(0,a.jsx)(n.span,{className:"token line",children:" mode: 'production',\n"})]}),"};"]})}),"\n",(0,a.jsxs)(n.aside,{className:"tip",children:[(0,a.jsx)(n.h6,{className:"tip__prefix",children:"tip"}),(0,a.jsxs)(n.p,{children:["Note that the ",(0,a.jsx)(n.code,{children:"--optimize-minimize"})," flag can be used to enable ",(0,a.jsx)(n.code,{children:"TerserPlugin"})," as well."]})]}),"\n",(0,a.jsxs)(n.p,{children:["With that squared away, we can run another ",(0,a.jsx)(n.code,{children:"npm run build"})," and see if anything has changed."]}),"\n",(0,a.jsxs)(n.p,{children:["Notice anything different about ",(0,a.jsx)(n.code,{children:"dist/bundle.js"}),"? The whole bundle is now minified and mangled, but, if you look carefully, you won't see the ",(0,a.jsx)(n.code,{children:"square"})," function included but will see a mangled version of the ",(0,a.jsx)(n.code,{children:"cube"})," function (",(0,a.jsx)(n.code,{children:"function r(e){return e*e*e}n.a=r"}),"). With minification and tree shaking, our bundle is now a few bytes smaller! While that may not seem like much in this contrived example, tree shaking can yield a significant decrease in bundle size when working on larger applications with complex dependency trees."]}),"\n",(0,a.jsxs)(n.aside,{className:"tip",children:[(0,a.jsx)(n.h6,{className:"tip__prefix",children:"tip"}),(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.a,{href:"/plugins/module-concatenation-plugin/",children:(0,a.jsx)(n.code,{children:"ModuleConcatenationPlugin"})})," is needed for the tree shaking to work. It is added by ",(0,a.jsx)(n.code,{children:"mode: 'production'"}),". If you are not using it, remember to add the ",(0,a.jsx)(n.a,{href:"/plugins/module-concatenation-plugin/",children:(0,a.jsx)(n.code,{children:"ModuleConcatenationPlugin"})})," manually."]})]}),"\n",(0,a.jsxs)(n.h2,{children:[(0,a.jsx)(n.span,{id:"common-pitfalls-with-side-effects"}),"Common Pitfalls with Side Effects",(0,a.jsx)(n.a,{href:"#common-pitfalls-with-side-effects","aria-hidden":"true",tabIndex:"-1",children:(0,a.jsx)(n.span,{className:"header-link"})})]}),"\n",(0,a.jsxs)(n.p,{children:["When working with tree shaking and the ",(0,a.jsx)(n.code,{children:"sideEffects"})," flag, there are several common pitfalls to avoid:"]}),"\n",(0,a.jsxs)(n.h3,{children:[(0,a.jsx)(n.span,{id:"1-over-optimistic-sideeffects-false"}),"1. Over-optimistic ",(0,a.jsx)(n.code,{children:"sideEffects: false"}),(0,a.jsx)(n.a,{href:"#1-over-optimistic-sideeffects-false","aria-hidden":"true",tabIndex:"-1",children:(0,a.jsx)(n.span,{className:"header-link"})})]}),"\n",(0,a.jsxs)(n.p,{children:["Setting ",(0,a.jsx)(n.code,{children:"sideEffects: false"})," in your package.json is tempting for optimal tree shaking, but this can cause problems if your code actually does have side effects. Examples of hidden side effects:"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"CSS imports (as demonstrated above)"}),"\n",(0,a.jsx)(n.li,{children:"Polyfills that modify global objects"}),"\n",(0,a.jsx)(n.li,{children:"Libraries that register global event listeners"}),"\n",(0,a.jsx)(n.li,{children:"Code that modifies prototype chains"}),"\n"]}),"\n",(0,a.jsxs)(n.h3,{children:[(0,a.jsx)(n.span,{id:"2-re-exports-with-side-effects"}),"2. Re-exports with Side Effects",(0,a.jsx)(n.a,{href:"#2-re-exports-with-side-effects","aria-hidden":"true",tabIndex:"-1",children:(0,a.jsx)(n.span,{className:"header-link"})})]}),"\n",(0,a.jsx)(n.p,{children:"Consider this pattern:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsxs)(n.code,{className:"hljs language-javascript",children:[(0,a.jsx)(n.span,{className:"token comment",children:"// This file has side effects that might be skipped"}),"\n",(0,a.jsx)(n.span,{className:"token keyword",children:"import"})," ",(0,a.jsx)(n.span,{className:"token string",children:"'./polyfill'"}),(0,a.jsx)(n.span,{className:"token punctuation",children:";"}),"\n\n",(0,a.jsx)(n.span,{className:"token comment",children:"// Re-export components"}),"\n",(0,a.jsx)(n.span,{className:"token keyword",children:"export"})," ",(0,a.jsx)(n.span,{className:"token operator",children:"*"})," ",(0,a.jsx)(n.span,{className:"token keyword",children:"from"})," ",(0,a.jsx)(n.span,{className:"token string",children:"'./components'"}),(0,a.jsx)(n.span,{className:"token punctuation",children:";"})]})}),"\n",(0,a.jsx)(n.p,{children:"If a consumer only imports specific components, the polyfill import might be skipped entirely if not properly marked with side effects."}),"\n",(0,a.jsxs)(n.h3,{children:[(0,a.jsx)(n.span,{id:"3-forgetting-about-nested-dependencies"}),"3. Forgetting about Nested Dependencies",(0,a.jsx)(n.a,{href:"#3-forgetting-about-nested-dependencies","aria-hidden":"true",tabIndex:"-1",children:(0,a.jsx)(n.span,{className:"header-link"})})]}),"\n",(0,a.jsx)(n.p,{children:"Your package might correctly mark side effects, but if it depends on third-party packages that incorrectly mark their side effects, you might still encounter issues."}),"\n",(0,a.jsxs)(n.h3,{children:[(0,a.jsx)(n.span,{id:"4-testing-only-in-development-mode"}),"4. Testing Only in Development Mode",(0,a.jsx)(n.a,{href:"#4-testing-only-in-development-mode","aria-hidden":"true",tabIndex:"-1",children:(0,a.jsx)(n.span,{className:"header-link"})})]}),"\n",(0,a.jsx)(n.p,{children:"Tree shaking typically only fully activates in production mode. Testing only in development can hide tree shaking issues until deployment."}),"\n",(0,a.jsxs)(n.h2,{children:[(0,a.jsx)(n.span,{id:"conclusion"}),"Conclusion",(0,a.jsx)(n.a,{href:"#conclusion","aria-hidden":"true",tabIndex:"-1",children:(0,a.jsx)(n.span,{className:"header-link"})})]}),"\n",(0,a.jsxs)(n.p,{children:["What we've learned is that in order to take advantage of ",(0,a.jsx)(n.em,{children:"tree shaking"}),", you must..."]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["Use ES2015 module syntax (i.e. ",(0,a.jsx)(n.code,{children:"import"})," and ",(0,a.jsx)(n.code,{children:"export"}),")."]}),"\n",(0,a.jsxs)(n.li,{children:["Ensure no compilers transform your ES2015 module syntax into CommonJS modules (this is the default behavior of the popular Babel preset @babel/preset-env - see the ",(0,a.jsx)(n.a,{href:"https://babeljs.io/docs/en/babel-preset-env#modules",children:"documentation"})," for more details)."]}),"\n",(0,a.jsxs)(n.li,{children:["Add a ",(0,a.jsx)(n.code,{children:'"sideEffects"'})," property to your project's ",(0,a.jsx)(n.code,{children:"package.json"})," file."]}),"\n",(0,a.jsx)(n.li,{children:"Be careful about correctly marking files with side effects, especially CSS imports."}),"\n",(0,a.jsxs)(n.li,{children:["Use the ",(0,a.jsx)(n.a,{href:"/configuration/mode/#mode-production",children:(0,a.jsx)(n.code,{children:"production"})})," ",(0,a.jsx)(n.code,{children:"mode"})," configuration option to enable ",(0,a.jsx)(n.a,{href:"/configuration/mode/#usage",children:"various optimizations"})," including minification and tree shaking (side effects optimization is enabled in development mode using the flag value)."]}),"\n",(0,a.jsxs)(n.li,{children:["Make sure you set a correct value for ",(0,a.jsx)(n.a,{href:"/configuration/devtool/#devtool",children:(0,a.jsx)(n.code,{children:"devtool"})})," as some of them can't be used in ",(0,a.jsx)(n.code,{children:"production"})," mode."]}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"You can imagine your application as a tree. The source code and libraries you actually use represent the green, living leaves of the tree. Dead code represents the brown, dead leaves of the tree that are consumed by autumn. In order to get rid of the dead leaves, you have to shake the tree, causing them to fall."}),"\n",(0,a.jsxs)(n.p,{children:["If you are interested in more ways to optimize your output, please jump to the next guide for details on building for ",(0,a.jsx)(n.a,{href:"/guides/production",children:"production"}),"."]})]})}function c(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(i,{...e})}):i(e)}}}]);