"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[9770],{9770:function(e,n,s){s.r(n),s.d(n,{default:function(){return l}});var a=s(2540),r=s(3317);function i(e){const n={a:"a",aside:"aside",code:"code",h2:"h2",h6:"h6",p:"p",pre:"pre",span:"span",strong:"strong",...(0,r.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(n.aside,{className:"tip",children:[(0,a.jsx)(n.h6,{className:"tip__prefix",children:"tip"}),(0,a.jsxs)(n.p,{children:["This guide extends on code examples found in the ",(0,a.jsx)(n.a,{href:"/guides/output-management",children:"Output Management"})," guide."]})]}),"\n",(0,a.jsxs)(n.p,{children:["Progressive Web Applications (or PWAs) are web apps that deliver an experience similar to native applications. There are many things that can contribute to that. Of these, the most significant is the ability for an app to be able to function when ",(0,a.jsx)(n.strong,{children:"offline"}),". This is achieved through the use of a web technology called ",(0,a.jsx)(n.a,{href:"https://developers.google.com/web/fundamentals/primers/service-workers/",children:"Service Workers"}),"."]}),"\n",(0,a.jsxs)(n.p,{children:["This section will focus on adding an offline experience to our app. We'll achieve this using a Google project called ",(0,a.jsx)(n.a,{href:"https://github.com/GoogleChrome/workbox",children:"Workbox"})," which provides tools that help make offline support for web apps easier to setup."]}),"\n",(0,a.jsxs)(n.h2,{children:[(0,a.jsx)(n.span,{id:"we-dont-work-offline-now"}),"We Don't Work Offline Now",(0,a.jsx)(n.a,{href:"#we-dont-work-offline-now","aria-hidden":"true",tabIndex:"-1",children:(0,a.jsx)(n.span,{className:"header-link"})})]}),"\n",(0,a.jsxs)(n.p,{children:["So far, we've been viewing the output by going directly to the local file system. Typically though, a real user accesses a web app over a network; their browser talking to a ",(0,a.jsx)(n.strong,{children:"server"})," which will serve up the required assets (e.g. ",(0,a.jsx)(n.code,{children:".html"}),", ",(0,a.jsx)(n.code,{children:".js"}),", and ",(0,a.jsx)(n.code,{children:".css"})," files)."]}),"\n",(0,a.jsxs)(n.p,{children:["So let's test what the current experience is like using a server with more basic features. Let's use the ",(0,a.jsx)(n.a,{href:"https://www.npmjs.com/package/http-server",children:"http-server"})," package: ",(0,a.jsx)(n.code,{children:"npm install http-server --save-dev"}),". We'll also amend the ",(0,a.jsx)(n.code,{children:"scripts"})," section of our ",(0,a.jsx)(n.code,{children:"package.json"})," to add in a ",(0,a.jsx)(n.code,{children:"start"})," script:"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"package.json"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsxs)(n.code,{className:"hljs language-diff",children:["{\n",(0,a.jsxs)(n.span,{className:"token unchanged",children:[(0,a.jsx)(n.span,{className:"token prefix unchanged",children:" "}),(0,a.jsx)(n.span,{className:"token line",children:" ...\n"}),(0,a.jsx)(n.span,{className:"token prefix unchanged",children:" "}),(0,a.jsx)(n.span,{className:"token line",children:' "scripts": {\n'})]}),(0,a.jsxs)(n.span,{className:"token deleted-sign deleted",children:[(0,a.jsx)(n.span,{className:"token prefix deleted",children:"-"}),(0,a.jsx)(n.span,{className:"token line",children:'    "build": "webpack"\n'})]}),(0,a.jsxs)(n.span,{className:"token inserted-sign inserted",children:[(0,a.jsx)(n.span,{className:"token prefix inserted",children:"+"}),(0,a.jsx)(n.span,{className:"token line",children:'    "build": "webpack",\n'}),(0,a.jsx)(n.span,{className:"token prefix inserted",children:"+"}),(0,a.jsx)(n.span,{className:"token line",children:'    "start": "http-server dist"\n'})]}),(0,a.jsxs)(n.span,{className:"token unchanged",children:[(0,a.jsx)(n.span,{className:"token prefix unchanged",children:" "}),(0,a.jsx)(n.span,{className:"token line",children:" },\n"}),(0,a.jsx)(n.span,{className:"token prefix unchanged",children:" "}),(0,a.jsx)(n.span,{className:"token line",children:" ...\n"})]}),"}"]})}),"\n",(0,a.jsxs)(n.p,{children:["Note: ",(0,a.jsx)(n.a,{href:"/configuration/dev-server/",children:"webpack DevServer"})," writes in-memory by default. We'll need to enable ",(0,a.jsx)(n.a,{href:"/configuration/dev-server/#devserverdevmiddleware",children:"devserverdevmiddleware.writeToDisk"})," option in order for http-server to be able to serve files from ",(0,a.jsx)(n.code,{children:"./dist"})," directory."]}),"\n",(0,a.jsxs)(n.p,{children:["If you haven't previously done so, run the command ",(0,a.jsx)(n.code,{children:"npm run build"})," to build your project. Then run the command ",(0,a.jsx)(n.code,{children:"npm start"}),". This should produce the following output:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsxs)(n.code,{className:"hljs language-bash",children:[(0,a.jsx)(n.span,{className:"token operator",children:">"})," http-server dist\n\nStarting up http-server, serving dist\nAvailable on:\n  http://xx.x.x.x:8080\n  http://127.0.0.1:8080\n  http://xxx.xxx.x.x:8080\nHit CTRL-C to stop the server"]})}),"\n",(0,a.jsxs)(n.p,{children:["If you open your browser to ",(0,a.jsx)(n.code,{children:"http://localhost:8080"})," (i.e. ",(0,a.jsx)(n.code,{children:"http://127.0.0.1"}),") you should see your webpack application being served from the ",(0,a.jsx)(n.code,{children:"dist"})," directory. If you stop the server and refresh, the webpack application is no longer available."]}),"\n",(0,a.jsx)(n.p,{children:"This is what we aim to change. Once we reach the end of this module we should be able to stop the server, hit refresh and still see our application."}),"\n",(0,a.jsxs)(n.h2,{children:[(0,a.jsx)(n.span,{id:"adding-workbox"}),"Adding Workbox",(0,a.jsx)(n.a,{href:"#adding-workbox","aria-hidden":"true",tabIndex:"-1",children:(0,a.jsx)(n.span,{className:"header-link"})})]}),"\n",(0,a.jsxs)(n.p,{children:["Let's add the Workbox webpack plugin and adjust the ",(0,a.jsx)(n.code,{children:"webpack.config.js"})," file:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsxs)(n.code,{className:"hljs language-bash",children:[(0,a.jsx)(n.span,{className:"token function",children:"npm"})," ",(0,a.jsx)(n.span,{className:"token function",children:"install"})," workbox-webpack-plugin --save-dev"]})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"webpack.config.js"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsxs)(n.code,{className:"hljs language-diff",children:[(0,a.jsxs)(n.span,{className:"token unchanged",children:[(0,a.jsx)(n.span,{className:"token prefix unchanged",children:" "}),(0,a.jsx)(n.span,{className:"token line",children:" const path = require('path');\n"}),(0,a.jsx)(n.span,{className:"token prefix unchanged",children:" "}),(0,a.jsx)(n.span,{className:"token line",children:" const HtmlWebpackPlugin = require('html-webpack-plugin');\n"})]}),(0,a.jsxs)(n.span,{className:"token inserted-sign inserted",children:[(0,a.jsx)(n.span,{className:"token prefix inserted",children:"+"}),(0,a.jsx)(n.span,{className:"token line",children:" const WorkboxPlugin = require('workbox-webpack-plugin');\n"})]}),"\n",(0,a.jsxs)(n.span,{className:"token unchanged",children:[(0,a.jsx)(n.span,{className:"token prefix unchanged",children:" "}),(0,a.jsx)(n.span,{className:"token line",children:" module.exports = {\n"}),(0,a.jsx)(n.span,{className:"token prefix unchanged",children:" "}),(0,a.jsx)(n.span,{className:"token line",children:"   entry: {\n"}),(0,a.jsx)(n.span,{className:"token prefix unchanged",children:" "}),(0,a.jsx)(n.span,{className:"token line",children:"     app: './src/index.js',\n"}),(0,a.jsx)(n.span,{className:"token prefix unchanged",children:" "}),(0,a.jsx)(n.span,{className:"token line",children:"     print: './src/print.js',\n"}),(0,a.jsx)(n.span,{className:"token prefix unchanged",children:" "}),(0,a.jsx)(n.span,{className:"token line",children:"   },\n"}),(0,a.jsx)(n.span,{className:"token prefix unchanged",children:" "}),(0,a.jsx)(n.span,{className:"token line",children:"   plugins: [\n"}),(0,a.jsx)(n.span,{className:"token prefix unchanged",children:" "}),(0,a.jsx)(n.span,{className:"token line",children:"     new HtmlWebpackPlugin({\n"})]}),(0,a.jsxs)(n.span,{className:"token deleted-sign deleted",children:[(0,a.jsx)(n.span,{className:"token prefix deleted",children:"-"}),(0,a.jsx)(n.span,{className:"token line",children:"       title: 'Output Management',\n"})]}),(0,a.jsxs)(n.span,{className:"token inserted-sign inserted",children:[(0,a.jsx)(n.span,{className:"token prefix inserted",children:"+"}),(0,a.jsx)(n.span,{className:"token line",children:"       title: 'Progressive Web Application',\n"})]}),(0,a.jsxs)(n.span,{className:"token unchanged",children:[(0,a.jsx)(n.span,{className:"token prefix unchanged",children:" "}),(0,a.jsx)(n.span,{className:"token line",children:"     }),\n"})]}),(0,a.jsxs)(n.span,{className:"token inserted-sign inserted",children:[(0,a.jsx)(n.span,{className:"token prefix inserted",children:"+"}),(0,a.jsx)(n.span,{className:"token line",children:"     new WorkboxPlugin.GenerateSW({\n"}),(0,a.jsx)(n.span,{className:"token prefix inserted",children:"+"}),(0,a.jsx)(n.span,{className:"token line",children:"       // these options encourage the ServiceWorkers to get in there fast\n"}),(0,a.jsx)(n.span,{className:"token prefix inserted",children:"+"}),(0,a.jsx)(n.span,{className:"token line",children:'       // and not allow any straggling "old" SWs to hang around\n'}),(0,a.jsx)(n.span,{className:"token prefix inserted",children:"+"}),(0,a.jsx)(n.span,{className:"token line",children:"       clientsClaim: true,\n"}),(0,a.jsx)(n.span,{className:"token prefix inserted",children:"+"}),(0,a.jsx)(n.span,{className:"token line",children:"       skipWaiting: true,\n"}),(0,a.jsx)(n.span,{className:"token prefix inserted",children:"+"}),(0,a.jsx)(n.span,{className:"token line",children:"     }),\n"})]}),(0,a.jsxs)(n.span,{className:"token unchanged",children:[(0,a.jsx)(n.span,{className:"token prefix unchanged",children:" "}),(0,a.jsx)(n.span,{className:"token line",children:"   ],\n"}),(0,a.jsx)(n.span,{className:"token prefix unchanged",children:" "}),(0,a.jsx)(n.span,{className:"token line",children:"   output: {\n"}),(0,a.jsx)(n.span,{className:"token prefix unchanged",children:" "}),(0,a.jsx)(n.span,{className:"token line",children:"     filename: '[name].bundle.js',\n"}),(0,a.jsx)(n.span,{className:"token prefix unchanged",children:" "}),(0,a.jsx)(n.span,{className:"token line",children:"     path: path.resolve(__dirname, 'dist'),\n"}),(0,a.jsx)(n.span,{className:"token prefix unchanged",children:" "}),(0,a.jsx)(n.span,{className:"token line",children:"     clean: true,\n"}),(0,a.jsx)(n.span,{className:"token prefix unchanged",children:" "}),(0,a.jsx)(n.span,{className:"token line",children:"   },\n"}),(0,a.jsx)(n.span,{className:"token prefix unchanged",children:" "}),(0,a.jsx)(n.span,{className:"token line",children:" };"})]})]})}),"\n",(0,a.jsxs)(n.p,{children:["With that in place, let's see what happens when we do an ",(0,a.jsx)(n.code,{children:"npm run build"}),":"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsxs)(n.code,{className:"hljs language-bash",children:[(0,a.jsx)(n.span,{className:"token punctuation",children:".."}),".\n                  Asset       Size  Chunks                    Chunk Names\n          app.bundle.js     ",(0,a.jsx)(n.span,{className:"token number",children:"545"})," kB    ",(0,a.jsx)(n.span,{className:"token number",children:"0"}),", ",(0,a.jsx)(n.span,{className:"token number",children:"1"}),"  ",(0,a.jsx)(n.span,{className:"token punctuation",children:"["}),"emitted",(0,a.jsx)(n.span,{className:"token punctuation",children:"]"}),"  ",(0,a.jsx)(n.span,{className:"token punctuation",children:"["}),"big",(0,a.jsx)(n.span,{className:"token punctuation",children:"]"}),"  app\n        print.bundle.js    ",(0,a.jsx)(n.span,{className:"token number",children:"2.74"})," kB       ",(0,a.jsx)(n.span,{className:"token number",children:"1"}),"  ",(0,a.jsx)(n.span,{className:"token punctuation",children:"["}),"emitted",(0,a.jsx)(n.span,{className:"token punctuation",children:"]"}),"         print\n             index.html  ",(0,a.jsx)(n.span,{className:"token number",children:"254"})," bytes          ",(0,a.jsx)(n.span,{className:"token punctuation",children:"["}),"emitted",(0,a.jsx)(n.span,{className:"token punctuation",children:"]"}),"\nprecache-manifest.b5ca1c555e832d6fbf9462efd29d27eb.js  ",(0,a.jsx)(n.span,{className:"token number",children:"268"})," bytes          ",(0,a.jsx)(n.span,{className:"token punctuation",children:"["}),"emitted",(0,a.jsx)(n.span,{className:"token punctuation",children:"]"}),"\n      service-worker.js       ",(0,a.jsx)(n.span,{className:"token number",children:"1"})," kB          ",(0,a.jsx)(n.span,{className:"token punctuation",children:"["}),"emitted",(0,a.jsx)(n.span,{className:"token punctuation",children:"]"}),"\n",(0,a.jsx)(n.span,{className:"token punctuation",children:".."}),"."]})}),"\n",(0,a.jsxs)(n.p,{children:["As you can see, we now have 2 extra files being generated; ",(0,a.jsx)(n.code,{children:"service-worker.js"})," and the more verbose ",(0,a.jsx)(n.code,{children:"precache-manifest.b5ca1c555e832d6fbf9462efd29d27eb.js"}),". ",(0,a.jsx)(n.code,{children:"service-worker.js"})," is the Service Worker file and ",(0,a.jsx)(n.code,{children:"precache-manifest.b5ca1c555e832d6fbf9462efd29d27eb.js"})," is a file that ",(0,a.jsx)(n.code,{children:"service-worker.js"})," requires so it can run. Your own generated files will likely be different; but you should have a ",(0,a.jsx)(n.code,{children:"service-worker.js"})," file there."]}),"\n",(0,a.jsx)(n.p,{children:"So we're now at the happy point of having produced a Service Worker. What's next?"}),"\n",(0,a.jsxs)(n.h2,{children:[(0,a.jsx)(n.span,{id:"registering-our-service-worker"}),"Registering Our Service Worker",(0,a.jsx)(n.a,{href:"#registering-our-service-worker","aria-hidden":"true",tabIndex:"-1",children:(0,a.jsx)(n.span,{className:"header-link"})})]}),"\n",(0,a.jsx)(n.p,{children:"Let's allow our Service Worker to come out and play by registering it. We'll do that by adding the registration code below:"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"index.js"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsxs)(n.code,{className:"hljs language-diff",children:[(0,a.jsxs)(n.span,{className:"token unchanged",children:[(0,a.jsx)(n.span,{className:"token prefix unchanged",children:" "}),(0,a.jsx)(n.span,{className:"token line",children:" import _ from 'lodash';\n"}),(0,a.jsx)(n.span,{className:"token prefix unchanged",children:" "}),(0,a.jsx)(n.span,{className:"token line",children:" import printMe from './print.js';\n"})]}),"\n",(0,a.jsxs)(n.span,{className:"token inserted-sign inserted",children:[(0,a.jsx)(n.span,{className:"token prefix inserted",children:"+"}),(0,a.jsx)(n.span,{className:"token line",children:" if ('serviceWorker' in navigator) {\n"}),(0,a.jsx)(n.span,{className:"token prefix inserted",children:"+"}),(0,a.jsx)(n.span,{className:"token line",children:"   window.addEventListener('load', () => {\n"}),(0,a.jsx)(n.span,{className:"token prefix inserted",children:"+"}),(0,a.jsx)(n.span,{className:"token line",children:"     navigator.serviceWorker.register('/service-worker.js').then(registration => {\n"}),(0,a.jsx)(n.span,{className:"token prefix inserted",children:"+"}),(0,a.jsx)(n.span,{className:"token line",children:"       console.log('SW registered: ', registration);\n"}),(0,a.jsx)(n.span,{className:"token prefix inserted",children:"+"}),(0,a.jsx)(n.span,{className:"token line",children:"     }).catch(registrationError => {\n"}),(0,a.jsx)(n.span,{className:"token prefix inserted",children:"+"}),(0,a.jsx)(n.span,{className:"token line",children:"       console.log('SW registration failed: ', registrationError);\n"}),(0,a.jsx)(n.span,{className:"token prefix inserted",children:"+"}),(0,a.jsx)(n.span,{className:"token line",children:"     });\n"}),(0,a.jsx)(n.span,{className:"token prefix inserted",children:"+"}),(0,a.jsx)(n.span,{className:"token line",children:"   });\n"}),(0,a.jsx)(n.span,{className:"token prefix inserted",children:"+"}),(0,a.jsx)(n.span,{className:"token line",children:" }"})]})]})}),"\n",(0,a.jsxs)(n.p,{children:["Once more ",(0,a.jsx)(n.code,{children:"npm run build"})," to build a version of the app including the registration code. Then serve it with ",(0,a.jsx)(n.code,{children:"npm start"}),". Navigate to ",(0,a.jsx)(n.code,{children:"http://localhost:8080"})," and take a look at the console. Somewhere in there you should see:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"hljs language-bash",children:"SW registered"})}),"\n",(0,a.jsxs)(n.p,{children:["Now to test it. Stop your server and refresh your page. If your browser supports Service Workers then you should still be looking at your application. However, it has been served up by your Service Worker and ",(0,a.jsx)(n.strong,{children:"not"})," by the server."]}),"\n",(0,a.jsxs)(n.h2,{children:[(0,a.jsx)(n.span,{id:"conclusion"}),"Conclusion",(0,a.jsx)(n.a,{href:"#conclusion","aria-hidden":"true",tabIndex:"-1",children:(0,a.jsx)(n.span,{className:"header-link"})})]}),"\n",(0,a.jsxs)(n.p,{children:["You have built an offline app using the Workbox project. You've started the journey of turning your web app into a PWA. You may now want to think about taking things further. A good resource to help you with that can be found ",(0,a.jsx)(n.a,{href:"https://web.dev/progressive-web-apps/",children:"here"}),"."]})]})}function l(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(i,{...e})}):i(e)}}}]);