<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>webpack</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    
      <link href="/style.css" rel="stylesheet">
    
  </head>
  <body>
    <div class="site"><div class="navigation"><div class="container "><div class="navigation__inner"><button class="navigation__mobilebtn">Open navigation</button><a class="navigation__logo" href="/"><span class="logo logo--light"><span class="cube cube--light logo__cube" style="width:20px;margin-left:10px;padding-bottom:10px;"><figure class="cube__outer" style="width:20px;height:20px;transform:translateX(-50%)
              scale3d(1,1,1)
              rotateX(0deg)
              rotateY(0deg)
              rotateZ(0deg);"><section class="cube__face" style="transform:rotateX(0deg) translateZ(10px);"></section><section class="cube__face" style="transform:rotateX(-90deg) translateZ(10px);"></section><section class="cube__face" style="transform:rotateX(90deg) translateZ(10px);"></section><section class="cube__face" style="transform:rotateY(-90deg) translateZ(10px);"></section><section class="cube__face" style="transform:rotateY(90deg) translateZ(10px);"></section><section class="cube__face" style="transform:rotateY(180deg) translateZ(10px);"></section></figure><figure class="cube__inner" style="width:20px;height:20px;transform:translateX(-50%)
              scale3d(0.5,0.5,0.5)
              rotateX(0deg)
              rotateY(0deg)
              rotateZ(0deg);"><section class="cube__face" style="transform:rotateX(0deg) translateZ(10px);"></section><section class="cube__face" style="transform:rotateX(-90deg) translateZ(10px);"></section><section class="cube__face" style="transform:rotateX(90deg) translateZ(10px);"></section><section class="cube__face" style="transform:rotateY(-90deg) translateZ(10px);"></section><section class="cube__face" style="transform:rotateY(90deg) translateZ(10px);"></section><section class="cube__face" style="transform:rotateY(180deg) translateZ(10px);"></section></figure></span><span class="logo__text">webpack</span></span></a><nav class="navigation__links"><a class="navigation__link" href="/concepts">Concepts</a><a class="navigation__link" href="/configuration">Configuration</a><a class="navigation__link" href="/how-to">How to</a><a class="navigation__link" href="/api">API</a><a class="navigation__link" href="///github.com/webpack/webpack.js.org">Github</a></nav></div></div></div><aside class="sidecar"><a class="sidecar__link sidecar__link--github" href="//github.com/webpack/webpack"><span class="sidecar__label">Fork the Repo</span><i class="sidecar__icon icon-github"></i></a><a class="sidecar__link sidecar__link--gitter" href="#"><span class="sidecar__label">Find Help</span><i class="sidecar__icon icon-gitter"></i></a><a class="sidecar__link sidecar__link--medium" href="//medium.com/webpack"><span class="sidecar__label">Visit Our Blog</span><i class="sidecar__icon icon-medium"></i></a><a class="sidecar__link sidecar__link--so" href="//stackoverflow.com/questions/tagged/webpack"><span class="sidecar__label">Stack Overflow</span><i class="sidecar__icon icon-stack-overflow"></i></a></aside><div class="container page"><nav class="sidebar"><div class="sidebar__inner"><div class="sidebar-item sidebar-item--empty "><a class="sidebar-item__title" href="/how-to">Introduction</a><i class="sidebar-item__toggle icon-chevron-down"></i><ul class="sidebar-item__anchors"></ul></div><div class="sidebar-item sidebar-item--empty "><a class="sidebar-item__title" href="/how-to/author-libraries">How to Author Libraries?</a><i class="sidebar-item__toggle icon-chevron-down"></i><ul class="sidebar-item__anchors"></ul></div><div class="sidebar-item  "><a class="sidebar-item__title" href="/how-to/cache">How to Cache?</a><i class="sidebar-item__toggle icon-chevron-down"></i><ul class="sidebar-item__anchors"><li class="sidebar-item__anchor"><a href="/how-to/cache#the-problem">The problem</a></li><li class="sidebar-item__anchor"><a href="/how-to/cache#generating-unique-hashes-for-each-file">Generating unique hashes for each file</a></li><li class="sidebar-item__anchor"><a href="/how-to/cache#get-filenames-from-webpack-compilation-stats">Get filenames from webpack compilation stats</a></li><li class="sidebar-item__anchor"><a href="/how-to/cache#deterministic-hashes">Deterministic hashes</a></li><li class="sidebar-item__anchor"><a href="/how-to/cache#references">References</a></li></ul></div><div class="sidebar-item  "><a class="sidebar-item__title" href="/how-to/develop-using-vagrant">How to Develop Using Vagrant</a><i class="sidebar-item__toggle icon-chevron-down"></i><ul class="sidebar-item__anchors"><li class="sidebar-item__anchor"><a href="/how-to/develop-using-vagrant#configuring-the-project">Configuring the Project</a></li><li class="sidebar-item__anchor"><a href="/how-to/develop-using-vagrant#running-the-server">Running the Server</a></li><li class="sidebar-item__anchor"><a href="/how-to/develop-using-vagrant#advanced-usage-with-nginx">Advanced Usage with nginx</a></li><li class="sidebar-item__anchor"><a href="/how-to/develop-using-vagrant#conclusion">Conclusion</a></li></ul></div><div class="sidebar-item sidebar-item--empty "><a class="sidebar-item__title" href="/how-to/develop">How to Develop?</a><i class="sidebar-item__toggle icon-chevron-down"></i><ul class="sidebar-item__anchors"></ul></div><div class="sidebar-item  "><a class="sidebar-item__title" href="/how-to/generate-production-build">How to Generate a Production Build?</a><i class="sidebar-item__toggle icon-chevron-down"></i><ul class="sidebar-item__anchors"><li class="sidebar-item__anchor"><a href="/how-to/generate-production-build#source-maps">Source Maps</a></li><li class="sidebar-item__anchor"><a href="/how-to/generate-production-build#node-environment-variable">Node environment variable</a></li><li class="sidebar-item__anchor"><a href="/how-to/generate-production-build#minification">Minification</a></li></ul></div><div class="sidebar-item sidebar-item--empty "><a class="sidebar-item__title" href="/how-to/handle-compatibility">How to Handle Compatibility?</a><i class="sidebar-item__toggle icon-chevron-down"></i><ul class="sidebar-item__anchors"></ul></div><div class="sidebar-item sidebar-item--empty "><a class="sidebar-item__title" href="/how-to/handle-dependencies">How to Handle Dependencies?</a><i class="sidebar-item__toggle icon-chevron-down"></i><ul class="sidebar-item__anchors"></ul></div><div class="sidebar-item  "><a class="sidebar-item__title" href="/how-to/hot-module-reload">How to Configure Hot Module Replacement?</a><i class="sidebar-item__toggle icon-chevron-down"></i><ul class="sidebar-item__anchors"><li class="sidebar-item__anchor"><a href="/how-to/hot-module-reload#babel-config">Babel Config</a></li><li class="sidebar-item__anchor"><a href="/how-to/hot-module-reload#webpack-config">Webpack config</a></li><li class="sidebar-item__anchor"><a href="/how-to/hot-module-reload#code">Code</a></li><li class="sidebar-item__anchor"><a href="/how-to/hot-module-reload#package-json">Package.json</a></li></ul></div><div class="sidebar-item sidebar-item--empty "><a class="sidebar-item__title" href="/how-to/improve-build-performance">How to Improve Build Performance?</a><i class="sidebar-item__toggle icon-chevron-down"></i><ul class="sidebar-item__anchors"></ul></div><div class="sidebar-item  "><a class="sidebar-item__title" href="/how-to/install-webpack">How to Install webpack?</a><i class="sidebar-item__toggle icon-chevron-down"></i><ul class="sidebar-item__anchors"><li class="sidebar-item__anchor"><a href="/how-to/install-webpack#pre-requistes">Pre-requistes</a></li><li class="sidebar-item__anchor"><a href="/how-to/install-webpack#global-installation">Global Installation</a></li><li class="sidebar-item__anchor"><a href="/how-to/install-webpack#local-installation">Local Installation</a></li><li class="sidebar-item__anchor"><a href="/how-to/install-webpack#bleeding-edge">Bleeding Edge</a></li></ul></div><div class="sidebar-item  "><a class="sidebar-item__title" href="/how-to/set-up-hmr-with-react">How to Set Up Hot Module Replacement with React?</a><i class="sidebar-item__toggle icon-chevron-down"></i><ul class="sidebar-item__anchors"><li class="sidebar-item__anchor"><a href="/how-to/set-up-hmr-with-react#project-config">Project Config</a></li><li class="sidebar-item__anchor"><a href="/how-to/set-up-hmr-with-react#babel-config">Babel Config</a></li><li class="sidebar-item__anchor"><a href="/how-to/set-up-hmr-with-react#webpack-config">Webpack config</a></li><li class="sidebar-item__anchor"><a href="/how-to/set-up-hmr-with-react#code">Code</a></li><li class="sidebar-item__anchor"><a href="/how-to/set-up-hmr-with-react#package-json">Package.json</a></li></ul></div><div class="sidebar-item sidebar-item--empty "><a class="sidebar-item__title" href="/how-to/shim">How to Shim?</a><i class="sidebar-item__toggle icon-chevron-down"></i><ul class="sidebar-item__anchors"></ul></div><div class="sidebar-item sidebar-item--empty "><a class="sidebar-item__title" href="/how-to/split-code">How to Split Code?</a><i class="sidebar-item__toggle icon-chevron-down"></i><ul class="sidebar-item__anchors"></ul></div><div class="sidebar-item  "><a class="sidebar-item__title" href="/how-to/upgrade-from-webpack-1">How to Upgrade from Webpack 1?</a><i class="sidebar-item__toggle icon-chevron-down"></i><ul class="sidebar-item__anchors"><li class="sidebar-item__anchor"><a href="/how-to/upgrade-from-webpack-1#resolve-root-resolve-fallback-resolve-modulesdirectories">resolve.root, resolve.fallback, resolve.modulesDirectories</a></li><li class="sidebar-item__anchor"><a href="/how-to/upgrade-from-webpack-1#resolve-extensions">resolve.extensions</a></li><li class="sidebar-item__anchor"><a href="/how-to/upgrade-from-webpack-1#resolve-">resolve.*</a></li><li class="sidebar-item__anchor"><a href="/how-to/upgrade-from-webpack-1#debug">debug</a></li><li class="sidebar-item__anchor"><a href="/how-to/upgrade-from-webpack-1#uglifyjsplugin-sourcemap">UglifyJsPlugin sourceMap</a></li><li class="sidebar-item__anchor"><a href="/how-to/upgrade-from-webpack-1#uglifyjsplugin-minimize-loaders">UglifyJsPlugin minimize loaders</a></li><li class="sidebar-item__anchor"><a href="/how-to/upgrade-from-webpack-1#occurrenceorderplugin-is-now-on-by-default">OccurrenceOrderPlugin is now on by default</a></li><li class="sidebar-item__anchor"><a href="/how-to/upgrade-from-webpack-1#full-dynamic-requires-now-fail-by-default">full dynamic requires now fail by default</a></li><li class="sidebar-item__anchor"><a href="/how-to/upgrade-from-webpack-1#using-custom-arguments-in-cli-and-configuration">Using custom arguments in CLI and configuration</a></li><li class="sidebar-item__anchor"><a href="/how-to/upgrade-from-webpack-1#require-ensure-and-amd-require-is-async">require.ensure and AMD require is async</a></li><li class="sidebar-item__anchor"><a href="/how-to/upgrade-from-webpack-1#module-loaders-is-now-module-rules">module.loaders is now module.rules</a></li><li class="sidebar-item__anchor"><a href="/how-to/upgrade-from-webpack-1#module-preloaders-and-module-postloaders-was-removed">module.preLoaders and module.postLoaders was removed</a></li><li class="sidebar-item__anchor"><a href="/how-to/upgrade-from-webpack-1#loaderoptionplugin-context">LoaderOptionPlugin context</a></li></ul></div><div class="sidebar-item  "><a class="sidebar-item__title" href="/how-to/use-with-docker">How to Use with Docker?</a><i class="sidebar-item__toggle icon-chevron-down"></i><ul class="sidebar-item__anchors"><li class="sidebar-item__anchor"><a href="/how-to/use-with-docker#what-is-docker">What is docker</a></li></ul></div><div class="sidebar-item sidebar-item--empty "><a class="sidebar-item__title" href="/how-to/use-with-third-party-tools">How to Use with Third Party Tools?</a><i class="sidebar-item__toggle icon-chevron-down"></i><ul class="sidebar-item__anchors"></ul></div></div></nav><section class="page__content"><h1>How to Cache?</h1><a class="page__edit" href="https://github.com/webpack/webpack.js.org/edit/master/content/how-to/cache.md">Edit this Page  <i class="icon-edit"></i></a><div><p>To enable long-term caching of static resources produced by webpack:</p>
<ol>
<li>Use <code>[chunkhash]</code> to add a content-dependent cache-buster to each file.</li>
<li>Use compiler stats to get the file names when requiring resources in HTML.</li>
<li>Generate the chunk-manifest JSON and inline it into the HTML page before loading resources.</li>
<li>Ensure that the entry point chunk containing the bootstrapping code doesn’t change its hash over time for the same set of dependencies.</li>
</ol>
<h2 class="header"><a class="anchor" href="#the-problem" id="the-problem"></a><span class="text">The problem</span><a class="icon-link" href="#the-problem"></a></h2>
<p>Each time something needs to be updated in our code, it has to be re-deployed on the server and then re-downloaded by all clients. This is clearly inefficient since fetching resources over the network can be slow. This is why browsers cache static resources.</p>
<p>The way it works has a pitfall: if we don’t change filenames of our resources when deploying a new version, browser might think it hasn’t been updated and client will get a cached version of it.</p>
<p>Probably the simplest way to tell the browser to download a newer version is to alter asset’s file name. In a pre-webpack era we used to add a build number to the filenames as a parameter and then increment it:</p>
<pre><code class="lang-bash">application.js?build<span class="token operator" >=</span>1
application.css?build<span class="token operator" >=</span>1
</code></pre>
<p>It is even easier to do with webpack: each webpack build generates a unique hash which can be used to compose a filename. The following example config will generate 2 files (1 per entry point) with a hash in filenames:</p>
<pre><code class="lang-js"><span class="token comment" spellcheck="true">// webpack.config.js</span>
<span class="token keyword" >const</span> path <span class="token operator" >=</span> <span class="token function" >require</span><span class="token punctuation" >(</span><span class="token string" >'path'</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>

module<span class="token punctuation" >.</span>exports <span class="token operator" >=</span> <span class="token punctuation" >{</span>
  entry<span class="token punctuation" >:</span> <span class="token punctuation" >{</span>
    vendor<span class="token punctuation" >:</span> <span class="token string" >'./src/vendor.js'</span><span class="token punctuation" >,</span>
    main<span class="token punctuation" >:</span> <span class="token string" >'./src/index.js'</span>
  <span class="token punctuation" >}</span><span class="token punctuation" >,</span>
  output<span class="token punctuation" >:</span> <span class="token punctuation" >{</span>
    path<span class="token punctuation" >:</span> path<span class="token punctuation" >.</span><span class="token function" >join</span><span class="token punctuation" >(</span>__dirname<span class="token punctuation" >,</span> <span class="token string" >'build'</span><span class="token punctuation" >)</span><span class="token punctuation" >,</span>
    filename<span class="token punctuation" >:</span> <span class="token string" >'[name].[hash].js'</span>
  <span class="token punctuation" >}</span>
<span class="token punctuation" >}</span><span class="token punctuation" >;</span>
</code></pre>
<p>Running webpack with this config will produce the following output:</p>
<pre><code class="lang-bash">Hash: 55e783391098c2496a8f
Version: webpack 1.10.1
Time: 58ms
Asset Size Chunks Chunk Names
main.55e783391098c2496a8f.js 1.43 kB 0 <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span> main
vendor.55e783391098c2496a8f.js 1.43 kB 1 <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span> vendor
<span class="token punctuation" >[</span>0<span class="token punctuation" >]</span> ./src/index.js 46 bytes <span class="token punctuation" >{</span>0<span class="token punctuation" >}</span> <span class="token punctuation" >[</span>built<span class="token punctuation" >]</span>
<span class="token punctuation" >[</span>0<span class="token punctuation" >]</span> ./src/vendor.js 40 bytes <span class="token punctuation" >{</span>1<span class="token punctuation" >}</span> <span class="token punctuation" >[</span>built<span class="token punctuation" >]</span>
</code></pre>
<p>But the problem here is that, <em>each</em> time we create a new build, all filenames will get altered and clients will have to re-download the whole application code again. So how can we guarantee that clients always get the latest versions of assets without re-downloading all of them?</p>
<h2 class="header"><a class="anchor" href="#generating-unique-hashes-for-each-file" id="generating-unique-hashes-for-each-file"></a><span class="text">Generating unique hashes for each file</span><a class="icon-link" href="#generating-unique-hashes-for-each-file"></a></h2>
<p>What if we could produce the same filename if the contents of the file did not change between builds? For example, the file where we put all our libraries and other vendor stuff does not change that often.</p>
<blockquote class="tip"><div class="tip-title"><i class="tip-icon icon-info"></i>tip</div>Separate your vendor and application code with <a href="https://webpack.github.io/docs/list-of-plugins.html#2-explicit-vendor-chunk">CommonsChunkPlugin</a> and create an explicit vendor chunk to prevent it from changing too often.</blockquote><p>Webpack allows you to generate hashes depending on the file contents. Here is the updated config:</p>
<pre><code class="lang-js"><span class="token comment" spellcheck="true">// webpack.config.js</span>
module<span class="token punctuation" >.</span>exports <span class="token operator" >=</span> <span class="token punctuation" >{</span>
  <span class="token comment" spellcheck="true">/*...*/</span>
  output<span class="token punctuation" >:</span> <span class="token punctuation" >{</span>
    <span class="token comment" spellcheck="true">/*...*/</span>
    filename<span class="token punctuation" >:</span> <span class="token string" >'[name].[chunkhash].js'</span>
  <span class="token punctuation" >}</span>
<span class="token punctuation" >}</span><span class="token punctuation" >;</span>
</code></pre>
<p>This config will also create 2 files, but in this case, each file will get its own unique hash.</p>
<pre><code class="lang-bash">main.155567618f4367cd1cb8.js 1.43 kB 0 <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span> main
vendor.c2330c22cd2decb5da5a.js 1.43 kB 1 <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span> vendor
</code></pre>
<blockquote class="tip"><div class="tip-title"><i class="tip-icon icon-info"></i>tip</div>Don’t use [chunkhash] in development since this will increase compilation time. Separate development and production configs and use [name].js for development and [name].[chunkhash].js in production.</blockquote><blockquote class="warning"><div class="tip-title"><i class="tip-icon icon-warning"></i>warning</div>Due to this <a href="https://github.com/webpack/webpack/issues/1315">issue in Webpack</a>, this method of generating hashes still isn’t deterministic. To ensure hashes are generated based on the file contents, use <a href="https://github.com/erm0l0v/webpack-md5-hash">webpack-md5-hash plugin</a>. Here is an example how to integrate it into your project: <a href="https://github.com/okonet/webpack-long-term-cache-demo/pull/3/files">https://github.com/okonet/webpack-long-term-cache-demo/pull/3/files</a></blockquote><h2 class="header"><a class="anchor" href="#get-filenames-from-webpack-compilation-stats" id="get-filenames-from-webpack-compilation-stats"></a><span class="text">Get filenames from webpack compilation stats</span><a class="icon-link" href="#get-filenames-from-webpack-compilation-stats"></a></h2>
<p>When working in development mode, you just reference a JavaScript file by entry point name in your HTML.</p>
<pre><code class="lang-html"><span class="token tag" ><span class="token tag" ><span class="token punctuation" >&lt;</span>script</span> <span class="token attr-name" >src</span><span class="token attr-value" ><span class="token punctuation" >=</span><span class="token punctuation" >"</span>main.js<span class="token punctuation" >"</span></span><span class="token punctuation" >></span></span><span class="token tag" ><span class="token tag" ><span class="token punctuation" >&lt;/</span>script</span><span class="token punctuation" >></span></span>
</code></pre>
<p>Although, each time we build for production, we’ll get different file names. Something, that looks like this:</p>
<pre><code class="lang-html"><span class="token tag" ><span class="token tag" ><span class="token punctuation" >&lt;</span>script</span> <span class="token attr-name" >src</span><span class="token attr-value" ><span class="token punctuation" >=</span><span class="token punctuation" >"</span>main.155567618f4367cd1cb8.js<span class="token punctuation" >"</span></span><span class="token punctuation" >></span></span><span class="token tag" ><span class="token tag" ><span class="token punctuation" >&lt;/</span>script</span><span class="token punctuation" >></span></span>
</code></pre>
<p>In order to reference a correct file in the HTML, we’ll need some information about our build. This can be extracted from webpack compilation stats by using this simple plugin:</p>
<pre><code class="lang-js"><span class="token comment" spellcheck="true">// webpack.config.js</span>
<span class="token keyword" >const</span> path <span class="token operator" >=</span> <span class="token function" >require</span><span class="token punctuation" >(</span><span class="token string" >'path'</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>

module<span class="token punctuation" >.</span>exports <span class="token operator" >=</span> <span class="token punctuation" >{</span>
  <span class="token comment" spellcheck="true">/*...*/</span>
  plugins<span class="token punctuation" >:</span> <span class="token punctuation" >[</span>
    <span class="token keyword" >function</span><span class="token punctuation" >(</span><span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
      <span class="token keyword" >this</span><span class="token punctuation" >.</span><span class="token function" >plugin</span><span class="token punctuation" >(</span><span class="token string" >"done"</span><span class="token punctuation" >,</span> <span class="token keyword" >function</span><span class="token punctuation" >(</span>stats<span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
        <span class="token function" >require</span><span class="token punctuation" >(</span><span class="token string" >"fs"</span><span class="token punctuation" >)</span><span class="token punctuation" >.</span><span class="token function" >writeFileSync</span><span class="token punctuation" >(</span>
          path<span class="token punctuation" >.</span><span class="token function" >join</span><span class="token punctuation" >(</span>__dirname<span class="token punctuation" >,</span> <span class="token string" >"…"</span><span class="token punctuation" >,</span> <span class="token string" >"stats.json"</span><span class="token punctuation" >)</span><span class="token punctuation" >,</span>
          JSON<span class="token punctuation" >.</span><span class="token function" >stringify</span><span class="token punctuation" >(</span>stats<span class="token punctuation" >.</span><span class="token function" >toJson</span><span class="token punctuation" >(</span><span class="token punctuation" >)</span><span class="token punctuation" >)</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
      <span class="token punctuation" >}</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
    <span class="token punctuation" >}</span>
  <span class="token punctuation" >]</span>
<span class="token punctuation" >}</span><span class="token punctuation" >;</span>
</code></pre>
<p>Alternatively, just use one of these plugins to export JSON files:</p>
<ul>
<li><a href="https://www.npmjs.com/package/webpack-manifest-plugin">https://www.npmjs.com/package/webpack-manifest-plugin</a></li>
<li><a href="https://www.npmjs.com/package/assets-webpack-plugin">https://www.npmjs.com/package/assets-webpack-plugin</a></li>
</ul>
<p>A sample output of webpack-manifest-plugin for our config looks like:</p>
<pre><code class="lang-json"><span class="token punctuation" >{</span>
  "main.js"<span class="token operator" >:</span> <span class="token string" >"main.155567618f4367cd1cb8.js"</span><span class="token punctuation" >,</span>
  "vendor.js"<span class="token operator" >:</span> <span class="token string" >"vendor.c2330c22cd2decb5da5a.js"</span>
<span class="token punctuation" >}</span>
</code></pre>
<p>The rest depends on your server setup. There is a nice <a href="http://clarkdave.net/2015/01/how-to-use-webpack-with-rails/#including-precompiled-assets-in-views">walk through for Rails-based projects</a>. Or, if your application doesn’t rely on any server-side rendering, it’s often enough to generate a single <code>index.html</code> file for your application. To do so, just use these 2 amazing plugins:</p>
<ul>
<li><a href="https://github.com/ampedandwired/html-webpack-plugin">https://github.com/ampedandwired/html-webpack-plugin</a></li>
<li><a href="https://github.com/szrenwei/inline-manifest-webpack-plugin">https://github.com/szrenwei/inline-manifest-webpack-plugin</a></li>
</ul>
<p>It will simplify the setup dramatically.</p>
<p>We’re done, you might think. Well, almost.</p>
<h2 class="header"><a class="anchor" href="#deterministic-hashes" id="deterministic-hashes"></a><span class="text">Deterministic hashes</span><a class="icon-link" href="#deterministic-hashes"></a></h2>
<p>To minimise the size of generated files, webpack uses identifiers instead of module names. During compilation identifiers are generated, mapped to chunk filenames and then put into a JavaScript object called <em>chunk manifest</em>. It is (along with some bootstrapping code) then placed into the entry chunk and it is crucial for webpack-packaged code to work.</p>
<p>The problem with this is the same as before: whenever we change any part of the code, it will, even if the rest of its contents wasn’t altered, update our entry chunk to include the new manifest. This, in turn, will lead to a new hash and dismiss the long-term caching.</p>
<p>To fix that, we should use <a href="https://github.com/diurnalist/chunk-manifest-webpack-plugin">chunk-manifest-webpack-plugin</a> which will extract that manifest to a separate JSON file. Here is an updated webpack.config.js which will produce chunk-manifest.json in our build directory:</p>
<pre><code class="lang-js"><span class="token comment" spellcheck="true">// webpack.config.js</span>
<span class="token keyword" >var</span> ChunkManifestPlugin <span class="token operator" >=</span> <span class="token function" >require</span><span class="token punctuation" >(</span><span class="token string" >'chunk-manifest-webpack-plugin'</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>

module<span class="token punctuation" >.</span>exports <span class="token operator" >=</span> <span class="token punctuation" >{</span>
  <span class="token comment" spellcheck="true">// your config values here</span>
  plugins<span class="token punctuation" >:</span> <span class="token punctuation" >[</span>
    <span class="token keyword" >new</span> <span class="token class-name" >ChunkManifestPlugin</span><span class="token punctuation" >(</span><span class="token punctuation" >{</span>
      filename<span class="token punctuation" >:</span> <span class="token string" >"chunk-manifest.json"</span><span class="token punctuation" >,</span>
      manifestVariable<span class="token punctuation" >:</span> <span class="token string" >"webpackManifest"</span>
    <span class="token punctuation" >}</span><span class="token punctuation" >)</span>
  <span class="token punctuation" >]</span>
<span class="token punctuation" >}</span><span class="token punctuation" >;</span>
</code></pre>
<p>Since we removed the manifest from entry chunk, now it’s our responsibility to provide webpack with it. You have probably noticed the <code>manifestVariable</code> option in the example above. This is the name of the global variable where webpack will look for the manifest JSON and this is why <em>it should be defined before we require our bundle in HTML</em>. This is easy as inlining the contents of the JSON in HTML. Our HTML head section should look like this:</p>
<pre><code class="lang-html"><span class="token tag" ><span class="token tag" ><span class="token punctuation" >&lt;</span>html</span><span class="token punctuation" >></span></span>
  <span class="token tag" ><span class="token tag" ><span class="token punctuation" >&lt;</span>head</span><span class="token punctuation" >></span></span>
    <span class="token tag" ><span class="token tag" ><span class="token punctuation" >&lt;</span>script</span><span class="token punctuation" >></span></span>
    //<span class="token cdata" >&lt;![CDATA[
    window.webpackManifest = {"0":"main.3d038f325b02fdee5724.js","1":"1.c4116058de00860e5aa8.js"}
    //]]></span>
    <span class="token tag" ><span class="token tag" ><span class="token punctuation" >&lt;/</span>script</span><span class="token punctuation" >></span></span>
  <span class="token tag" ><span class="token tag" ><span class="token punctuation" >&lt;/</span>head</span><span class="token punctuation" >></span></span>
  <span class="token tag" ><span class="token tag" ><span class="token punctuation" >&lt;</span>body</span><span class="token punctuation" >></span></span>
  <span class="token tag" ><span class="token tag" ><span class="token punctuation" >&lt;/</span>body</span><span class="token punctuation" >></span></span>
<span class="token tag" ><span class="token tag" ><span class="token punctuation" >&lt;/</span>html</span><span class="token punctuation" >></span></span>
</code></pre>
<p>So the final webpack.config.js should look like this:</p>
<pre><code class="lang-js"><span class="token keyword" >var</span> path <span class="token operator" >=</span> <span class="token function" >require</span><span class="token punctuation" >(</span><span class="token string" >'path'</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
<span class="token keyword" >var</span> webpack <span class="token operator" >=</span> <span class="token function" >require</span><span class="token punctuation" >(</span><span class="token string" >'webpack'</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
<span class="token keyword" >var</span> ManifestPlugin <span class="token operator" >=</span> <span class="token function" >require</span><span class="token punctuation" >(</span><span class="token string" >'webpack-manifest-plugin'</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
<span class="token keyword" >var</span> ChunkManifestPlugin <span class="token operator" >=</span> <span class="token function" >require</span><span class="token punctuation" >(</span><span class="token string" >'chunk-manifest-webpack-plugin'</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
<span class="token keyword" >var</span> WebpackMd5Hash <span class="token operator" >=</span> <span class="token function" >require</span><span class="token punctuation" >(</span><span class="token string" >'webpack-md5-hash'</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>

module<span class="token punctuation" >.</span>exports <span class="token operator" >=</span> <span class="token punctuation" >{</span>
  entry<span class="token punctuation" >:</span> <span class="token punctuation" >{</span>
    vendor<span class="token punctuation" >:</span> <span class="token string" >'./src/vendor.js'</span><span class="token punctuation" >,</span>
    main<span class="token punctuation" >:</span> <span class="token string" >'./src/index.js'</span>
  <span class="token punctuation" >}</span><span class="token punctuation" >,</span>
  output<span class="token punctuation" >:</span> <span class="token punctuation" >{</span>
    path<span class="token punctuation" >:</span> path<span class="token punctuation" >.</span><span class="token function" >join</span><span class="token punctuation" >(</span>__dirname<span class="token punctuation" >,</span> <span class="token string" >'build'</span><span class="token punctuation" >)</span><span class="token punctuation" >,</span>
    filename<span class="token punctuation" >:</span> <span class="token string" >'[name].[chunkhash].js'</span><span class="token punctuation" >,</span>
    chunkFilename<span class="token punctuation" >:</span> <span class="token string" >'[name].[chunkhash].js'</span>
  <span class="token punctuation" >}</span><span class="token punctuation" >,</span>
  plugins<span class="token punctuation" >:</span> <span class="token punctuation" >[</span>
    <span class="token keyword" >new</span> <span class="token class-name" >webpack<span class="token punctuation" >.</span>optimize<span class="token punctuation" >.</span>CommonsChunkPlugin</span><span class="token punctuation" >(</span><span class="token punctuation" >{</span>
      name<span class="token punctuation" >:</span> <span class="token string" >"vendor"</span><span class="token punctuation" >,</span>
      minChunks<span class="token punctuation" >:</span> <span class="token number" >Infinity</span><span class="token punctuation" >,</span>
    <span class="token punctuation" >}</span><span class="token punctuation" >)</span><span class="token punctuation" >,</span>
    <span class="token keyword" >new</span> <span class="token class-name" >WebpackMd5Hash</span><span class="token punctuation" >(</span><span class="token punctuation" >)</span><span class="token punctuation" >,</span>
    <span class="token keyword" >new</span> <span class="token class-name" >ManifestPlugin</span><span class="token punctuation" >(</span><span class="token punctuation" >)</span><span class="token punctuation" >,</span>
    <span class="token keyword" >new</span> <span class="token class-name" >ChunkManifestPlugin</span><span class="token punctuation" >(</span><span class="token punctuation" >{</span>
      filename<span class="token punctuation" >:</span> <span class="token string" >"chunk-manifest.json"</span><span class="token punctuation" >,</span>
      manifestVariable<span class="token punctuation" >:</span> <span class="token string" >"webpackManifest"</span>
    <span class="token punctuation" >}</span><span class="token punctuation" >)</span><span class="token punctuation" >,</span>
    <span class="token keyword" >new</span> <span class="token class-name" >webpack<span class="token punctuation" >.</span>optimize<span class="token punctuation" >.</span>OccurenceOrderPlugin</span><span class="token punctuation" >(</span><span class="token punctuation" >)</span>
  <span class="token punctuation" >]</span>
<span class="token punctuation" >}</span><span class="token punctuation" >;</span>
</code></pre>
<blockquote class="tip"><div class="tip-title"><i class="tip-icon icon-info"></i>tip</div>If you&#39;re using <a href="https://github.com/ampedandwired/html-webpack-plugin">webpack-html-plugin</a>, you can use <a href="https://github.com/szrenwei/inline-manifest-webpack-plugin">inline-manifest-webpack-plugin</a> to do this.</blockquote><p>Using this config the vendor chunk should not be changing its hash unless you change its code or dependencies. Here is a sample output for 2 runs with <code>moduleB.js</code> being changed between the runs:</p>
<pre><code class="lang-bash"><span class="token operator" >></span> webpack

Hash: 92670583f688a262fdad
Version: webpack 1.10.1
Time: 65ms

Asset Size Chunks Chunk Names
chunk-manifest.json 68 bytes <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span>
vendor.6d107863983028982ef4.js 3.71 kB 0 <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span> vendor
1.c4116058de00860e5aa8.js 107 bytes 1 <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span>
main.5e17f4dff47bc1a007c0.js 373 bytes 2 <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span> main

<span class="token punctuation" >[</span>0<span class="token punctuation" >]</span> ./src/index.js 186 bytes <span class="token punctuation" >{</span>2<span class="token punctuation" >}</span> <span class="token punctuation" >[</span>built<span class="token punctuation" >]</span>
<span class="token punctuation" >[</span>0<span class="token punctuation" >]</span> ./src/vendor.js 40 bytes <span class="token punctuation" >{</span>0<span class="token punctuation" >}</span> <span class="token punctuation" >[</span>built<span class="token punctuation" >]</span>
<span class="token punctuation" >[</span>1<span class="token punctuation" >]</span> ./src/moduleA.js 28 bytes <span class="token punctuation" >{</span>2<span class="token punctuation" >}</span> <span class="token punctuation" >[</span>built<span class="token punctuation" >]</span>
<span class="token punctuation" >[</span>2<span class="token punctuation" >]</span> ./src/moduleB.js 28 bytes <span class="token punctuation" >{</span>1<span class="token punctuation" >}</span> <span class="token punctuation" >[</span>built<span class="token punctuation" >]</span>

<span class="token operator" >></span> webpack

Hash: a9ee1d1e46a538469d7f
Version: webpack 1.10.1
Time: 67ms

Asset Size Chunks Chunk Names
chunk-manifest.json 68 bytes <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span>
vendor.6d107863983028982ef4.js 3.71 kB 0 <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span> vendor
1.2883246944b1147092b1.js 107 bytes 1 <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span>
main.5e17f4dff47bc1a007c0.js 373 bytes 2 <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span> main

<span class="token punctuation" >[</span>0<span class="token punctuation" >]</span> ./src/index.js 186 bytes <span class="token punctuation" >{</span>2<span class="token punctuation" >}</span> <span class="token punctuation" >[</span>built<span class="token punctuation" >]</span>
<span class="token punctuation" >[</span>0<span class="token punctuation" >]</span> ./src/vendor.js 40 bytes <span class="token punctuation" >{</span>0<span class="token punctuation" >}</span> <span class="token punctuation" >[</span>built<span class="token punctuation" >]</span>
<span class="token punctuation" >[</span>1<span class="token punctuation" >]</span> ./src/moduleA.js 28 bytes <span class="token punctuation" >{</span>2<span class="token punctuation" >}</span> <span class="token punctuation" >[</span>built<span class="token punctuation" >]</span>
<span class="token punctuation" >[</span>2<span class="token punctuation" >]</span> ./src/moduleB.js 28 bytes <span class="token punctuation" >{</span>1<span class="token punctuation" >}</span> <span class="token punctuation" >[</span>built<span class="token punctuation" >]</span>
</code></pre>
<p>Notice that vendor chunk has the same filename!</p>
<h2 class="header"><a class="anchor" href="#references" id="references"></a><span class="text">References</span><a class="icon-link" href="#references"></a></h2>
<ul>
<li><a href="https://medium.com/@okonetchnikov/long-term-caching-of-static-assets-with-webpack-1ecb139adb95#.vtwnssps4">https://medium.com/@okonetchnikov/long-term-caching-of-static-assets-with-webpack-1ecb139adb95#.vtwnssps4</a></li>
<li><a href="https://gist.github.com/sokra/ff1b0290282bfa2c037bdb6dcca1a7aa">https://gist.github.com/sokra/ff1b0290282bfa2c037bdb6dcca1a7aa</a></li>
</ul>
</div><hr/><div class="contributors"><h4>Contributors</h4><div class="contributors__list"><a class="contributor" href="https://github.com/okonet"><img src="https://github.com/okonet.png?size=80"/><span>okonet</span></a></div></div></section></div><div class="container footer"><div class="footer__inner"><section class="footer__left"><a class="footer__link" href="/get-started">Get Started</a><a class="footer__link" href="/analyze">Analyze</a><a class="footer__link" href="/contribute">Contribute</a></section><section class="footer__middle"><a href="/"><span class="cube cube--dark " style="width:18px;margin-left:9px;padding-bottom:9px;"><figure class="cube__outer" style="width:18px;height:18px;transform:translateX(-50%)
              scale3d(1,1,1)
              rotateX(0deg)
              rotateY(0deg)
              rotateZ(0deg);"><section class="cube__face" style="transform:rotateX(0deg) translateZ(9px);"></section><section class="cube__face" style="transform:rotateX(-90deg) translateZ(9px);"></section><section class="cube__face" style="transform:rotateX(90deg) translateZ(9px);"></section><section class="cube__face" style="transform:rotateY(-90deg) translateZ(9px);"></section><section class="cube__face" style="transform:rotateY(90deg) translateZ(9px);"></section><section class="cube__face" style="transform:rotateY(180deg) translateZ(9px);"></section></figure><figure class="cube__inner" style="width:18px;height:18px;transform:translateX(-50%)
              scale3d(0.5,0.5,0.5)
              rotateX(0deg)
              rotateY(0deg)
              rotateZ(0deg);"><section class="cube__face" style="transform:rotateX(0deg) translateZ(9px);"></section><section class="cube__face" style="transform:rotateX(-90deg) translateZ(9px);"></section><section class="cube__face" style="transform:rotateX(90deg) translateZ(9px);"></section><section class="cube__face" style="transform:rotateY(-90deg) translateZ(9px);"></section><section class="cube__face" style="transform:rotateY(90deg) translateZ(9px);"></section><section class="cube__face" style="transform:rotateY(180deg) translateZ(9px);"></section></figure></span></a></section><section class="footer__right"><a class="footer__link" href="//gitter.im/webpack/webpack">Support</a><a class="footer__link" href="/changelog">Changelog</a><a class="footer__link" href="/license">License</a></section></div></div><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create', 'UA-46921629-2', 'auto');ga('send', 'pageview');</script></div>
  </body>
</html>
