---
title: Web Workers
sort: 21
contributors:
  - chenxsan
---

As of webpack 5, you can use [Web Workers](https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API/Using_web_workers) without [`worker-loader`](https://github.com/webpack-contrib/worker-loader).

## Syntax

```js
new Worker(new URL("./worker.js", import.meta.url));
```

```js
// or customize the chunk name with magic comments
// see https://webpack.js.org/api/module-methods/#magic-comments
new Worker(
  /* webpackChunkName: "foo-worker" */ new URL("./worker.js", import.meta.url),
);
```

The syntax was chosen to allow running code without bundler, it is also available in native ECMAScript modules in the browser.

Note that while the [`Worker` API](https://developer.mozilla.org/en-US/docs/Web/API/Worker/Worker) suggests that `Worker` constructor would accept a string representing the URL of the script, in webpack 5 you can only use `URL` instead.

W> Using a variable in the `Worker` constructor is not supported by webpack. For example, the following code will not work: `const url = new URL('./path/to/worker.ts', import.meta.url); const worker = new Worker(url);`. This is because webpack cannot analyse the syntax statically. It is important to be aware of this limitation when using `Worker` syntax with webpack.

## Example

**src/index.js**

```js
const worker = new Worker(new URL("./deep-thought.js", import.meta.url));
worker.postMessage({
  question:
    "The Answer to the Ultimate Question of Life, The Universe, and Everything.",
});
worker.onmessage = ({ data: { answer } }) => {
  console.log(answer);
};
```

**src/deep-thought.js**

```js
globalThis.onmessage = ({ data: { question } }) => {
  self.postMessage({
    answer: 42,
  });
};
```

---

## Cross-Domain Workers

Webpack 5 allows workers to be hosted on a different domain.  
This is useful when your main app and workers are deployed separately.

### Example (Main Thread)

```js
const worker = new Worker(
  new URL('https://example.com/worker.js', import.meta.url),
  { type: 'module' }
);

worker.onmessage = ({ data }) => {
  console.log('Message from worker:', data);
};
```

### Example (Worker Code)

```js
self.postMessage('Hello from cross-domain worker');
```

### Full Examples

- Main thread: https://github.com/webpack/webpack/tree/main/examples/cross-origin-main-thread
- Host: https://github.com/webpack/webpack/tree/main/examples/cross-origin-host
- Worker: https://github.com/webpack/webpack/tree/main/examples/cross-origin-worker

---

## Set a public path from a variable

When using a dynamic public path with `publicPath: "auto"`, workers receive their own runtime.  
Webpack may calculate the public path incorrectly if your application uses a CDN or a different deployment origin.

To avoid this, set `__webpack_public_path__` inside the worker before loading other modules.

**worker.js**

```js
globalThis.onmessage = ({ data: { publicPath, ...otherData } }) => {
  if (publicPath) {
    __webpack_public_path__ = publicPath;
  }

  // rest of the worker code
};
```

**app.js**

```js
const worker = new Worker(new URL("./worker.js", import.meta.url));

worker.postMessage({ publicPath: globalThis.__MY_GLOBAL_PUBLIC_PATH_VAR__ });
```

---

## Node.js

Similar syntax is supported in Node.js (>= 12.17.0):

```js
import { Worker } from "node:worker_threads";

new Worker(new URL("./worker.js", import.meta.url));
```

Note that this is only available in ESM. `Worker` in CommonJS syntax is not supported by either webpack or Node.js.

---

## Multi-Compiler Mode

When using multiple Webpack configurations (multi-compiler mode), each worker entry may produce its own separate runtime.  
You must load the correct output file based on the compiler that generated it.

### Example

**webpack.config.js**

```js
module.exports = [
  {
    name: 'main',
    entry: './src/index.js',
    output: { filename: 'main-bundle.js' },
  },
  {
    name: 'worker',
    entry: './src/worker.js',
    target: 'webworker',
    output: { filename: 'worker-bundle.js' },
  },
];
```

### Creating the Worker

```js
const worker = new Worker(new URL('./worker-bundle.js', import.meta.url), {
  type: 'module',
});
```
